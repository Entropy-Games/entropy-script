<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>ES Web test</title>
    <script defer type="module">
        import * as es from '../../build/index.js';
        import {Context} from '../../build/runtime/context.js';

        (async () => {

            await es.init(
                console.log,
                (msg, cb) => cb(prompt()),
                false, {
                    print: console.log,
                }
            );

            let scripts = document.querySelectorAll('script[type=es]');

            const scriptTexts = [];

            for (const s of scripts) {
                const url = s.getAttribute('src');
                const text = await (await (fetch(url))).text();
                scriptTexts.push(text);
            }

            for (const text of scriptTexts) {
                const res = es.run(text);
                if (res.error) {
                    document.getElementById('error').innerHTML = res.error.str;
                }
            }
        })();
    </script>

    <script type="es" src="main.es"></script>
</head>
<body>
    <div id="error"></div>
    <div id="myDiv"></div>
</body>
</html>