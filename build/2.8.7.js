!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.es=t():e.es=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Context:()=>te,ESArray:()=>W,ESBoolean:()=>U,ESError:()=>Pe,ESErrorPrimitive:()=>C,ESFunction:()=>B,ESJSBinding:()=>P,ESNamespace:()=>D,ESNumber:()=>j,ESObject:()=>$,ESPrimitive:()=>N,ESString:()=>L,ESSymbol:()=>M,ESType:()=>R,ESUndefined:()=>I,ExpectedCharError:()=>Ue,IS_NODE_INSTANCE:()=>h,IllegalCharError:()=>Be,ImportError:()=>Le,IndexError:()=>Fe,InvalidOperationError:()=>Ge,InvalidRuntimeError:()=>Ke,InvalidSyntaxError:()=>je,KEYWORDS:()=>d,N_array:()=>he,N_binOp:()=>ie,N_break:()=>xe,N_class:()=>Te,N_continue:()=>Ne,N_emptyObject:()=>_e,N_for:()=>le,N_functionCall:()=>de,N_functionDefinition:()=>ve,N_if:()=>ue,N_indexed:()=>me,N_namespace:()=>Oe,N_number:()=>be,N_objectLiteral:()=>fe,N_primitiveWrapper:()=>Ce,N_return:()=>we,N_statements:()=>pe,N_string:()=>ke,N_tryCatch:()=>Se,N_unaryOp:()=>oe,N_undefined:()=>ge,N_varAssign:()=>ae,N_variable:()=>Ee,N_while:()=>ce,N_yield:()=>ye,Node:()=>se,ReferenceError:()=>Me,TestFailed:()=>Ye,TypeError:()=>We,catchBlockErrorSymbolName:()=>p,colours:()=>q,deepClone:()=>Ae,digits:()=>r,doubleCharTokens:()=>k,global:()=>u,identifierChars:()=>s,importCache:()=>y,indent:()=>$e,init:()=>ze,interpretResult:()=>re,libs:()=>_,multiLineCommentEnd:()=>a,multiLineCommentStart:()=>o,now:()=>v,primitiveMethods:()=>g,refreshPerformanceNow:()=>w,run:()=>He,runningInNode:()=>f,setGlobalContext:()=>c,singleCharTokens:()=>b,singleLineComment:()=>i,sleep:()=>Ie,str:()=>Re,stringSurrounds:()=>l,strip:()=>G,tokenType:()=>m,tokenTypeString:()=>O,tripleCharTokens:()=>E,tt:()=>T,types:()=>x,validURI:()=>De,wrap:()=>F});class n{constructor(e,t,n,r="(unknown)"){this.idx=e,this.ln=t,this.col=n,this.file=r}advance(e=""){return this.idx++,this.col++,"\n"===e&&(this.ln++,this.col=0),this}get clone(){return new n(this.idx,this.ln,this.col,this.file)}get str(){return`File ${this.file}, ${this.ln+1}:${this.col+1}`}get isUnknown(){return-2===this.idx}static get unknown(){return new n(-2,-2,-2,"(unknown)")}}const r="0123456789",s="_$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ",i="//",o="/*",a="*/";let u;const c=e=>{u=e},l=["'","`",'"'];let h="undefined"==typeof window;const f=()=>{h=!0},_={print:console.log},p="err",d=["var","let","global","local","mutable","const","if","else","while","for","in","continue","break","func","return","yield","class","extends","namespace","export","try","catch"];let v=()=>0;function w(e){return t=this,n=void 0,s=function*(){v=e?()=>Date.now():()=>{try{return null===performance||void 0===performance?void 0:performance.now()}catch(e){return 0}}},new((r=void 0)||(r=Promise))((function(e,i){function o(e){try{u(s.next(e))}catch(e){i(e)}}function a(e){try{u(s.throw(e))}catch(e){i(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}u((s=s.apply(t,n||[])).next())}));var t,n,r,s}w(h);const y={};var m;!function(e){e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.ENDSTATEMENT=2]="ENDSTATEMENT",e[e.IDENTIFIER=3]="IDENTIFIER",e[e.KEYWORD=4]="KEYWORD",e[e.COMMA=5]="COMMA",e[e.ASSIGN=6]="ASSIGN",e[e.ADD=7]="ADD",e[e.SUB=8]="SUB",e[e.MUL=9]="MUL",e[e.DIV=10]="DIV",e[e.POW=11]="POW",e[e.OPAREN=12]="OPAREN",e[e.CPAREN=13]="CPAREN",e[e.OBRACES=14]="OBRACES",e[e.CBRACES=15]="CBRACES",e[e.OSQUARE=16]="OSQUARE",e[e.CSQUARE=17]="CSQUARE",e[e.EQUALS=18]="EQUALS",e[e.NOTEQUALS=19]="NOTEQUALS",e[e.NOT=20]="NOT",e[e.GT=21]="GT",e[e.LT=22]="LT",e[e.GTE=23]="GTE",e[e.LTE=24]="LTE",e[e.AND=25]="AND",e[e.OR=26]="OR",e[e.COLON=27]="COLON",e[e.DOT=28]="DOT",e[e.EOF=29]="EOF",e[e.BITWISE_OR=30]="BITWISE_OR",e[e.BITWISE_AND=31]="BITWISE_AND",e[e.BITWISE_NOT=32]="BITWISE_NOT"}(m||(m={}));let T=m;const O={[T.NUMBER]:"Number",[T.STRING]:"String",[T.ENDSTATEMENT]:";",[T.IDENTIFIER]:"Identifier",[T.KEYWORD]:"Keyword",[T.COMMA]:",",[T.OBRACES]:"{",[T.CBRACES]:"}",[T.OPAREN]:"(",[T.CPAREN]:")",[T.OSQUARE]:"[",[T.CSQUARE]:"]",[T.ASSIGN]:"=",[T.ADD]:"+",[T.SUB]:"-",[T.MUL]:"*",[T.DIV]:"/",[T.POW]:"^",[T.EQUALS]:"==",[T.NOTEQUALS]:"!=",[T.NOT]:"!",[T.GT]:">",[T.LT]:"<",[T.GTE]:">=",[T.LTE]:"<=",[T.AND]:"&&",[T.OR]:"||",[T.COLON]:":",[T.DOT]:".",[T.EOF]:"End of File",[T.BITWISE_AND]:"&",[T.BITWISE_OR]:"|",[T.BITWISE_NOT]:"~"},b={"*":T.MUL,"/":T.DIV,"+":T.ADD,"-":T.SUB,"(":T.OPAREN,")":T.CPAREN,"^":T.POW,"{":T.OBRACES,"}":T.CBRACES,",":T.COMMA,"[":T.OSQUARE,"]":T.CSQUARE,";":T.ENDSTATEMENT,":":T.COLON,".":T.DOT,"=":T.ASSIGN,">":T.GT,"<":T.LT,"!":T.NOT,"|":T.BITWISE_OR,"&":T.BITWISE_AND,"~":T.BITWISE_NOT},k={"==":T.EQUALS,"!=":T.NOTEQUALS,">=":T.GTE,"<=":T.LTE,"+=":T.ASSIGN,"-=":T.ASSIGN,"*=":T.ASSIGN,"/=":T.ASSIGN,"&&":T.AND,"||":T.OR},E={},g=["__add__","__subtract__","__multiply__","__divide__","__pow__","__eq__","__gt__","__lt__","__and__","__or__","__bool__","__setProperty__","__getProperty__","__call__"],x={};class N{constructor(e,t=x.any){this.self=this,this.isa=(e,t)=>new U(t===this.__type__),this.is=(e,t)=>new U(t===this),this.valueOf=()=>this.__value__,this.typeName=()=>this.__type__.__name__,this.hasProperty=(e,t)=>new U(this.hasOwnProperty(Re(t))),this.describe=(e,t)=>{this.info.isBuiltIn||(this.info.description=Re(t))},this.detail=(e,t)=>{if(this.info.isBuiltIn)return;const r=G(t,e);if("object"!=typeof r)return new We(n.unknown,"object",this.typeName(),Re(this));this.info=Object.assign(Object.assign({},this.info),r),this.info.isBuiltIn=!1},this.__type__=t||this,this.__value__=e,this.info={}}__add__(e,t){return new Ge("",this)}__subtract__(e,t){return new Ge("",this)}__multiply__(e,t){return new Ge("",this)}__divide__(e,t){return new Ge("",this)}__pow__(e,t){return new Ge("__pow__",this)}__eq__(e,t){return new Ge("__eq__",this)}__gt__(e,t){return new Ge("__gt__",this)}__lt__(e,t){return new Ge("__lt__",this)}__and__(e,t){return new Ge("__and__",this)}__or__(e,t){return new Ge("__or__",this)}__bool__(e){return new Ge("__bool__",this)}__setProperty__(e,t,n){return new Ge("__setProperty__",this,`[${Re(t)}] = ${Re(n)}`)}__call__(e,...t){return new Ge("__call__",this)}}class C extends N{constructor(e=new Pe(n.unknown,"Unknown","Error not specified")){super(e,x.error),this.__getProperty__=(e,t)=>{switch(Re(t)){case"name":return new L(this.valueOf().name);case"details":return new L(this.valueOf().details);case"traceback":return new W(this.valueOf().traceback.map((e=>new L(`${e.position.str} : ${e.line}`))));default:return this.self.hasOwnProperty(Re(t))?F(this.self[Re(t)]):new Fe(n.unknown,t.valueOf(),this)}},this.cast=()=>new Pe(n.unknown,"TypeError","Cannot cast type 'error'"),this.str=()=>new L(`<Error: ${this.valueOf().str}>`),this.__eq__=(e,t)=>new U(t instanceof C&&this.valueOf().constructor===t.valueOf().constructor),this.__bool__=()=>new U(!0),this.bool=this.__bool__,this.clone=()=>new C(this.valueOf())}}function S(e,t,r,s,i){if(!(t instanceof R))return new We(n.unknown,"Type",typeof t,t);const o=new B((({context:e},...n)=>{const o=new te;if(o.parent=e,t.__extends__){let e=S(o,t.__extends__,r,s,i);if(e instanceof Pe)return e}const a=null==t?void 0:t.__init__;if(!a)return;a.this_=s,a.__closure__=o;const u=a.__call__({context:o},...n);return u instanceof Pe?u:void 0}),void 0,"super",s);let a=e.setOwn("super",o);if(a instanceof Pe)return a;const u=A(t,{context:e},[],!1,r);return u instanceof Pe?u:void 0}function A(e,{context:t},n,r=!0,s={}){var i;if(e.__isPrimitive__){if(n.length<1)return new I;switch(e.__name__){case"Undefined":case"Type":return n.length<1?new R:new L(n[0].__type__.__name__);case"String":return new L(n[0].str().valueOf());case"Array":return new W(n);case"Number":return new j(n[0].valueOf());case"Function":return new B(n[0].valueOf());case"Boolean":return new U(n[0].bool().valueOf());default:return F(n[0])}}const o=new te;o.parent=null===(i=e.__init__)||void 0===i?void 0:i.__closure__;const a=new $;if(e.__extends__){let n=S(o,e.__extends__,s,a,t);if(n instanceof Pe)return n}a.__value__=s;for(let t of e.__methods__){const e=t.clone();e.this_=a,s[t.name]=e,-1!==g.indexOf(t.name)&&(a[t.name]=e.__call__)}if(r&&e.__init__){e.__init__.this_=a,e.__init__.__closure__=o;const t=e.__init__.__call__({context:o},...n);if(t instanceof Pe)return t}return a.__type__=e,e.__instances__.push(a),a}class R extends N{constructor(e=!1,t="(anon)",r=[],s,i){super(void 0,null==x?void 0:x.type),this.__instances__=[],this.clone=()=>new R(this.__isPrimitive__,this.__name__,this.__methods__,this.__extends__,this.__init__),this.isa=({},e)=>new U(e===x.type),this.cast=({},e)=>new Ge("cast",this),this.includesType=(e,t)=>{var n,r,s,i,o,a;return this.equals(e,x.any).bool().valueOf()||t.equals(e,x.any).bool().valueOf()||!0===(null===(n=this.__extends__)||void 0===n?void 0:n.equals(e,t).valueOf())||!0===(null===(r=this.__extends__)||void 0===r?void 0:r.equals(e,x.any).valueOf())||!0===(null===(s=this.__extends__)||void 0===s?void 0:s.includesType(e,t).valueOf())||!0===(null===(i=t.__extends__)||void 0===i?void 0:i.equals(e,this).valueOf())||!0===(null===(o=t.__extends__)||void 0===o?void 0:o.equals(e,x.any).valueOf())||!0===(null===(a=t.__extends__)||void 0===a?void 0:a.includesType(e,this).valueOf())?new U(!0):this.equals(e,t)},this.equals=({},e)=>new U(e.__name__===this.__name__&&e.__isPrimitive__===this.__isPrimitive__&&Object.is(this.valueOf(),e.valueOf())),this.__call__=({context:e},...t)=>A(this,{context:e},t||[]),this.str=()=>new L(`<Type: ${this.__name__}>`),this.__bool__=()=>new U(!0),this.bool=this.__bool__,this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Re(e))){const t=this.self[Re(e)];return"function"==typeof t?new B(t):F(t)}return new Fe(n.unknown,e.valueOf(),this)},this.__isPrimitive__=e,this.__name__=t,this.info.name=t,this.__extends__=s,this.__methods__=r,i&&(i.name=t,this.__init__=i),x.type||(this.__type__=this)}}class I extends N{constructor(){super(void 0,x.undefined),this.cast=({context:e},t)=>{switch(t){case x.number:return new j;case x.string:return new L;case x.array:return new W;case x.undefined:return new I;case x.type:return new R;case x.error:return new C;case x.object:case x.any:return new $;case x.function:return new B((()=>{}));case x.boolean:return new U;default:return t instanceof R?t.__call__({context:e}):new Pe(n.unknown,"TypeError",`Cannot cast to type '${Re(t.typeName())}'`)}},this.str=()=>new L("<Undefined>"),this.__eq__=(e,t)=>new U(t instanceof I||void 0===t||void 0===t.valueOf()),this.__bool__=()=>new U,this.bool=this.__bool__,this.clone=()=>new I,this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Re(e))){const t=this.self[Re(e)];return"function"==typeof t?new B(t):F(t)}return new Fe(n.unknown,e.valueOf(),this)},this.info={name:"undefined",description:"Not defined, not a value.",file:"built-in",isBuiltIn:!0}}}class $ extends N{constructor(e={}){super(e,x.object),this.isa=(e,t)=>t===x.object?new U(!0):t instanceof R?this.__type__.includesType(e,t):new We(n.unknown,"TypeError","type",Re(t.typeName()),Re(t)),this.cast=({},e)=>e===x.number?new j(this.valueOf()?1:0):new Pe(n.unknown,"TypeError",`Cannot cast boolean to type '${Re(e.typeName())}'`),this.str=()=>{let e=Re(this.valueOf());return"\n"===e[e.length-1]&&(e=e.substr(0,e.length-1)),new L(`<ESObject ${e}>`)},this.__eq__=({context:e},t)=>{if(!(t instanceof $))return new U;if(t.keys.length!==this.keys.length)return new U;for(let n of this.keys){const r=n.valueOf(),s=this.valueOf()[r],i=t.valueOf()[r];if(!s){if(i)return new U;continue}if(!s.__eq__)return new U;const o=s.__eq__({context:e},i);if(o instanceof Pe)return o;if(!o.valueOf())return new U}return new U(!0)},this.__bool__=()=>new U(!0),this.bool=this.__bool__,this.__add__=({context:e},t)=>{if(!(t instanceof $))return new We(n.unknown,"object",t.typeName().valueOf(),t);let r={};for(let t of this.keys){const n=t.valueOf(),s=this.__getProperty__({context:e},t);if(s instanceof Pe)return s;r[n]=s}for(let n of t.keys){const s=n.valueOf();if(r.hasOwnProperty(s))continue;const i=t.__getProperty__({context:e},n);if(i instanceof Pe)return i;r[s]=i}return new $(r)},this.__subtract__=(e,t)=>{let r=[];if(t instanceof L)r=[Re(t)];else{if(!(t instanceof W))return new We(n.unknown,"array | string",t.typeName().valueOf(),t);r=G(t,e)}if(!Array.isArray(r))return new We(n.unknown,"array | string",t.typeName().valueOf(),t);let s={};for(let t of this.keys){const n=t.valueOf();if(-1===r.indexOf(n)){let r=this.__getProperty__(e,t);if(r instanceof Pe)return r;s[n]=r}}return new $(s)},this.__getProperty__=(e,t)=>{if(!(t instanceof L||t instanceof j))return new We(n.unknown,"string | number",t.typeName(),Re(t));const r=t.valueOf();if(this.valueOf().hasOwnProperty(r))return this.valueOf()[r];if(this.self.hasOwnProperty(r)){const e=this.self[r];return"function"==typeof e?new B(e):F(e)}return new I},this.__setProperty__=({},e,t)=>{if(!(e instanceof L))return new We(n.unknown,"string",e.typeName(),Re(e));this.__value__[e.valueOf()]=t},this.hasProperty=(e,t)=>{const n=Re(t);return this.valueOf().hasOwnProperty(Re(n))?new U(!0):new U(this.hasOwnProperty(n))},this.clone=()=>{const e=new $;let t={},n=this.valueOf();for(let e of Object.keys(n))t[e]=n[e];return e.__value__=t,e}}get keys(){return Object.keys(this.valueOf()).map((e=>new L(e)))}set keys(e){}}class D extends N{constructor(e,t,r=!1){super(t,x.object),this.cast=({})=>new Pe(n.unknown,"TypeError","Cannot cast type 'namespace'"),this.clone=()=>{let e={},t=this.valueOf();for(let n of Object.keys(t))e[n]=t[n];return new D(this.name,e)},this.str=()=>{const e=Object.keys(this.valueOf());return new L(`<Namespace ${Re(this.name)}${e.length>0?": ":""}${e.slice(0,5)}${e.length>=5?"...":""}>`)},this.__eq__=(e,t)=>new U(this===t),this.__bool__=()=>new U(!0),this.bool=this.__bool__,this.__getProperty__=(e,t)=>{if(t instanceof L&&this.valueOf().hasOwnProperty(t.valueOf())){const e=this.valueOf()[t.valueOf()];if(e.isAccessible)return e.value}if(!(t instanceof L))return new We(n.unknown,"string",t.typeName());if(this.self.hasOwnProperty(Re(t))){const e=this.self[Re(t)];return"function"==typeof e?new B(e):F(e)}return new Fe(n.unknown,t.valueOf(),this.self)},this.info.name=Re(e),this.mutable=r}get name(){return new L(this.info.name)}set name(e){this.info.name=e.valueOf()}__setProperty__(e,t,r){if(!(t instanceof L))return new We(n.unknown,"string",t.typeName().valueOf(),Re(t));let s=Re(t);if(!this.mutable)return new We(n.unknown,"mutable","immutable",`${Re(this.name)}`);r instanceof N||(r=F(r));const i=this.__value__[s];return i?i.isConstant?new We(n.unknown,"mutable","immutable",`${Re(this.name)}[${s}]`):i.isAccessible?void(i.value=r):new We(n.unknown,"accessible","inaccessible",`${Re(this.name)}[${s}]`):new Pe(n.unknown,"SymbolError",`Symbol ${s} is not declared in namespace ${Re(this.name)}.`)}}class P extends N{constructor(e,t="<AnonNative>",r=!1){super(e,x.object),this.cast=({})=>new Pe(n.unknown,"TypeError","Cannot cast native object"),this.clone=()=>new P(this.__value__),this.str=()=>{try{return new L(JSON.stringify(this.__value__))}catch(e){return new L(`${this.__value__}`)}},this.__eq__=({},e)=>new U(this===e),this.__bool__=()=>new U(!0),this.bool=this.__bool__,this.__getProperty__=(e,t)=>{const r=Re(t),s=this.valueOf(),i=s[r];if(void 0===i){if(this.self.hasOwnProperty(r)){const e=this.self[Re(r)];return"function"==typeof e?new B(e):F(e)}return new Fe(n.unknown,r,this)}return i instanceof N?i:"function"==typeof i?new B((({context:t},...n)=>(n=n.map((t=>G(t,e))),F(s[r](...n))))):F(i)},this.__call__=(e,...t)=>{if("function"!=typeof this.__value__)return new We(n.unknown,"function",typeof this.__value__,Re(this));let r;try{r=new this.__value__(...t.map((t=>G(t,e))))}catch(n){r=this.__value__(...t.map((t=>G(t,e))))}return r instanceof N?r:F(r)},this.hasProperty=(e,t)=>new U(!(this.__getProperty__(e,t)instanceof Pe)),this.info.name=Re(t)}}x.type=new R(!0,"Type"),x.undefined=new R(!0,"Undefined"),x.string=new R(!0,"String"),x.array=new R(!0,"Array"),x.number=new R(!0,"Number"),x.any=new R(!0,"Any"),x.function=new R(!0,"Function"),x.bool=new R(!0,"Boolean"),x.object=new R(!0,"Object"),x.error=new R(!0,"Error"),x.any.info={name:"any",description:"Matches any other type",file:"built-in",isBuiltIn:!0},x.number.info={name:"any",description:"The ES Number type. Is a a double-precision 64-bit binary format IEEE 754 value, like double in Java and C#",file:"built-in",isBuiltIn:!0},x.string.info={name:"string",description:"The ES String type. Holds an array of characters, and can be defined with any of ', \" and `. Can be indexed like an array.",file:"built-in",isBuiltIn:!0},x.bool.info={name:"bool",description:"The ES Bool type. Exactly two instances exist, true and false.",file:"built-in",isBuiltIn:!0},x.function.info={name:"function",description:"The ES Function type. Is a block of code which executes when called and takes in 0+ parameters.",file:"built-in",isBuiltIn:!0},x.array.info={name:"array",description:"The ES Array type. Defines a set of items of any type which can be accessed by an index with [].",file:"built-in",isBuiltIn:!0},x.object.info={name:"object",description:"The ES Object type. Similar to JS objects or python dictionaries.",file:"built-in",isBuiltIn:!0},x.error.info={name:"error",description:"The ES Error type. Call to throw an error.",file:"built-in",isBuiltIn:!0},x.type.info={name:"type",description:"The ES Type type. Call to get the type of a value at a string.",file:"built-in",isBuiltIn:!0};class B extends N{constructor(e=(()=>{}),t=[],r="(anon)",s=new $,i=x.any,o=u){super(e,x.function),this.cast=({},e)=>new Pe(n.unknown,"TypeError","Cannot cast type 'function'"),this.clone=()=>new B(this.__value__,this.arguments_,this.name,this.this_,this.returnType,this.__closure__),this.valueOf=()=>this,this.str=()=>new L(`<Func: ${this.name}>`),this.__eq__=(e,t)=>new U(t instanceof B&&this.__value__===t.__value__),this.__bool__=()=>new U(!0),this.bool=this.__bool__,this.__call__=({context:e},...t)=>(this.__closure__.path=e.path,function(e,t,r){var s;let i=e;(e=t.__closure__).path=i.path;const o=t.__value__,a=function(e,t,r){const s=new te;s.parent=r;let i=Math.max(e.length,t.arguments_.length);for(let o=0;o<i;o++){let i=new I,a=x.any;if(!t.arguments_[o])continue;const u=t.arguments_[o];if(!(u.type instanceof R))return new We(n.unknown,"Type",typeof u.type,u.type);if(e[o]instanceof N&&(a=e[o].__type__,i=e[o]),!u.type.includesType({context:r},a).bool().valueOf())return new We(n.unknown,u.type.__name__,a.__name__,Re(i));s.setOwn(u.name,i,{forceThroughConst:!0})}let o=s.setOwn("args",new W(e),{forceThroughConst:!0});return o instanceof Pe?o:s}(r,t,e);if(a instanceof Pe)return a;let u=null!==(s=t.this_)&&void 0!==s?s:new $;if(!(u instanceof $))return new We(n.unknown,"object",typeof u,u,"'this' must be an object");let c=a.setOwn("this",u);return c instanceof Pe?c:o instanceof se?function(e,t,r,s){var i,o,a,u;const c=s.interpret(t);return c.error?c.error:(void 0!==c.funcReturn&&(c.val=c.funcReturn,c.funcReturn=void 0),!1===e.returnType.includesType({context:t},null!==(o=null===(i=c.val)||void 0===i?void 0:i.__type__)&&void 0!==o?o:x.any).valueOf()?new We(n.unknown,e.returnType.__name__,(null===(a=c.val)||void 0===a?void 0:a.typeName().valueOf())||"undefined",null===(u=c.val)||void 0===u?void 0:u.str().valueOf(),"(from function return)"):c.val?c.val:new I)}(t,a,0,o):"function"==typeof o?function(e,t,n,r){for(let e=n.length;e<r.length;e++)n.push(new I);const s=r({context:t},...n);return s instanceof Pe||s instanceof N?s:new I}(0,a,r,o):new We(n.unknown,"function",typeof o)}(this.__closure__,this,t)),this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Re(e))){const t=this.self[Re(e)];return"function"==typeof t?new B(t):F(t)}return new Fe(n.unknown,e.valueOf(),this)},this.arguments_=t,this.info.name=r,this.this_=s,this.returnType=i,this.__closure__=o,this.info.returnType=Re(i),this.info.args=t.map((e=>({name:e.name,defaultValue:Re(e.defaultValue),type:e.type.info.name,required:!0})))}get name(){var e;return null!==(e=this.info.name)&&void 0!==e?e:"(anonymous)"}set name(e){this.info.name=e}}class j extends N{constructor(e=0){super(e,x.number),this.cast=({},e)=>{switch(e){case x.number:return this;case x.string:return this.str();case x.array:return new W(new Array(this.valueOf()));default:return new Pe(n.unknown,"TypeError",`Cannot cast to type '${Re(e.typeName())}'`)}},this.str=()=>new L(this.valueOf().toString()),this.__add__=(e,t)=>t instanceof j?new j(this.valueOf()+t.valueOf()):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__subtract__=(e,t)=>t instanceof j?new j(this.valueOf()-t.valueOf()):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__multiply__=(e,t)=>t instanceof j?new j(this.valueOf()*t.valueOf()):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__divide__=(e,t)=>t instanceof j?new j(this.valueOf()/t.valueOf()):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__pow__=(e,t)=>t instanceof j?new j(Math.pow(this.valueOf(),t.valueOf())):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__eq__=(e,t)=>new U(t instanceof j&&this.valueOf()===t.valueOf()),this.__gt__=(e,t)=>t instanceof j?new U(this.valueOf()>t.valueOf()):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__lt__=(e,t)=>t instanceof j?new U(this.valueOf()<t.valueOf()):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__bool__=()=>new U(this.valueOf()>0),this.bool=this.__bool__,this.clone=()=>new j(this.valueOf()),this.__getProperty__=({},e)=>{if(this.self.hasOwnProperty(Re(e))){const t=this.self[Re(e)];return"function"==typeof t?new B(t):F(t)}return new Fe(n.unknown,e.valueOf(),this)}}}class U extends N{constructor(e=!1){super(Boolean(e),x.bool),this.__getProperty__=(e,t)=>{if(this.self.hasOwnProperty(Re(t))){const e=this.self[Re(t)];return"function"==typeof e?new B(e):F(e)}return new Fe(n.unknown,t.valueOf(),this)},this.cast=(e,t)=>t===x.number?new j(this.valueOf()?1:0):new Pe(n.unknown,"TypeError",`Cannot cast boolean to type '${Re(t.typeName())}'`),this.__eq__=(e,t)=>t instanceof U?new U(this.valueOf()===t.valueOf()):new We(n.unknown,"Boolean",t.typeName().valueOf(),t.valueOf()),this.__bool__=()=>this,this.__and__=(e,t)=>new U(this.valueOf()&&t.bool().valueOf()),this.__or__=(e,t)=>new U(this.valueOf()||t.bool().valueOf()),this.str=()=>new L(this.valueOf()?"true":"false"),this.clone=()=>new U(this.valueOf()),this.bool=()=>this,this.info={name:Re(e),description:`Boolean global constant which evaluates to ${Re(e)}, the opposite of ${Re(!e)}`,file:"built-in",isBuiltIn:!0,helpLink:"https://en.wikipedia.org/wiki/Boolean_expression"}}}class W extends N{constructor(e=[]){super(e,x.array),this.cast=({},e)=>{switch(e){case x.number:return new j(this.len);case x.boolean:return this.bool();default:return new Pe(n.unknown,"TypeError",`Cannot cast boolean to type '${Re(e.typeName())}'`)}},this.str=()=>new L(Re(this.valueOf())),this.__eq__=({context:e},t)=>{if(!(t instanceof W))return new U;if(t.len!==this.len)return new U;for(let n=0;n<this.len;n++){const r=this.valueOf()[n],s=t.valueOf()[n];if(!r){if(s)return new U;continue}if(!r.__eq__)return new U;const i=r.__eq__({context:e},s);if(i instanceof Pe)return i;if(!i.valueOf())return new U}return new U(!0)},this.__add__=({context:e},t)=>t instanceof W?new W([...this.valueOf(),...t.valueOf()]):new We(n.unknown,"array",t.typeName().valueOf(),t),this.__bool__=()=>new U(this.valueOf().length>0),this.bool=this.__bool__,this.__getProperty__=(e,t)=>{if(t instanceof L&&this.self.hasOwnProperty(Re(t))){const e=this.self[Re(t)];return"function"==typeof e?new B(e):F(e)}if(!(t instanceof j))return new I;let n=t.valueOf();for(;n<0;)n=this.valueOf().length+n;return n<this.valueOf().length?this.valueOf()[n]:new I},this.add=(e,t,n=new j(this.len-1))=>{if(!(t instanceof N))throw"adding non-primitive to array: "+Re(t);return this.len++,this.__value__.splice(n.valueOf(),0,t),new j(this.len)},this.contains=(e,t)=>{for(let n of this.__value__)if(t.__eq__(e,n))return!0;return!1},this.clone=()=>{const e=[];for(let t of this.valueOf())e.push(t);return new W(e)},this.len=e.length}__setProperty__(e,t,n){if(!(t instanceof j))return;n instanceof N||(n=F(n));let r=t.valueOf();for(;r<0;)r=this.valueOf().length+r;this.__value__[r]=n}}class L extends N{constructor(e=""){super(e,x.string),this.str=()=>this,this.cast=({},e)=>{switch(e){case x.number:const t=parseFloat(this.valueOf());return isNaN(t)?new Pe(n.unknown,"TypeError","This string is not a valid number"):new j(t);case x.string:return this;case x.array:return new W(this.valueOf().split("").map((e=>new L(e))));default:return new Pe(n.unknown,"TypeError",`Cannot cast to type '${Re(e.typeName())}'`)}},this.__add__=(e,t)=>t instanceof L?new L(this.valueOf()+t.valueOf()):new We(n.unknown,"String",t.typeName().valueOf(),t.valueOf()),this.__multiply__=(e,t)=>t instanceof j?new L(this.valueOf().repeat(t.valueOf())):new We(n.unknown,"Number",t.typeName().valueOf(),t.valueOf()),this.__eq__=(e,t)=>new U(t instanceof L&&this.valueOf()===t.valueOf()),this.__gt__=(e,t)=>t instanceof L?new U(this.valueOf().length>t.valueOf().length):new We(n.unknown,"String",t.typeName().valueOf(),t.valueOf()),this.__lt__=(e,t)=>t instanceof L?new U(this.valueOf().length<t.valueOf().length):new We(n.unknown,"String",t.typeName().valueOf(),t.valueOf()),this.__bool__=()=>new U(this.valueOf().length>0),this.bool=this.__bool__,this.len=()=>new j(this.valueOf().length),this.clone=()=>new L(this.valueOf()),this.__getProperty__=(e,t)=>{if(t instanceof L&&this.self.hasOwnProperty(Re(t))){const e=this.self[Re(t)];return"function"==typeof e?new B(e):F(e)}if(!(t instanceof j))return new L;let n=t.valueOf();for(;n<0;)n=this.valueOf().length+n;return n<this.valueOf().length?new L(this.valueOf()[n]):new L}}__setProperty__(e,t,n){if(!(t instanceof j))return;n instanceof L||(n=new L(Re(n)));let r=t.valueOf();for(;r<0;)r=this.valueOf().length+r;const s=n.str().valueOf();let i=this.__value__.substr(0,r),o=this.__value__.substr(r+s.length);this.__value__=i+s+o}}class M{constructor(e,t,n={}){var r,s;this.clone=()=>new M(this.value.clone(),this.identifier,{isConstant:this.isConstant,isAccessible:this.isAccessible}),this.str=()=>new L(`<Symbol: ${this.identifier}>`),this.value=e,this.identifier=t,this.isConstant=null!==(r=n.isConstant)&&void 0!==r&&r,this.isAccessible=null===(s=n.isAccessible)||void 0===s||s}}function F(e,t=!1){return e instanceof N?e:null==e?new I:e instanceof Pe?new C(e):e instanceof M?e.value:"number"==typeof e?new j(e):"string"==typeof e?new L(e):"boolean"==typeof e?new U(e):"bigint"==typeof e?new j(Number(e)):"symbol"==typeof e?new L(String(e)):new P(e,void 0,t)}function G(e,t){if(null!=e){if(!(e instanceof N))return e;if(e instanceof W)return e.valueOf().map((e=>G(e,t)),t);if(e instanceof $){let n={};for(let r in e.valueOf())n[r]=G(e.valueOf()[r],t);return n}if(!(e instanceof I))return e instanceof B?(...n)=>{const r=e.__call__(t,...n.map((e=>F(e))));return r instanceof Pe?r:G(r,t)}:e instanceof R?e:e.valueOf()}}const K={red:31,yellow:33,green:32,cyan:36,blue:34,grey:2},Y={};for(let e of Object.keys(K))Y[e]=t=>(t||(t=""),h?`[${K[e]}m`+t+"[0m":`<span style="color: ${e}">${t}</span>`);const q=Y,Q={range:[({context:e},t,r,s)=>{if(!(t instanceof j))return new W;const i=t.valueOf();if(r instanceof I)try{return new W([...Array(i).keys()].map((e=>new j(e))))}catch(e){return new Pe(n.unknown,"RangeError",`Cannot make range of length '${Re(i)}'`)}let o=1;if(!(r instanceof j))return new We(n.unknown,"number",r.typeName(),Re(r));let a=r.valueOf();if(!(s instanceof I)){if(!(s instanceof j))return new We(n.unknown,"number",s.typeName(),Re(s));o=s.valueOf()}let u=[],c=i;for(;c<a;)u.push(new j(c)),c+=o;return new W(u)},{args:[{name:"N",type:"Number"}],description:"Generates an array of integers given N. Starts at 0 and goes to N-1. Can be used like for i in range(10) ..., similarly to python.",returns:"array of numbers from 0 to N-1",returnType:"number[] | RangeError"}],log:[({context:e},...t)=>{console.log(...t.map((e=>Re(e))))},{args:[{name:"...values",type:"any[]"}],description:"Uses console.log to log all values",returnType:"void"}],parseNum:[({context:e},t)=>{try{const e=parseFloat(Re(t));return isNaN(e)?new Pe(n.unknown,"TypeError",`Cannot convert '${Re(t)}' to a number.`):new j(e)}catch(e){return new Pe(n.unknown,"TypeError",`Cannot convert '${Re(t)}' to a number.`)}},{args:[{name:"num",type:"any"}],description:"Converts a string of digits into a number. Works with decimals and integers. Calls .str() on value before using native JS 'parseFloat' function. Returns TypeError if the string can't be converted into a number.",returnType:"number | TypeError"}],help:[({context:e},...t)=>{if(!t.length)return new L("Visit https://entropygames.io/entropy-script for help with Entropy Script!\nTry 'help(<anything>)' for help about a particular object.");let n="";for(const e of t){if(!(e instanceof N))return void console.log("Invalid arg not primitive: "+Re(e));const t=e.info;if(n+=`${q.yellow(`Help on '${t.name||"(anonymous)"}'`)}:\n    \n    ${q.yellow("Value")}: ${$e($e(Re(e)))}\n    ${q.yellow("Type")}: '${Re(e.typeName())}'\n    ${q.yellow("Location")}: ${t.file||q.yellow("(unknown)")}\n    \n        ${q.green(t.description)||"No description."}\n        \n    ${t.helpLink?q.cyan(t.helpLink+"\n\n"):""}\n`,t.args&&e instanceof B){const e=t.args.length,r=t.args.filter((e=>e.required)).length;n+=e==r?q.yellow(`    Arguments (${e}): \n`):q.yellow(`    Arguments (${r}-${e}): \n`);for(const[e,r]of t.args.entries())n+="object"!=typeof r?`        ${e+1}. INVALID ARG INFO`:`        ${e+1}. ${r.name}${!1===r.required?q.yellow(" (optional) "):" "}{${r.type}} ${r.description||""}\n`;n+="\n\n",t.returns&&(n+=`    Returns: ${t.returns}\n\n`),t.returnType&&(n+=`    Return Type: ${t.returnType}\n\n`)}if(t.contents&&(e instanceof $||e instanceof D)){n+="    Properties: \n      ";for(let e of t.contents)n+=e.name+"\n      "}}return console.log(n),t.length>1?new W(t):t?t[0]:void 0},{args:[{name:"value",type:"any"}],description:"logs info on value",returns:"value passed in"}],delete:[({context:e},t)=>{const r=Re(t);if(!e.has(r))return new Pe(n.unknown,"DeleteError",`Identifier '${r}' not found in the current context`);e.set(r,new I)},{name:"delete",args:[{name:"identifier",type:"string"}],description:"Deletes a variable from the current context"}],__path:[({context:e})=>new L(e.path),{name:"__path",args:[],description:"Returns the current path"}],__symbols:[({context:e})=>F(e.keys),{name:"__allSymbols",args:[],description:"Returns an array of the names of all symbols in the current context"}],using:[({context:e},t,r)=>{if(!(t instanceof D||t instanceof P))return new We(n.unknown,"Namespace",Re(t.typeName()));let s=!0;r&&(r.bool().valueOf()||(s=!1));const i=t.valueOf();s?e=e.root:e.parent&&(e=e.parent);for(const t of Object.keys(i))e.setOwn(t,i[t].value,{isConstant:i[t].isConstant,isAccessible:i[t].isAccessible,forceThroughConst:!0})},{name:"using",args:[{name:"module",type:"namespace"},{name:"global",type:"bool"}],description:"Adds contents of a namespace to the global context"}],sleep:[({context:e},t,r)=>{if(!(t instanceof j))return new We(n.unknown,"number",Re(t.typeName()),Re(t));Ie(t.valueOf()).then((()=>{const t=r.__call__({context:e});t instanceof Pe&&console.log(t.str)}))},{name:"sleep",args:[{name:"n",type:"number"},{name:"callback",type:"function"}],description:"Waits n milliseconds and then executes the callback"}],throw:[({context:e},t,r)=>new Pe(n.unknown,Re(t),Re(r)),{name:"throw",args:[{name:"name",type:"string"},{name:"details",type:"string"}]}]},V={parse:(e,t)=>new $(JSON.parse(Re(t))),stringify:(e,t)=>t instanceof $?new L(JSON.stringify(G(t,e))):new We(n.unknown,"object",Re(t.typeName()),Re(t))},J={ascii:{asciiToChar:(e,t)=>t instanceof j?new L(String.fromCharCode(t.valueOf())):new We(n.unknown,"number",Re(t.typeName()),Re(t)),charToAscii:(e,t)=>t instanceof L?new j(Re(t).charCodeAt(0)):new We(n.unknown,"string",Re(t.typeName()),Re(t))},json:V},z={};function H(e,t){const n={},r=e.valueOf();for(const e of Object.keys(r))n[e]=new M(r[e],e);return new P(n,t)}function X(e){return e in J||e in z}function Z(e){if(e in z)return z[e];if(e in J){const t=H(new P(J[e]),e);return z[e]=t,t}}function ee(e,t,r){Q.import=[({context:r},s,i)=>{if(h)return new Pe(n.unknown,"ImportError","Is running in node instance but trying to run browser import function");const o=s.str();if(X(Re(o)))return Z(Re(o));try{fetch(Re(o)).then((e=>e.text())).then((s=>{return a=this,u=void 0,l=function*(){const a=new te;a.parent=e;const u=yield He(s);u.error?t(new Le(n.unknown,Re(o),u.error.str).str):i instanceof B&&i.__call__({context:r},new D(o,a.getSymbolTableAsDict()))},new((c=void 0)||(c=Promise))((function(e,t){function n(e){try{s(l.next(e))}catch(e){t(e)}}function r(e){try{s(l.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):(s=t.value,s instanceof c?s:new c((function(e){e(s)}))).then(n,r)}s((l=l.apply(a,u||[])).next())}));var a,u,c,l}))}catch(e){return new Pe(n.unknown,"ImportError",e.toString())}},{}],Q.print=[({context:e},...n)=>{let r="";for(let e of n)r+=Re(e);t(r)},{}],Q.input=[({context:e},t,n)=>{r(t.valueOf(),(t=>{let r=null==n?void 0:n.valueOf();if(r instanceof B){let n=r.__call__({context:e},new L(t));n instanceof Pe&&console.log(n.str)}else"function"==typeof r&&r(t);return new L("'input()' does not return anything. Pass in a function as the second argument, which will take the user input as an argument.")}))},{}];for(let t in Q){const n=new B(Q[t][0],[],t,void 0,void 0,e);n.info=Q[t][1],n.info.name=t,n.info.isBuiltIn=!0,n.info.file="built-in",e.set(t,n,{global:!0,isConstant:!0})}!function(e){const t={false:new U(!1),true:new U(!0),nil:new I,any:x.any,number:x.number,string:x.string,bool:x.bool,function:x.function,array:x.array,object:x.object,type:x.type,error:x.error,undefined:x.undefined};for(let n in t){const r=t[n];e.set(n,r,{global:!0,isConstant:!0})}}(e);const s=function(){if(z.math=new P(Math),z.Promise=new P(class{constructor(e){this.thens=[],this.resolved=!1,e((e=>{this.resolved=!0;for(let t of this.thens)t(e)}),(e=>{this.resolved=!0,this.catch_&&this.catch_(e)}))}then(e){if(!this.resolved)return this.thens.push(e),this}catch(e){if(!this.resolved)return this.catch_=e,this}}),!h){const e=(()=>{if(h)return new Ke;const e=window;return void 0!==e&&"$"in e?{$:new P(e.$,"jquery"),window:new P(e,"window"),document:new P(e.document,"document")}:new Me(n.unknown,"$ must be property of window to use dom library")})();if(e instanceof Pe)return e;J.dom=e}}();if(s)return s;e.initialisedAsGlobal=!0}class te{constructor(){this.symbolTable={},this.initialisedAsGlobal=!1,this.deleted=!1,this.path_=""}get path(){return this.path_||!this.parent?this.path_:this.parent.path}set path(e){this.path_=e}get parent(){return this.parent_}set parent(e){e!=this?this.parent_=e:console.error(q.red("Setting context parent to self"))}has(e){return void 0!==this.get(e)}hasOwn(e){return this.symbolTable[e]instanceof M}get(e){let t=this.getSymbol(e);return t instanceof Pe||null==t?t:t.value}getRawSymbolTableAsDict(){const e={};for(let t in this.symbolTable)e[t]=this.symbolTable[t].value;return e}getSymbolTableAsDict(){const e={};for(let t in this.symbolTable)e[t]=this.symbolTable[t];return e}getSymbol(e){let t=this.symbolTable[e];if(void 0!==t&&!t.isAccessible)return new We(n.unknown,"assessable","inaccessible",t.identifier);if(void 0===t&&this.parent){let r=this.parent.getSymbol(e);if(r instanceof Pe)return r;if(!r)return new Me(n.unknown,e);t=r}return t}set(e,t,n={}){let r=this;if(n.global)r=this.root;else{for(;!r.hasOwn(e)&&void 0!==r.parent;)r=r.parent;r.hasOwn(e)||(r=this)}return r.setOwn(e,t,n)}setOwn(e,t,r={}){if(t instanceof N||(t=F(t)),r.global&&!this.initialisedAsGlobal&&(r.global=!1),!r.forceThroughConst){let t=this.symbolTable[e];if(null==t?void 0:t.isConstant)return new We(n.unknown,"dynamic","constant",e)}this.symbolTable[e]=new M(t,e,r)}remove(e){delete this.symbolTable[e]}clear(){for(let e in this.symbolTable)this.remove(e);this.parent=void 0,this.deleted=!0}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get keys(){return Object.keys(this.symbolTable)}resetAsGlobal(){var e,t;if(!this.initialisedAsGlobal)return;const n=this.root.get("print"),r=this.root.get("input");n instanceof N&&r instanceof N?(this.symbolTable={},this.initialisedAsGlobal=!1,ee(this,(null===(e=n.valueOf())||void 0===e?void 0:e.func)||console.log,(null===(t=r.valueOf())||void 0===t?void 0:t.func)||(()=>{}))):console.error("Error with print and input functions.")}clone(){const e=new te;return e.parent=this.parent,e.deleted=this.deleted,e.initialisedAsGlobal=this.initialisedAsGlobal,e.symbolTable=Object.assign(Object.assign({},e.symbolTable),this.symbolTable),e}deepClone(){var e;let t=this.clone();return t.parent=null===(e=t.parent)||void 0===e?void 0:e.deepClone(),t}log(){console.log("---- CONTEXT ----");for(let e in this.symbolTable){const t=this.symbolTable[e];let n=e;t.isConstant&&(n+=" (CONST)"),t.isAccessible||(n+=" (INACCESSIBLE)"),n+=": ",n+=Re(this.symbolTable[e].value),console.log(n)}console.log("-----------------")}}function ne(e,t){var r;let s;const i=e.type.interpret(t);if(i.error)return i.error;if(!(i.val instanceof R))return new We(n.unknown,"Type",typeof i.val,i.val,"Argument can't be undefined");let o;if(s=i.val,e.defaultValue){let n=null===(r=e.defaultValue)||void 0===r?void 0:r.interpret(t);if(n.error)return n.error;n.val instanceof N&&(o=n.val)}return{name:e.name,type:s,defaultValue:o}}class re{constructor(){this.val=new I,this.shouldBreak=!1,this.shouldContinue=!1}}class se{constructor(e,t=!1){this.pos=e,this.isTerminal=t}interpret(e){var t;const r=v(),s=new re,i=this.interpret_(e);i instanceof Pe?s.error=i:i instanceof re?(s.val=i.val,s.error=i.error,s.funcReturn=i.funcReturn,s.shouldBreak=i.shouldBreak,s.shouldContinue=i.shouldContinue):s.val=i,s.error&&s.error.pos.isUnknown&&(s.error.pos=this.pos),s.val instanceof N||(s.error=new We(n.unknown,"Primitive","Native JS value",Re(s.val)),s.val=new I),(t=s.val.info).file||(t.file=this.pos.file),se.interprets++;let o=v()-r;return se.totalTime+=o,o>se.maxTime&&(se.maxTime=o),s}}se.interprets=0,se.totalTime=0,se.maxTime=0;class ie extends se{constructor(e,t,n,r){super(e),this.left=t,this.opTok=n,this.right=r}interpret_(e){const t=this.left.interpret(e);if(t.error)return t.error;const n=this.right.interpret(e);if(n.error)return n.error;const r=t.val,s=n.val;if(void 0===r)return new We(this.opTok.pos,"~undefined","undefined",r,"N_binOp.interpret_");if(void 0===s)return new We(this.opTok.pos,"~undefined","undefined",s,"N_binOp.interpret_");switch(this.opTok.type){case T.LTE:{const t=r.__lt__({context:e},s),n=r.__eq__({context:e},s);return t instanceof Pe?t:n instanceof Pe?n:t.__or__({context:e},n)}case T.GTE:{const t=r.__gt__({context:e},s),n=r.__eq__({context:e},s);return t instanceof Pe?t:n instanceof Pe?n:t.__or__({context:e},n)}case T.NOTEQUALS:{const t=r.__eq__({context:e},s);return t instanceof Pe?t:new U(!t.bool().valueOf())}case T.ADD:return r.__add__({context:e},s);case T.SUB:return r.__subtract__({context:e},s);case T.MUL:return r.__multiply__({context:e},s);case T.DIV:return r.__divide__({context:e},s);case T.POW:return r.__pow__({context:e},s);case T.EQUALS:return r.__eq__({context:e},s);case T.LT:return r.__lt__({context:e},s);case T.GT:return r.__gt__({context:e},s);case T.AND:return r.__and__({context:e},s);case T.OR:return r.__or__({context:e},s);default:return new je(this.opTok.pos,`Invalid binary operator: ${O[this.opTok.type]}`)}}}class oe extends se{constructor(e,t,n){super(e),this.a=t,this.opTok=n}interpret_(e){var t,n,r;const s=this.a.interpret(e);if(s.error)return s.error;switch(this.opTok.type){case T.SUB:case T.ADD:if(!(s.val instanceof j))return new We(this.pos,"Number",(null===(t=s.val)||void 0===t?void 0:t.typeName().toString())||"undefined_",null===(n=s.val)||void 0===n?void 0:n.valueOf());const e=s.val.valueOf();return new j(this.opTok.type===T.SUB?-e:Math.abs(e));case T.NOT:return new U(!(null===(r=null==s?void 0:s.val)||void 0===r?void 0:r.bool().valueOf()));default:return new je(this.opTok.pos,`Invalid unary operator: ${O[this.opTok.type]}`)}}}class ae extends se{constructor(e,t,n,r="=",s=!1,i=!1,o=!1,a=!1,u=x.any){super(e),this.value=n,this.varNameTok=t,this.isGlobal=s,this.assignType=r,this.isConstant=o,this.isDeclaration=a,this.isLocal=i,this.type=u instanceof R?new Ce(u):u}interpret_(e){var t,n,r,s;if(this.isDeclaration&&e.hasOwn(this.varNameTok.value))return new je(this.pos,`Symbol '${this.varNameTok.value}' already exists, and cannot be redeclared`);const i=this.value.interpret(e),o=this.type.interpret(e);if(i.error)return i.error;if(o.error)return o.error;if(!(o.val&&o.val instanceof R))return new We(this.varNameTok.pos,"Type",null!==(n=null===(t=o.val)||void 0===t?void 0:t.typeName().valueOf())&&void 0!==n?n:"undefined",null===(r=o.val)||void 0===r?void 0:r.str(),"@ !typeRes.val || !(typeRes.val instanceof ESType)");if(!i.val)return new We(this.varNameTok.pos,"~undefined","undefined","N_varAssign.interpret_");if(!o.val.includesType({context:e},i.val.__type__).bool().valueOf())return new We(this.varNameTok.pos,Re(o.val),Re(null===(s=i.val)||void 0===s?void 0:s.typeName()),Re(i.val));if(this.isDeclaration)return"="!==this.assignType?new je(this.pos,`Cannot declare variable with operator '${this.assignType}'`):(e.setOwn(this.varNameTok.value,i.val,{global:!1,isConstant:this.isConstant}),i.val);if("="===this.assignType){let t=i.val;void 0===t&&(t=new I);const n=e.set(this.varNameTok.value,t,{global:this.isGlobal,isConstant:this.isConstant});if(n instanceof Pe)return n}else{if(this.isDeclaration)return new je(this.pos,`Cannot declare variable with operator '${this.assignType}'`);const t=e.get(this.varNameTok.value);if(t instanceof Pe)return t;if(null==t)return new je(this.pos,`Cannot declare variable with operator '${this.assignType}'`);let n,r=i.val;switch(this.assignType[0]){case"*":n=t.__multiply__({context:e},r);break;case"/":n=t.__divide__({context:e},r);break;case"+":n=t.__add__({context:e},r);break;case"-":n=t.__subtract__({context:e},r);break;default:return new Pe(this.pos,"AssignError",`Cannot find assignType of ${this.assignType[0]}`)}if(n instanceof Pe)return n;let s=e.set(this.varNameTok.value,n,{global:this.isGlobal,isConstant:this.isConstant});if(s instanceof Pe)return s;i.val=n}return"(anonymous)"!==i.val.info.name&&i.val.info.name||(i.val.info.name=this.varNameTok.value),i}}class ue extends se{constructor(e,t,n,r){super(e),this.comparison=t,this.ifFalse=r,this.ifTrue=n}interpret_(e){var t;let n=new te;n.parent=e;let r=new re,s=this.comparison.interpret(e);if(s.error)return s;if(null===(t=s.val)||void 0===t?void 0:t.bool().valueOf()){if(r=this.ifTrue.interpret(n),r.val=new I,r.error)return r}else if(this.ifFalse&&(r=this.ifFalse.interpret(n),r.val=new I,r.error))return r;return r}}class ce extends se{constructor(e,t,n){super(e),this.comparison=t,this.loop=n}interpret_(e){var t,n;let r=new te;for(r.parent=e;;){let s=this.comparison.interpret(e);if(s.error)return s;if(!(null===(n=null===(t=s.val)||void 0===t?void 0:t.bool())||void 0===n?void 0:n.valueOf()))break;let i=this.loop.interpret(r);if(i.error)return i;if(i.shouldBreak)break}return new I}}class le extends se{constructor(e,t,n,r,s,i){super(e),this.body=t,this.array=n,this.identifier=r,this.isGlobalId=s,this.isConstId=i}interpret_(e){var t,n,r,s,i,o,a,u;let c=new te;c.parent=e;const l=this.array.interpret(e);if(l.error)return l;if(-1===["Array","Number","Object","String","Any"].indexOf((null===(t=l.val)||void 0===t?void 0:t.typeName().valueOf())||""))return new We(this.identifier.pos,"Array | Number | Object | String",typeof l.val+" | "+(null===(n=l.val)||void 0===n?void 0:n.typeName()));function h(e,t,n,r,s){c.set(t,n,{global:r,isConstant:s});const i=e.interpret(c);return i.error||void 0!==i.funcReturn?i:i.shouldBreak?(i.shouldBreak=!1,"break"):void(i.shouldContinue&&(i.shouldContinue=!1))}if(l.val instanceof j||"number"==typeof(null===(r=l.val)||void 0===r?void 0:r.valueOf()))for(let e=0;e<l.val.valueOf();e++){const t=h(this.body,this.identifier.value,new j(e),this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}else if(l.val instanceof $||"number"==typeof(null===(s=l.val)||void 0===s?void 0:s.valueOf())&&!Array.isArray(null===(i=l.val)||void 0===i?void 0:i.valueOf()))for(let e in null===(o=l.val)||void 0===o?void 0:o.valueOf()){const t=h(this.body,this.identifier.value,new L(e),this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}else{if(!(l.val instanceof W||Array.isArray(null===(a=l.val)||void 0===a?void 0:a.valueOf())))return new We(this.identifier.pos,"Array | Number | Object | String",typeof l.val);for(let e of null===(u=l.val)||void 0===u?void 0:u.valueOf()){const t=h(this.body,this.identifier.value,e,this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}}return new I}}class he extends se{constructor(e,t,n=!1){super(e),this.items=t,this.shouldClone=n}interpret_(e){let t=new re,n=[];for(let t of this.items){const r=t.interpret(e);if(r.error||void 0!==r.funcReturn)return r;if(!r.val)continue;let s=r.val;this.shouldClone&&(s=s.clone()),n.push(s)}return t.val=new W(n),t}}class fe extends se{constructor(e,t){super(e),this.properties=t}interpret_(e){let t={};for(const[n,r]of this.properties){const s=r.interpret(e);if(s.error)return s.error;const i=n.interpret(e);if(i.error)return i.error;i.val&&s.val&&(t[i.val.valueOf()]=s.val)}return new $(t)}}class _e extends se{constructor(e){super(e)}interpret_(e){return new $({})}}class pe extends se{constructor(e,t){super(e),this.items=t}interpret_(e){let t;for(let n of this.items){const r=n.interpret(e);if(r.error||void 0!==r.funcReturn||r.shouldBreak||r.shouldContinue)return r;t=r.val}return t||new I}}class de extends se{constructor(e,t,n){super(e),this.arguments=n,this.to=t}interpret_(e){let{val:t,error:n}=this.to.interpret(e);if(n)return n;if(!t)return new We(this.pos,"any","undefined",void 0,"On function call");let r=[];for(let t of this.arguments){const n=t.interpret(e);if(n.error)return n.error;n.val&&r.push(n.val)}const s=t.__call__({context:e},...r);return s instanceof Pe&&s.traceback.push({position:this.pos,line:`${t.info.name||"<AnonFunction>"}(${r.map(Re).join(", ")})`}),s}}class ve extends se{constructor(e,t,n,r,s="(anon)",i=new $,o=""){super(e),this.arguments=n,this.body=t,this.name=s,this.this_=i,this.returnType=r,this.description=o}interpret_(e){var t,n,r;let s=[];for(let t of this.arguments){const n=ne(t,e);if(n instanceof Pe)return n;s.push(n)}const i=this.returnType.interpret(e);return i.error?i.error:i.val instanceof R?new B(this.body,s,this.name,this.this_,i.val,e):new We(this.returnType.pos,"Type",null!==(n=null===(t=i.val)||void 0===t?void 0:t.typeName().valueOf())&&void 0!==n?n:"<Undefined>",null===(r=i.val)||void 0===r?void 0:r.str().valueOf(),`On func '${this.name}' return type`)}}class we extends se{constructor(e,t){super(e),this.value=t}interpret_(e){const t=new re;if(void 0===this.value)return t.funcReturn=new I,t;let n=this.value.interpret(e);return n.error?n.error:(t.funcReturn=n.val,t)}}class ye extends se{constructor(e,t){super(e),this.value=t}interpret_(e){var t;const n=new re;if(void 0===this.value)return n.funcReturn=new I,n;let r=this.value.interpret(e);return r.error?r.error:((null===(t=r.val)||void 0===t?void 0:t.bool().valueOf())&&(n.funcReturn=r.val),n)}}class me extends se{constructor(e,t,n){super(e),this.base=t,this.index=n}interpret_(e){var t;let n=this.base.interpret(e);if(n.error)return n;let r=this.index.interpret(e);if(r.error)return r;const s=r.val,i=n.val;if(!i||!s)return new I;if(void 0!==this.value){let n=this.value.interpret(e);if(n.error)return n;const r=F(i.__getProperty__({context:e},s));let o,a=n.val;if(null!==(t=this.assignType)&&void 0!==t||(this.assignType="="),!a)return new We(this.pos,"~undefined","undefined","undefined","N_indexed.interpret_");switch(this.assignType[0]){case"*":o=r.__multiply__({context:e},a);break;case"/":o=r.__divide__({context:e},a);break;case"+":o=r.__add__({context:e},a);break;case"-":o=r.__subtract__({context:e},a);break;case"=":o=a;break;default:return new Pe(this.pos,"AssignError",`Cannot find assignType of ${this.assignType[0]}`)}if(o instanceof Pe)return o;if(!i.__setProperty__)return new We(this.pos,"mutable","immutable",i.valueOf());const u=i.__setProperty__({context:e},s,null!=o?o:new I);if(u instanceof Pe)return u}return i.__getProperty__({context:e},s)}}class Te extends se{constructor(e,t,n,r,s="<anon class>"){super(e),this.init=r,this.methods=t,this.name=s,this.extends_=n,this.instances=[]}interpret_(e){var t,n,r;const s=[];for(let n of this.methods){const r=n.interpret(e);if(r.error)return r.error;if(!(r.val instanceof B))return new We(this.pos,"Function",(null===(t=r.val)||void 0===t?void 0:t.typeName().valueOf())||"undefined","method on "+this.name);s.push(r.val)}let i,o;if(this.extends_){const t=this.extends_.interpret(e);if(t.error)return t.error;if(!(t.val instanceof R))return new We(this.pos,"Function",(null===(n=t.val)||void 0===n?void 0:n.typeName().valueOf())||"undefined","method on "+this.name);i=t.val}if(this.init){const t=this.init.interpret(e);if(t.error)return t.error;if(!(t.val instanceof B))return new We(this.pos,"Function",(null===(r=t.val)||void 0===r?void 0:r.typeName().valueOf())||"undefined","method on "+this.name);o=t.val}return new R(!1,this.name,s,i,o)}}class Oe extends se{constructor(e,t,n="(anon)",r=!1){super(e),this.name=n,this.statements=t,this.mutable=r}interpret_(e){const t=new te;t.parent=e;const n=this.statements.interpret(t);return n.error?n:new D(new L(this.name),t.getSymbolTableAsDict(),this.mutable)}}class be extends se{constructor(e,t){super(e,!0),this.a=t}interpret_(e){let t=this.a.value;if("number"!=typeof t)return new We(this.pos,"number",typeof t);const n=new re;return n.val=new j(t),n}}class ke extends se{constructor(e,t){super(e,!0),this.a=t}interpret_(e){let t=this.a.value;if("string"!=typeof t)return new We(this.pos,"string",typeof t);const n=new re;return n.val=new L(t),n}}class Ee extends se{constructor(e){super(e.pos,!0),this.a=e}interpret_(e){if(!e.has(this.a.value))return new Me(this.a.pos,this.a.value);let t=new re,n=e.getSymbol(this.a.value);return n?n instanceof Pe?n:(t.val=n.value,t):new I}}class ge extends se{constructor(e=n.unknown){super(e,!0)}interpret_(e){const t=new re;return t.val=new I,t}}class xe extends se{constructor(e){super(e,!0)}interpret_(e){const t=new re;return t.shouldBreak=!0,t}}class Ne extends se{constructor(e){super(e,!0)}interpret_(e){const t=new re;return t.shouldContinue=!0,t}}class Ce extends se{constructor(e,t=n.unknown){super(t,!0),this.value=e}interpret_(e){return this.value}}class Se extends se{constructor(e,t,n){super(e,!0),this.body=t,this.catchBlock=n}interpret_(e){const t=this.body.interpret(e);if(t.error){const n=new te;n.parent=e,n.setOwn(p,new C(t.error),{isConstant:!0});const r=this.catchBlock.interpret(n);if(r.error)return r.error}return new re}}function Ae(e,t=new WeakMap){let n;if(Object(e)!==e||e instanceof Function)return e;if(t.has(e))return t.get(e);try{n=new e.constructor}catch(t){n=Object.create(Object.getPrototypeOf(e))}return e instanceof Map?Array.from(e,(([e,r])=>n.set(Ae(e,t),Ae(r,t)))):e instanceof Set&&Array.from(e,(e=>n.add(Ae(e,t)))),t.set(e,n),Object.assign(n,...Object.keys(e).map((n=>({[n]:Ae(e[n],t)}))))}function Re(e,t=0){if("string"==typeof e)return t>0?`'${e}'`:e;if(t>20)return"...";let n="";if(void 0===e)return"undefined";if(e instanceof N)return e.str().valueOf();if(e instanceof se)return`<RunTimeNode: ${e.constructor.name}>`;switch(typeof e){case"object":if(Array.isArray(e)){n+="[";for(let r of e)try{n+=Re(r,t+1)+", "}catch(e){n+="<large property>, "}e.length&&(n=n.substring(0,n.length-2)),n+="]"}else{try{n+=e.constructor.name}catch(e){n+="UNKNOWN_CONSTRUCTOR"}n+=": {\n";let r=0;for(let s in e)r++,e.hasOwnProperty&&e.hasOwnProperty(s)&&(n+=`  ${s}: ${Re(e[s],t+1)||""}, \n`);r>0&&(n=n.substring(0,n.length-3)),n+="\n}\n"}break;case"string":n=`'${e}'`;break;case"bigint":case"number":case"boolean":n=`${e}`;break;case"undefined":n="<NativeUndefined>";break;case"function":n=`<NativeFunction ${e.name}>`}for(let e=0;e<t;e++)n=$e(n);return n}const Ie=e=>new Promise((t=>setTimeout((()=>t()),e)));function $e(e){return e.replace(/\n/g,"\n    ")}const De=e=>/^(?:(?:(?:https?|ftp):)?\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,})))(?::\d{2,5})?(?:[/?#]\S*)?$/i.test(e);class Pe{constructor(e,t,n){this.traceback=[],this.pos=e,this.name=t,this.details=n}get colouredStr(){let e="";if(this.traceback.length){e=q.yellow("Error Traceback (most recent call last):\n");for(let t of[...this.traceback].reverse())e+=`    ${q.cyan(t.position.str)}:\n        ${t.line}\n`}return e+=`${q.red(this.name)}: ${this.details} \n at ${q.cyan(this.pos.str)}`,e}get str(){return`${this.name}: ${this.details} \n at ${this.pos.str}`}}class Be extends Pe{constructor(e,t){super(e,"IllegalCharError",`'${t}'`)}}class je extends Pe{constructor(e,t){super(e,"InvalidSyntaxError",t)}}class Ue extends Pe{constructor(e,t){super(e,"ExpectedCharError",`'${t}'`)}}class We extends Pe{constructor(e,t,n,r="",s=""){super(e,"TypeError",`Expected type '${t}', got type '${n}' ${void 0===r?"":` on value '${Re(r)}'`} ${s||""}`)}}class Le extends Pe{constructor(e,t,n=""){super(e,"ImportError",`Could not import ${t}: ${n}`)}}class Me extends Pe{constructor(e,t){super(e,"ReferenceError",`${t} is not defined`)}}class Fe extends Pe{constructor(e,t,n){var r;super(e,"IndexError",`'${t}' is not a property of '${(null===(r=null==n?void 0:n.info)||void 0===r?void 0:r.name)||Re(n)}'`)}}class Ge extends Pe{constructor(e,t,r="",s=n.unknown){var i;super(s,"TypeError",`Cannot perform '${e}' on value ${(null===(i=null==t?void 0:t.info)||void 0===i?void 0:i.name)||Re(t)}: ${r}`)}}class Ke extends Pe{constructor(){super(n.unknown,"InvalidRuntimeError","Required runtime of "+(h?"browser":"node"))}}class Ye extends Pe{constructor(e){super(n.unknown,"TestFailed",e)}}class qe{constructor(e,t,n){this.type=t,this.value=n,this.pos=e}matches(e,t){return this.type===e&&this.value===t}}class Qe{constructor(e,t){this.text=e,this.position=new n(-1,0,-1,t),this.advance()}advance(){this.position.advance(this.currentChar),this.currentChar=this.text[this.position.idx]}generate(){if(!this.text)return[new qe(this.position,T.EOF)];const e=[];for(;void 0!==this.currentChar;)if(" \t\n".includes(this.currentChar))this.advance();else if(r.includes(this.currentChar))e.push(this.makeNumber());else if(this.currentChar===i[0]&&this.text[this.position.idx+1]===i[1])this.singleLineComment();else if(this.currentChar===o[0]&&this.text[this.position.idx+1]===o[1])this.multiLineComment();else if(s.includes(this.currentChar))e.push(this.makeIdentifier());else if(-1!==l.indexOf(this.currentChar))e.push(this.makeString());else{const t=this.currentChar;let n=this.unknownChar();if(!n){let e=this.position.clone,t=this.currentChar;return this.advance(),new Be(e,t)}n.type===T.ASSIGN&&(n.value=t),e.push(n)}return e.push(new qe(this.position,T.EOF)),e}makeNumber(){const e=this.position.clone;let t="",n=0;for(;void 0!==this.currentChar&&(r+"._").includes(this.currentChar);){if("."===this.currentChar){if(1===n)break;n++,t+="."}else"_"!==this.currentChar&&(t+=this.currentChar);this.advance()}return new qe(e,T.NUMBER,parseFloat(t))}makeString(){const e=this.position.clone;let t="",n=this.currentChar;for(this.advance();this.currentChar!==n&&void 0!==this.currentChar;)"\\"!==this.currentChar||(this.advance(),"n"!==this.currentChar)?(t+=this.currentChar,this.advance()):(t+="\n",this.advance());return this.advance(),new qe(e,T.STRING,t)}makeIdentifier(){let e="";const t=this.position.clone;for(;void 0!==this.currentChar&&(s+r).includes(this.currentChar);)e+=this.currentChar,this.advance();let n=T.IDENTIFIER;return-1!==d.indexOf(e)&&(n=T.KEYWORD),new qe(t,n,e)}unknownChar(){if(void 0!==this.currentChar){for(let e in E)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]&&e[2]===this.text[this.position.idx+2]){const t=this.position.clone;return this.advance(),this.advance(),this.advance(),new qe(t,E[e])}for(let e in k)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]){const t=this.position.clone;return this.advance(),this.advance(),new qe(t,k[e])}if(b.hasOwnProperty(this.currentChar)){let e=this.position.clone,t=b[this.currentChar];return this.advance(),new qe(e,t)}}}singleLineComment(){for(this.advance();"\n"!==this.currentChar&&void 0!==this.currentChar;)this.advance();this.advance()}multiLineComment(){for(this.advance();this.currentChar!==a[0]||this.text[this.position.idx+1]!==a[1];)this.advance();this.advance(),this.advance()}}class Ve{constructor(){this.advanceCount=0,this.lastRegisteredAdvanceCount=0,this.reverseCount=0}registerAdvance(){this.advanceCount=1,this.lastRegisteredAdvanceCount++}register(e){return this.lastRegisteredAdvanceCount=e.advanceCount,this.advanceCount+=e.advanceCount,e.error&&(this.error=e.error),e.node?e.node:new ge}tryRegister(e){if(!e.error)return this.register(e);this.reverseCount+=e.advanceCount}success(e){return this.node=e,this}failure(e){return this.error=e,this}}class Je{constructor(e){this.tokens=e,this.tokenIdx=-1,this.currentToken=e[0],this.advance()}parse(){var e;if(!this.currentToken||!this.tokens||1===this.tokens.length&&this.tokens[0].type===T.EOF)return new Ve;const t=this.statements(!0);return t.error||this.currentToken.type===m.EOF?t:t.failure(new je(null===(e=this.currentToken)||void 0===e?void 0:e.pos,`Expected 'End of File', got token of type'${O[this.currentToken.type]}' of value ${this.currentToken.value}`))}advance(e){return e&&e.registerAdvance(),this.tokenIdx++,this.currentToken=this.tokens[this.tokenIdx],this.currentToken}reverse(e=1){return this.tokenIdx-=e,this.currentToken=this.tokens[this.tokenIdx],this.currentToken}consume(e,t,n){if(this.currentToken.type!==t)return e.failure(new je(this.currentToken.pos,null!=n?n:`Expected '${O[t]}' but got '${O[this.currentToken.type]}'`));this.advance(e)}clearEndStatements(e){for(;this.currentToken.type===T.ENDSTATEMENT;)this.advance(e)}statements(e=!1){const t=new Ve,n=this.currentToken.pos;let r=[];this.clearEndStatements(t);const s=t.register(this.statement());if(!s)return t;if(r.push(s),t.error)return t;let i=!0;for(;;){let e=0;for(;this.currentToken.type===T.ENDSTATEMENT;)this.advance(t),e++;if(0===e&&(i=!1),!i)break;const n=t.tryRegister(this.statement());n?r.push(n):this.reverse(t.reverseCount)}this.clearEndStatements(t);let o=new pe(n,r);return e&&(o=new he(n,r,!0)),t.success(o)}statement(){const e=new Ve,t=this.currentToken.pos;if(this.currentToken.matches(T.KEYWORD,"return")){this.advance(e);let n=new ge(this.currentToken.pos);if(this.currentToken.type!==T.ENDSTATEMENT){let t=e.register(this.expr());if(!t)return e.failure(new je(this.currentToken.pos,"Expected end of statement"));n=t}return e.success(new we(t,n))}if(this.currentToken.matches(T.KEYWORD,"yield")){this.advance(e);let n=new ge(this.currentToken.pos);if(this.currentToken.type!==T.ENDSTATEMENT){let t=e.register(this.expr());if(!t)return e.failure(new je(this.currentToken.pos,"Expected end of statement"));n=t}return e.success(new ye(t,n))}if(this.currentToken.matches(T.KEYWORD,"break"))return this.advance(e),e.success(new xe(t));if(this.currentToken.matches(T.KEYWORD,"continue"))return this.advance(e),e.success(new Ne(t));if(this.currentToken.matches(T.KEYWORD,"try"))return this.tryCatch();const n=e.register(this.expr());return e.error?e:e.success(n)}atom(){const e=new Ve,t=this.currentToken,n=this.currentToken.pos;switch(t.type){case T.NUMBER:return this.advance(e),e.success(new be(n,t));case T.STRING:return this.advance(e),e.success(new ke(n,t));case T.IDENTIFIER:return this.atomIdentifier(e,n,t);case T.OPAREN:this.advance(e);const r=e.register(this.expr());return e.error?e:this.currentToken.type==T.CPAREN?(this.advance(e),e.success(r)):e.failure(new je(this.currentToken.pos,"Expected ')'"));case T.OSQUARE:let s=e.register(this.array());return e.error?e:e.success(s);case T.OBRACES:let i=e.register(this.object());return e.error?e:e.success(i);case T.KEYWORD:if("if"===t.value){const t=e.register(this.ifExpr());return e.error?e:e.success(t)}return e.failure(new je(this.currentToken.pos,`Invalid Identifier ${t.value}`));default:return e.failure(new je(this.currentToken.pos,"Expected number, identifier, '(', '+' or '-'"))}}atomIdentifier(e,t,n){this.advance(e);let r=new Ee(n),s=new ge(t),i=!1;for(;-1!==[T.OPAREN,T.OSQUARE,T.DOT].indexOf(this.currentToken.type);)switch(this.currentToken.type){case T.OPAREN:i=!0;const t=r;if(r=e.register(this.makeFunctionCall(r,s)),s=t,e.error)return e;break;case T.OSQUARE:if(s=r,r=e.register(this.makeIndex(r)),e.error)return e;break;case T.DOT:if(this.advance(e),this.currentToken.type!==T.IDENTIFIER)return e.failure(new je(this.currentToken.pos,"Expected identifier after '.'"));s=r,r=new me(this.currentToken.pos,r,new ke(this.currentToken.pos,this.currentToken)),this.advance(e)}if(this.currentToken.type===T.ASSIGN){let n=this.currentToken.value;if(i)return e.failure(new je(t,"Cannot assign to return value of function"));this.advance(e);const s=e.register(this.expr());if(r instanceof Ee)r=new ae(t,r.a,s,n,!1);else{if(!(r instanceof me))return e.failure(new je(t,`Cannot have node of type ${this.currentToken.constructor.name}.\n                            Expected either index or variable node.`));r.value=s,r.assignType=n}if(e.error)return e}return e.success(r)}power(){return this.binOp((()=>this.atom()),[m.POW],(()=>this.factor()))}factor(){const e=new Ve,t=this.currentToken;switch(t.type){case T.SUB:case T.ADD:this.advance(e);const n=e.register(this.factor());return e.error?e:e.success(new oe(t.pos,n,t));default:return this.power()}}term(){return this.binOp((()=>this.factor()),[T.MUL,T.DIV])}arithmeticExpr(){return this.binOp((()=>this.term()),[T.ADD,T.SUB])}comparisonExpr(){const e=new Ve;if(this.currentToken.type===T.NOT){const t=this.currentToken;this.advance(e);let n=e.register(this.expr());return e.error?e:e.success(new oe(t.pos,n,t))}let t=e.register(this.binOp((()=>this.arithmeticExpr()),[T.EQUALS,T.NOTEQUALS,T.GT,T.GTE,T.LTE,T.LT]));return e.error?e:e.success(t)}expr(){const e=new Ve;if(this.clearEndStatements(e),this.currentToken.type===T.KEYWORD&&-1!==["var","let","global","mutable","const","local"].indexOf(this.currentToken.value))return this.initiateVar(e);if(this.currentToken.matches(m.KEYWORD,"if"))return this.ifExpr();if(this.currentToken.matches(m.KEYWORD,"while"))return this.whileExpr();if(this.currentToken.matches(m.KEYWORD,"for"))return this.forExpr();if(this.currentToken.matches(m.KEYWORD,"func"))return this.funcExpr();if(this.currentToken.matches(m.KEYWORD,"class"))return this.classExpr();if(this.currentToken.matches(m.KEYWORD,"namespace"))return this.namespace();let t=e.register(this.binOp((()=>this.comparisonExpr()),[T.AND,T.OR]));return e.error?e:e.success(t)}binOp(e,t,n=e){const r=new Ve;let s=r.register(e());if(r.error)return r;for(;-1!==t.indexOf(this.currentToken.type)||-1!==t.indexOf([this.currentToken.type,this.currentToken.value]);){const e=this.currentToken;this.advance(r);const t=r.register(n());if(r.error)return r;s=new ie(s.pos,s,e,t)}return r.success(s)}typeExpr(){const e=new Ve;if(this.currentToken.type!==T.IDENTIFIER)return e.failure(new je(this.currentToken.pos.clone,"Expected an identifier"));let t=this.currentToken;return this.advance(e),e.success(new Ee(t))}makeFunctionCall(e,t=new ge){const n=new Ve;let r=[];const s=this.currentToken.pos;if(this.currentToken.type!==T.OPAREN)return n.failure(new je(s,"Expected '['"));if(this.advance(n),this.currentToken.type===T.CPAREN)return this.advance(n),n.success(new de(s,e,[]));if(r.push(n.register(this.expr())),n.error)return n.failure(new je(this.currentToken.pos,"Invalid argument"));for(;this.currentToken.type===T.COMMA;)if(this.advance(n),r.push(n.register(this.expr())),n.error)return n;return this.currentToken.type!==T.CPAREN?n.failure(new je(this.currentToken.pos,"Expected ',' or ')'")):(this.advance(n),n.success(new de(s,e,r)))}makeIndex(e){const t=new Ve,n=this.currentToken.pos,r=e;if(this.currentToken.type!==T.OSQUARE)return t.failure(new je(n,"Expected '["));if(this.advance(t),this.currentToken.type===T.CSQUARE)return t.failure(new je(n,"Cannot index without expression"));let s=t.register(this.expr());return t.error?t.failure(new je(this.currentToken.pos,"Invalid index")):this.currentToken.type!==T.CSQUARE?t.failure(new je(this.currentToken.pos,"Expected ']'")):(this.advance(t),t.success(new me(n,r,s)))}initiateVar(e){let t=this.currentToken.pos,n=!1,r=!1,s=!1,i=!1;if(this.currentToken.type===T.KEYWORD&&-1!==["var","let"].indexOf(this.currentToken.value)&&(i=!0,r=!0,this.advance(e),e.error))return e;if(this.currentToken.type===T.KEYWORD&&-1!==["global","local"].indexOf(this.currentToken.value)&&(i=!0,"global"===this.currentToken.value?s=!0:r=!0,this.advance(e),e.error))return e;if(this.currentToken.type===T.KEYWORD&&-1!==["const","mutable"].indexOf(this.currentToken.value)&&(i=!0,"const"===this.currentToken.value&&(n=!0),this.advance(e),e.error))return e;if(this.currentToken.type===T.KEYWORD)return e.failure(new je(this.currentToken.pos,`Expected Identifier 'var', 'let', 'const', 'mutable', 'local', or 'global', not ${this.currentToken.value}`));if(this.currentToken.type!==m.IDENTIFIER)return e.failure(new je(this.currentToken.pos,"Expected Identifier or Keyword"));const o=this.currentToken;this.advance(e);let a=x.any;if(this.currentToken.type===T.COLON&&(i=!0,this.consume(e,T.COLON),a=e.register(this.typeExpr())),this.currentToken.type!==T.ASSIGN)return n?e.failure(new je(t,"Cannot initialise constant to undefined")):e.success(new ae(t,o,new ge(this.currentToken.pos),"=",s,r,n,i,a));let u=this.currentToken.value;this.advance(e);const c=e.register(this.expr());return e.error?e:((c instanceof Te||c instanceof ve)&&(c.name=o.value),c instanceof Oe&&(c.name=o.value,c.mutable=!n),e.success(new ae(t,o,c,u,s,r,n,i,a)))}bracesExp(){const e=new Ve;if(this.consume(e,T.OBRACES),e.error)return e;if(this.clearEndStatements(e),this.currentToken.type===T.CBRACES)return this.advance(e),e.success(new ge(this.currentToken.pos));const t=e.register(this.statements());return e.error?e:(this.consume(e,T.CBRACES),e.error?e:e.success(t))}addEndStatement(e){this.tokens.splice(this.tokenIdx,0,new qe(this.currentToken.pos,T.ENDSTATEMENT)),this.reverse(),this.advance(e)}ifExpr(){const e=new Ve;let t,n,r;const s=this.currentToken.pos;if(!this.currentToken.matches(T.KEYWORD,"if"))return e.failure(new je(this.currentToken.pos,"Expected 'if'"));if(this.advance(e),r=e.register(this.expr()),e.error)return e;if(t=e.register(this.bracesExp()),e.error)return e;if(this.clearEndStatements(e),this.currentToken.matches(T.KEYWORD,"else"))if(this.advance(e),this.currentToken.type==T.OBRACES){if(n=e.register(this.bracesExp()),e.error)return e}else if(n=e.register(this.statement()),e.error)return e;return this.addEndStatement(e),e.success(new ue(s,r,t,n))}whileExpr(){const e=new Ve;let t,n;const r=this.currentToken.pos;return this.currentToken.matches(T.KEYWORD,"while")?(this.advance(e),n=e.register(this.expr()),e.error?e:(t=e.register(this.bracesExp()),e.error?e:(this.addEndStatement(e),e.success(new ce(r,n,t))))):e.failure(new je(this.currentToken.pos,"Expected 'while'"))}parameter(e){let t,n=new Ce(x.any);if(this.currentToken.type!==T.IDENTIFIER)return new je(this.currentToken.pos,"Expected identifier");if(t=this.currentToken.value,this.advance(e),this.currentToken.type===T.COLON){if(this.consume(e,T.COLON),e.error)return e.error;if(n=e.register(this.typeExpr()),e.error)return e.error}return{name:t,type:n}}funcCore(){const e=new Ve,t=this.currentToken.pos;let n,r=[],s=new Ce(x.any);if(this.consume(e,T.OPAREN),this.currentToken.type===T.CPAREN)this.advance(e);else{let t=this.parameter(e);if(t instanceof Pe)return e.failure(t);for(r.push(t);this.currentToken.type===T.COMMA;){this.advance(e);let t=this.parameter(e);if(t instanceof Pe)return e.failure(t);r.push(t)}if(this.currentToken.type!==T.CPAREN)return e.failure(new je(this.currentToken.pos,"Expected ',' or ')'"));this.advance(e)}if(this.currentToken.type===T.COLON&&(this.advance(e),s=e.register(this.typeExpr()),e.error))return e;if(this.currentToken.type!==T.OBRACES){if(n=new we(this.currentToken.pos,e.register(this.expr())),e.error)return e}else{if(this.consume(e,T.OBRACES),e.error)return e;if(n=this.currentToken.type!==T.CBRACES?e.register(this.statements()):new ge(this.currentToken.pos),this.consume(e,T.CBRACES),e.error)return e}return e.success(new ve(t,n,r,s))}funcExpr(){const e=new Ve;if(!this.currentToken.matches(T.KEYWORD,"func"))return e.failure(new je(this.currentToken.pos,"Expected 'func'"));this.advance(e);const t=e.register(this.funcCore());return e.error?e:e.success(t)}classExpr(e){const t=new Ve,n=this.currentToken.pos,r=[];let s,i;if(!this.currentToken.matches(T.KEYWORD,"class"))return t.failure(new je(this.currentToken.pos,"Expected 'class'"));if(this.advance(t),this.currentToken.matches(T.KEYWORD,"extends")&&(this.advance(t),i=t.register(this.expr()),t.error))return t;if(this.consume(t,T.OBRACES),t.error)return t;if(this.currentToken.type===T.CBRACES)return this.advance(t),t.success(new Te(n,[],void 0,void 0,e));for(;this.currentToken.type===T.IDENTIFIER;){let e=this.currentToken.value;this.advance(t);const n=t.register(this.funcCore());if(t.error)return t;if(!(n instanceof ve))return t.failure(new Pe(this.currentToken.pos,"ParseError",`Tried to get function, but got ${n} instead`));n.name=e,"init"===e?s=n:r.push(n)}return this.consume(t,T.CBRACES),t.success(new Te(n,r,i,s,e))}forExpr(){const e=new Ve,t=this.currentToken.pos;let n,r,s,i=!1,o=!1;return this.currentToken.matches(T.KEYWORD,"for")?(this.advance(e),this.currentToken.matches(T.KEYWORD,"global")?(i=!0,this.advance(e)):this.currentToken.matches(T.KEYWORD,"const")?(o=!0,this.advance(e)):(this.currentToken.matches(T.KEYWORD,"var")||this.currentToken.matches(T.KEYWORD,"let"))&&this.advance(e),this.currentToken.type!==T.IDENTIFIER?e.failure(new je(this.currentToken.pos,"Expected identifier")):(s=this.currentToken,this.advance(e),this.currentToken.matches(T.KEYWORD,"in")?(this.advance(e),r=e.register(this.expr()),e.error?e:(n=e.register(this.bracesExp()),e.error?e:(this.addEndStatement(e),e.error?e:e.success(new le(t,n,r,s,i,o))))):e.failure(new je(this.currentToken.pos,"Expected keyword 'in")))):e.failure(new je(this.currentToken.pos,"Expected 'for'"))}array(){const e=new Ve;let t=[];const n=this.currentToken.pos;if(this.currentToken.type!==T.OSQUARE)return e.failure(new je(n,"Expected '["));if(this.advance(e),this.currentToken.type===T.CSQUARE)return this.advance(e),e.success(new he(n,[]));if(t.push(e.register(this.expr())),e.error)return e.failure(new je(this.currentToken.pos,"Expected ']', 'var', 'if', 'for', 'while', number, identifier, '+', '-', '(', '[' or '!' 2"));for(;this.currentToken.type===T.COMMA;)if(this.advance(e),t.push(e.register(this.expr())),e.error)return e;return this.currentToken.type!==T.CSQUARE?e.failure(new je(this.currentToken.pos,"Expected ',' or ']'")):(this.advance(e),e.success(new he(n,t)))}object(){const e=new Ve;let t=[];const n=this.currentToken.pos;if(this.currentToken.type!==T.OBRACES)return e.failure(new je(n,"Expected '{"));if(this.advance(e),this.currentToken.type===T.CBRACES)return this.advance(e),e.success(new _e(n));for(;;){let n,r,s;if(this.currentToken.type===T.IDENTIFIER)n="id",r=new ke(this.currentToken.pos,this.currentToken),this.advance(e);else if(this.currentToken.type===T.STRING)n="string",r=new ke(this.currentToken.pos,this.currentToken),this.advance(e);else{if(this.currentToken.type!==T.OSQUARE)break;if(n="value",this.advance(e),r=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==T.CSQUARE)return e.failure(new je(this.currentToken.pos,`Expected ']', got '${O[this.currentToken.type]}'`));this.advance(e)}if(this.currentToken.type===T.COLON){if(this.advance(e),s=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==T.COMMA&&this.currentToken.type!==T.CBRACES)return e.failure(new je(this.currentToken.pos,`Expected ',' or '}', got '${O[this.currentToken.type]}'`));this.currentToken.type===T.COMMA&&this.advance(e)}else{if(this.currentToken.type!==T.COMMA&&this.currentToken.type!==T.CBRACES)return e.failure(new je(this.currentToken.pos,`Expected ',' or '}', got '${O[this.currentToken.type]}'`));if("id"!==n)return e.failure(new je(this.currentToken.pos,"You must specify a value when initialising an object literal with a key that is not an identifier.\n                        Try using `key: value` syntax."));this.reverse(),s=new Ee(this.currentToken),this.advance(e),this.currentToken.type===T.COMMA&&this.advance(e)}if(t.push([r,s]),e.error)return e}return this.currentToken.type!==T.CBRACES?e.failure(new je(this.currentToken.pos,"Expected identifier, ',' or '}'")):(this.advance(e),e.success(new fe(n,t)))}namespace(){const e=new Ve,t=this.currentToken.pos;if(this.consume(e,T.KEYWORD),e.error)return e;if(this.consume(e,T.OBRACES),e.error)return e;if(this.currentToken.type===T.CBRACES)return this.advance(e),e.success(new Oe(t,new ge));const n=e.register(this.statements());return e.error?e:(this.consume(e,T.CBRACES),e.error?e:e.success(new Oe(t,n)))}tryCatch(){const e=new Ve;if(this.consume(e,T.KEYWORD),e.error)return e;if(this.consume(e,T.OBRACES),e.error)return e;if(this.currentToken.type===T.CBRACES)return e.failure(new je(this.currentToken.pos,"No empty try block"));const t=e.register(this.statements());if(e.error)return e;if(this.consume(e,T.CBRACES),e.error)return e;if("catch"!==this.currentToken.value)return e.failure(new je(this.currentToken.pos,"try block requires catch"));if(this.consume(e,T.KEYWORD),e.error)return e;if(this.consume(e,T.OBRACES),e.error)return e;if(this.currentToken.type===T.CBRACES)return e.success(new Se(this.currentToken.pos,t,new ge));const n=e.register(this.statements());return e.error?e:(this.consume(e,T.CBRACES),e.error?e:(this.addEndStatement(e),e.error?e:e.success(new Se(this.currentToken.pos,t,n))))}}function ze(e=console.log,t,r=!0,s={print:console.log},i=new te,o=""){var a,l,h,p,d;return l=this,h=void 0,d=function*(){const l=ee(i,e,t);if(l instanceof Pe)return l;c(i),null!==(a=s.context)&&void 0!==a||(s.context=i),o&&(i.path=o),s.print&&(_.print=s.print),r&&(f(),yield w(!0),function(e,t){const{fs:r,path:s}=e;for(let t in e)e.hasOwnProperty(t)&&(i=t,o=new P(e[t],t),function(e,t){J[e]={},z[e]=t}(i,H(F(o),i)));var i,o;t.set("import",new B((({context:e},t)=>{let i=Re(t);if(X(i))return Z(i);if(i=s.join(e.path,i),i in y)return y[i];try{if(!r.existsSync(i)){if(!r.existsSync("./particles/"+i))return new Pe(n.unknown,"ImportError",`Can't find file '${i}' to import.`);if(!r.existsSync("particles/"+i+"/main.es"))return new Pe(n.unknown,"ImportError",`Module '${i}' has no entry point. Requires 'main.es'.`);i="particles/"+i+"/main.es"}const e=s.dirname(i),t=r.readFileSync(i,"utf-8"),o=new te;o.parent=u,o.path=e;const a=new D(new L(i),{});y[i]=a;const c=He(t,{env:o,measurePerformance:!1,fileName:i,currentDir:e});return a.__value__=o.getSymbolTableAsDict(),c.error?c.error:a}catch(e){return new Pe(n.unknown,"ImportError",e.toString())}}),[{name:"path",type:x.string}],"import",void 0,x.object),{forceThroughConst:!0,isConstant:!0}),t.setOwn("open",new B((({context:e},t,s)=>{const i=Re(t),o=Re(s)||"utf-8";return r.existsSync(i)?new $({str:new B((({context:e})=>new L(r.readFileSync(e.path+i,o))),[],"str",void 0,x.string),write:new B((({context:e},t)=>{r.writeFileSync(e.path+i,Re(t))}),[{name:"path",type:x.string}]),append:new B((({context:e},t)=>{r.appendFileSync(e.path+i,Re(t))}),[{name:"path",type:x.string}])}):new Le(n.unknown,i)})))}(s,i))},new((p=void 0)||(p=Promise))((function(e,t){function n(e){try{s(d.next(e))}catch(e){t(e)}}function r(e){try{s(d.throw(e))}catch(e){t(e)}}function s(t){var s;t.done?e(t.value):(s=t.value,s instanceof p?s:new p((function(e){e(s)}))).then(n,r)}s((d=d.apply(l,h||[])).next())}))}function He(e,{env:t=u,measurePerformance:r=!1,fileName:s="(unknown)",currentDir:i=""}={}){i&&(t.path=i),se.maxTime=0,se.totalTime=0,se.interprets=0;const o={total:0,lexerTotal:0,parserTotal:0,interpretTotal:0,nodeMax:0,nodeAvg:0,nodeTotal:0,interprets:0};let a=v();if(!t.root.initialisedAsGlobal){const e=new re;return e.error=new Pe(n.unknown,"Uninitialised","Global context has not been initialised with global values"),e}const c=new Qe(e,s).generate();if(c instanceof Pe){const e=new re;return e.error=c,e}o.lexerTotal=v()-a,a=v();const l=new Je(c).parse();if(l.error){const e=new re;return e.error=l.error,e}if(o.parserTotal=v()-a,a=v(),!l.node){const e=new re;return e.val=new W([]),e}const h=l.node.interpret(t);return o.interpretTotal=v()-a,o.total=v()-a,o.nodeMax=se.maxTime,o.nodeTotal=se.totalTime,o.nodeAvg=se.totalTime/se.interprets,o.interprets=se.interprets,r&&console.log(o),Object.assign(Object.assign({},h),{timeData:o})}return t})()}));
//# sourceMappingURL=2.8.7.js.map