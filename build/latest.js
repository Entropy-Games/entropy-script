!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.es=t():e.es=t()}(this,(function(){return(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{Context:()=>re,ESArray:()=>L,ESBoolean:()=>F,ESError:()=>je,ESErrorPrimitive:()=>x,ESFunction:()=>C,ESJSBinding:()=>I,ESNamespace:()=>A,ESNumber:()=>J,ESObject:()=>N,ESPrimitive:()=>S,ESString:()=>q,ESSymbol:()=>Q,ESType:()=>M,ESUndefined:()=>$,ExpectedCharError:()=>Je,IS_NODE_INSTANCE:()=>u,IllegalCharError:()=>Ge,ImportError:()=>Le,IndexError:()=>qe,InvalidOperationError:()=>Qe,InvalidRuntimeError:()=>Ye,InvalidSyntaxError:()=>Ue,MissingNativeDependencyError:()=>He,N_array:()=>de,N_arrayDestructAssign:()=>he,N_binOp:()=>ue,N_break:()=>$e,N_class:()=>ge,N_continue:()=>Ae,N_for:()=>pe,N_functionCall:()=>me,N_functionDefinition:()=>ye,N_if:()=>fe,N_indexed:()=>be,N_namespace:()=>ke,N_number:()=>Se,N_objectLiteral:()=>ve,N_primitiveWrapper:()=>Re,N_return:()=>Te,N_statements:()=>we,N_string:()=>xe,N_tryCatch:()=>Ee,N_unaryOp:()=>ce,N_undefined:()=>Ce,N_varAssign:()=>le,N_variable:()=>Ne,N_while:()=>_e,N_yield:()=>Oe,Node:()=>ae,PermissionRequiredError:()=>Ve,Position:()=>n,ReferenceError:()=>We,TestFailed:()=>Ke,TypeError:()=>Fe,VERSION:()=>h,colours:()=>X,compileResult:()=>oe,config:()=>Z,configFileName:()=>f,deepClone:()=>Ie,generateRandomSymbol:()=>Me,global:()=>s,indent:()=>Be,init:()=>ht,initPrimitiveTypes:()=>P,interpretResult:()=>se,libs:()=>d,now:()=>w,parse:()=>_t,parseConfig:()=>ne,refreshPerformanceNow:()=>m,run:()=>ft,runningInNode:()=>c,setGlobalContext:()=>o,sleep:()=>De,str:()=>Pe,strip:()=>K,wrap:()=>Y});class n{constructor(e,t,n,r="(unknown)"){this.idx=e,this.ln=t,this.col=n,this.file=r}advance(e=""){return this.idx++,this.col++,"\n"===e&&(this.ln++,this.col=0),this}get clone(){return new n(this.idx,this.ln,this.col,this.file)}get str(){return`File ${this.file}, ${this.ln+1}:${this.col+1}`}get isUnknown(){return-2===this.idx}static get void(){return new n(-2,-2,-2,"(unknown)")}}const r="0123456789",i="_$abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ";let s;const o=e=>{s=e},a=["'","`",'"'];let u="undefined"==typeof window;const c=()=>{u=!0},l=["var","let","global"],h="2.20.1",f="esconfig.json",_=["utf8","ucs2","utf16le","latin1","ascii","base64","base64url","hex"],p={},d={},v=["var","let","global","if","else","while","for","in","continue","break","func","return","yield","class","extends","namespace","try","catch"];let w=()=>0;function m(e){return t=this,n=void 0,i=function*(){w=e?()=>Date.now():()=>{try{return null===performance||void 0===performance?void 0:performance.now()}catch(e){return Date.now()}}},new((r=void 0)||(r=Promise))((function(e,s){function o(e){try{u(i.next(e))}catch(e){s(e)}}function a(e){try{u(i.throw(e))}catch(e){s(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof r?n:new r((function(e){e(n)}))).then(o,a)}u((i=i.apply(t,n||[])).next())}));var t,n,r,i}var y;m(u),function(e){e[e.NUMBER=0]="NUMBER",e[e.STRING=1]="STRING",e[e.ENDSTATEMENT=2]="ENDSTATEMENT",e[e.IDENTIFIER=3]="IDENTIFIER",e[e.KEYWORD=4]="KEYWORD",e[e.COMMA=5]="COMMA",e[e.ASSIGN=6]="ASSIGN",e[e.ADD=7]="ADD",e[e.SUB=8]="SUB",e[e.MUL=9]="MUL",e[e.DIV=10]="DIV",e[e.POW=11]="POW",e[e.MOD=12]="MOD",e[e.OPAREN=13]="OPAREN",e[e.CPAREN=14]="CPAREN",e[e.OBRACES=15]="OBRACES",e[e.CBRACES=16]="CBRACES",e[e.OSQUARE=17]="OSQUARE",e[e.CSQUARE=18]="CSQUARE",e[e.EQUALS=19]="EQUALS",e[e.NOTEQUALS=20]="NOTEQUALS",e[e.NOT=21]="NOT",e[e.GT=22]="GT",e[e.LT=23]="LT",e[e.GTE=24]="GTE",e[e.LTE=25]="LTE",e[e.AND=26]="AND",e[e.OR=27]="OR",e[e.COLON=28]="COLON",e[e.DOT=29]="DOT",e[e.EOF=30]="EOF",e[e.PIPE=31]="PIPE",e[e.APMERSAND=32]="APMERSAND",e[e.BITWISE_NOT=33]="BITWISE_NOT",e[e.QM=34]="QM"}(y||(y={}));let T=y;const O={[T.NUMBER]:"Number",[T.STRING]:"String",[T.ENDSTATEMENT]:";",[T.IDENTIFIER]:"Identifier",[T.KEYWORD]:"Keyword",[T.COMMA]:",",[T.OBRACES]:"{",[T.CBRACES]:"}",[T.OPAREN]:"(",[T.CPAREN]:")",[T.OSQUARE]:"[",[T.CSQUARE]:"]",[T.ASSIGN]:"=",[T.ADD]:"+",[T.SUB]:"-",[T.MUL]:"*",[T.DIV]:"/",[T.POW]:"^",[T.MOD]:"%",[T.EQUALS]:"==",[T.NOTEQUALS]:"!=",[T.NOT]:"!",[T.GT]:">",[T.LT]:"<",[T.GTE]:">=",[T.LTE]:"<=",[T.AND]:"&&",[T.OR]:"||",[T.COLON]:":",[T.DOT]:".",[T.EOF]:"End of File",[T.APMERSAND]:"&",[T.PIPE]:"|",[T.BITWISE_NOT]:"~",[T.QM]:"?"},b={"*":T.MUL,"/":T.DIV,"+":T.ADD,"-":T.SUB,"(":T.OPAREN,")":T.CPAREN,"^":T.POW,"%":T.MOD,"{":T.OBRACES,"}":T.CBRACES,",":T.COMMA,"[":T.OSQUARE,"]":T.CSQUARE,";":T.ENDSTATEMENT,":":T.COLON,".":T.DOT,"=":T.ASSIGN,">":T.GT,"<":T.LT,"!":T.NOT,"|":T.PIPE,"&":T.APMERSAND,"~":T.BITWISE_NOT,"?":T.QM},g={"==":T.EQUALS,"!=":T.NOTEQUALS,">=":T.GTE,"<=":T.LTE,"+=":T.ASSIGN,"-=":T.ASSIGN,"*=":T.ASSIGN,"/=":T.ASSIGN,"&&":T.AND,"||":T.OR},k={},E=["__add__","__subtract__","__multiply__","__divide__","__pow__","__eq__","__gt__","__lt__","__and__","__or__","__pipe__","__ampersand__","__bool__","__set_property__","__get_property__","__call__"];class S{constructor(e,t=p.any){this.self=this,this.isa=(e,t)=>t.type_check(e,this),this.is=(e,t)=>new F(t===this),this.valueOf=()=>this.__value__,this.typeName=()=>Pe(this.__type__),this.has_property=(e,t)=>new F(this.hasOwnProperty(Pe(t))),this.describe=(e,t)=>{this.info.isBuiltIn||(this.info.description=Pe(t))},this.detail=(e,t)=>{if(this.info.isBuiltIn)return;const r=K(t,e);if("object"!=typeof r)return new Fe(n.void,"object",this.typeName(),Pe(this));this.info=Object.assign(Object.assign({},this.info),r),this.info.isBuiltIn=!1},this.__type__=t||this,this.__value__=e,this.info={}}__add__(e,t){return new Qe("",this)}__subtract__(e,t){return new Qe("",this)}__multiply__(e,t){return new Qe("",this)}__divide__(e,t){return new Qe("",this)}__pow__(e,t){return new Qe("__pow__",this)}__mod__(e,t){return new Qe("__mod__",this)}__eq__(e,t){return new Qe("__eq__",this)}__gt__(e,t){return new Qe("__gt__",this)}__lt__(e,t){return new Qe("__lt__",this)}__and__(e,t){return new Qe("__and__",this)}__or__(e,t){return new Qe("__or__",this)}__bool__(e){return new Qe("__bool__",this)}__pipe__(e,t){return new Qe("__pipe__",this)}__ampersand__(e,t){return new Qe("__ampersand__",this)}__set_property__(e,t,n){return new Qe("__set_property__",this,`[${Pe(t)}] = ${Pe(n)}`)}__call__(e,...t){return new Qe("__call__",this)}}class x extends S{constructor(e=new je(n.void,"Unknown","Error not specified")){super(e,p.error),this.__get_property__=(e,t)=>{switch(Pe(t)){case"name":return new q(this.valueOf().name);case"details":return new q(this.valueOf().details);case"traceback":return new L(this.valueOf().traceback.map((e=>new q(`${e.position.str} : ${e.line}`))));default:return this.self.hasOwnProperty(Pe(t))?Y(this.self[Pe(t)],!0):new qe(n.void,t.valueOf(),this)}},this.cast=()=>new je(n.void,"TypeError","Cannot cast type 'error'"),this.str=()=>new q(`<Error: ${this.valueOf().str}>`),this.__eq__=(e,t)=>new F(t instanceof x&&this.valueOf().constructor===t.valueOf().constructor),this.__bool__=()=>new F(!0),this.bool=this.__bool__,this.clone=()=>new x(this.valueOf()),this.type_check=this.__eq__}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class N extends S{constructor(e={}){super(e,p.object),this.cast=({},e)=>e===p.number?new J(this.valueOf()?1:0):new je(n.void,"TypeError",`Cannot cast boolean to type '${Pe(e.typeName())}'`),this.str=()=>{let e=Pe(this.valueOf());return"\n"===e[e.length-1]&&(e=e.substr(0,e.length-1)),new q(e)},this.__eq__=({context:e},t)=>{if(!(t instanceof N))return new F;if(t.keys.length!==this.keys.length)return new F;for(let n of this.keys){const r=n.valueOf(),i=this.valueOf()[r],s=t.valueOf()[r];if(!i){if(s)return new F;continue}if(!i.__eq__)return new F;const o=i.__eq__({context:e},s);if(o instanceof je)return o;if(!o.valueOf())return new F}return new F(!0)},this.__bool__=()=>new F(!0),this.bool=this.__bool__,this.__add__=({context:e},t)=>{if(!(t instanceof N))return new Fe(n.void,"Object",t.typeName().valueOf(),t);let r={};for(let t of this.keys){const n=t.valueOf(),i=this.__get_property__({context:e},t);if(i instanceof je)return i;r[n]=i}for(let n of t.keys){const i=n.valueOf();if(r.hasOwnProperty(i))continue;const s=t.__get_property__({context:e},n);if(s instanceof je)return s;r[i]=s}return new N(r)},this.__subtract__=(e,t)=>{let r=[];if(t instanceof q)r=[Pe(t)];else{if(!(t instanceof L))return new Fe(n.void,"Array | String",t.typeName().valueOf(),t);r=K(t,e)}if(!Array.isArray(r))return new Fe(n.void,"Array | String",t.typeName().valueOf(),t);let i={};for(let t of this.keys){const n=t.valueOf();if(-1===r.indexOf(n)){let r=this.__get_property__(e,t);if(r instanceof je)return r;i[n]=r}}return new N(i)},this.__get_property__=(e,t)=>{if(!(t instanceof q||t instanceof J))return new Fe(n.void,"String | Number",t.typeName(),Pe(t));const r=t.valueOf();return this.valueOf().hasOwnProperty(r)?this.valueOf()[r]:this.self.hasOwnProperty(r)?Y(this.self[Pe(r)],!0):new qe(n.void,Pe(r),this)},this.__set_property__=({},e,t)=>{if(!(e instanceof q))return new Fe(n.void,"String",e.typeName(),Pe(e));this.__value__[e.valueOf()]=t},this.has_property=(e,t)=>{const n=Pe(t);return this.valueOf().hasOwnProperty(Pe(n))?new F(!0):new F(this.hasOwnProperty(n))},this.clone=()=>{const e=new N;let t={},n=this.valueOf();for(let e of Object.keys(n))t[e]=n[e];return e.__value__=t,e},this.type_check=(e,t)=>{if(!(t instanceof N))return new F;if(Object.keys(this.valueOf()).length!==Object.keys(t.valueOf()).length)return new F;for(let n of Object.keys(this.valueOf())){if(!t.valueOf().hasOwnProperty(n)||!this.valueOf().hasOwnProperty(n))return new F;const r=this.valueOf()[n],i=t.valueOf()[n];if(!r.type_check(e,i).valueOf())return new F}return new F(!0)}}get keys(){return Object.keys(this.valueOf()).map((e=>new q(e)))}set keys(e){}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class C extends S{constructor(e=(()=>{}),t=[],r="(anon)",i=new N,o=p.any,a,u=!1){super(e,p.function),this.cast=(e,t)=>new je(n.void,"TypeError","Cannot cast type 'function'"),this.clone=()=>new C(this.__value__,this.arguments_,this.name,this.this_,this.returnType,this.__closure__),this.valueOf=()=>this,this.str=()=>new q(`<Func: ${this.name}>`),this.__eq__=(e,t)=>new F(t instanceof C&&this.__value__===t.__value__),this.__bool__=()=>new F(!0),this.bool=this.__bool__,this.__call__=({context:e},...t)=>{let r=e;return this.takeCallContextAsClosure||(r=this.__closure__,r.path=e.path),function(e,t,r){var i;let s=e;t.takeCallContextAsClosure||(e=t.__closure__),e.path=s.path;const o=t.__value__,a=function(e,t,r){const i=new re;i.parent=r;let s=Math.max(e.length,t.arguments_.length);for(let o=0;o<s;o++){let s=new $,a=p.any;if(!t.arguments_[o])continue;const u=t.arguments_[o];if(e[o]instanceof S&&(a=e[o].__type__,s=e[o]),u.defaultValue&&e.length<=o){i.setOwn(u.name,u.defaultValue,{forceThroughConst:!0});continue}const c=u.type.type_check({context:r},e[o]);if(c instanceof je)return c;if(!c.valueOf())return new Fe(n.void,Pe(u.type),Pe(a),Pe(s));i.setOwn(u.name,s,{forceThroughConst:!0})}let o=i.setOwn("args",new L(e),{forceThroughConst:!0});return o instanceof je?o:i}(r,t,e);if(a instanceof je)return a;let u=null!==(i=t.this_)&&void 0!==i?i:new N;if(!(u instanceof N))return new Fe(n.void,"object",typeof u,u,"'this' must be an object");let c=a.setOwn("this",u);return c instanceof je?c:o instanceof ae?function(e,t,r,i){var s,o;const a=i.interpret(t);return a.error?a.error:(void 0!==a.funcReturn&&(a.val=a.funcReturn,a.funcReturn=void 0),!1===e.returnType.type_check({context:t},a.val).valueOf()?new Fe(n.void,Pe(e.returnType),(null===(s=a.val)||void 0===s?void 0:s.typeName().valueOf())||"undefined",null===(o=a.val)||void 0===o?void 0:o.str().valueOf(),"(from function return)"):a.val?a.val:new $)}(t,a,0,o):"function"==typeof o?function(e,t,n,r){for(let e=n.length;e<r.length;e++)n.push(new $);const i=r({context:t},...n);return i instanceof je||i instanceof S?i:new $}(0,a,r,o):new Fe(n.void,"function",typeof o)}(r,this,t)},this.__get_property__=(e,t)=>this.self.hasOwnProperty(Pe(t))?Y(this.self[Pe(t)],!0):new qe(n.void,t.valueOf(),this),this.type_check=(e,t)=>{if(!(t instanceof C))return new F;if(this.arguments_.length!==t.arguments_.length)return new F;for(let n=0;n<this.arguments_.length;n++)if(!this.arguments_[n].type.type_check(e,t.arguments_[n].type).valueOf())return new F;const n=this.__call__(e);return n instanceof je?n:n.__eq__(e,t.returnType).valueOf()?new F(!0):new F},this.arguments_=t,this.info.name=r,this.this_=i,this.returnType=o,a?this.__closure__=a:(this.__closure__=new re,this.__closure__.parent=s),this.takeCallContextAsClosure=u,this.info.returnType=Pe(o),this.info.args=t.map((e=>({name:e.name,defaultValue:Pe(e.defaultValue),type:e.type.info.name,required:!0})))}get name(){var e;return null!==(e=this.info.name)&&void 0!==e?e:"(anonymous)"}set name(e){this.info.name=e}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class $ extends S{constructor(){super(void 0,p.undefined),this.cast=({context:e},t)=>{switch(t){case p.number:return new J;case p.string:return new q;case p.array:return new L;case p.undefined:return new $;case p.type:return new M;case p.error:return new x;case p.object:case p.any:return new N;case p.function:return new C((()=>{}));case p.boolean:return new F;default:return t instanceof M?t.__call__({context:e}):new je(n.void,"TypeError",`Cannot cast to type '${Pe(t.typeName())}'`)}},this.str=()=>new q("<Undefined>"),this.__eq__=(e,t)=>new F(t instanceof $||void 0===t||void 0===t.valueOf()),this.__bool__=()=>new F,this.bool=this.__bool__,this.clone=()=>new $,this.__get_property__=({},e)=>this.self.hasOwnProperty(Pe(e))?Y(this.self[Pe(e)],!0):new qe(n.void,e.valueOf(),this),this.type_check=this.__eq__,this.info={name:"undefined",description:"Not defined, not a value.",file:"built-in",isBuiltIn:!0}}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class A extends S{constructor(e,t,r=!1){super(t,p.object),this.cast=e=>new je(n.void,"TypeError","Cannot cast type 'namespace'"),this.clone=()=>{let e={},t=this.valueOf();for(let n of Object.keys(t))e[n]=t[n];return new A(this.name,e)},this.str=()=>{const e=Object.keys(this.valueOf());return new q(`<Namespace ${Pe(this.name)}${e.length>0?": ":""}${e.slice(0,5)}${e.length>=5?"...":""}>`)},this.__eq__=(e,t)=>new F(this===t),this.__bool__=()=>new F(!0),this.bool=this.__bool__,this.__get_property__=(e,t)=>{if(t instanceof q&&this.valueOf().hasOwnProperty(t.valueOf())){const e=this.valueOf()[t.valueOf()];if(e.isAccessible)return e.value}return t instanceof q?this.self.hasOwnProperty(Pe(t))?Y(this.self[Pe(t)],!0):new qe(n.void,t.valueOf(),this.self):new Fe(n.void,"string",t.typeName())},this.type_check=this.__eq__,this.info.name=Pe(e),this.mutable=r}get name(){return new q(this.info.name)}set name(e){this.info.name=e.valueOf()}__set_property__(e,t,r){if(!(t instanceof q))return new Fe(n.void,"string",t.typeName().valueOf(),Pe(t));let i=Pe(t);if(!this.mutable)return new Fe(n.void,"mutable","immutable",`${Pe(this.name)}`);r instanceof S||(r=Y(r));const s=this.__value__[i];return s?s.isConstant?new Fe(n.void,"mutable","immutable",`${Pe(this.name)}[${i}]`):s.isAccessible?void(s.value=r):new Fe(n.void,"accessible","inaccessible",`${Pe(this.name)}[${i}]`):new je(n.void,"SymbolError",`Symbol ${i} is not declared in namespace ${Pe(this.name)}.`)}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}function R(e,t,r,i,s){let o;if(e)try{o=new t[r](i,...s)}catch(e){try{o=t[r](i,...s)}catch(e){return new je(n.void,e.name,e.toString())}}else try{o=new t[r](...s.map((e=>K(e,i))))}catch(e){try{o=t[r](...s.map((e=>K(e,i))))}catch(e){return new je(n.void,e.name,e.toString())}}return Y(o)}class I extends S{constructor(e,t="<AnonNative>",r=!1){super(e,p.object),this.cast=e=>new je(n.void,"TypeError","Cannot cast native object"),this.clone=()=>new I(this.__value__),this.str=()=>new q(Pe(this.__value__)),this.__eq__=({},e)=>new F(this===e),this.__bool__=()=>new F(!0),this.bool=this.__bool__,this.__get_property__=(e,t)=>{const r=Pe(t),i=this.__value__,s=i[r];if(void 0===s)return this.self.hasOwnProperty(r)?Y(this.self[Pe(r)],!0):new qe(n.void,r,this);if(s instanceof S)return s;if("function"==typeof s){const e=this.functionsTakeProps;return new C(((t,...n)=>R(e,i,r,t,n)))}return Y(s)},this.__call__=(e,...t)=>"function"!=typeof this.__value__?new Fe(n.void,"function",typeof this.__value__,Pe(this)):R(this.functionsTakeProps,this,"__value__",e,t),this.has_property=(e,t)=>new F(!(this.__get_property__(e,t)instanceof je)),this.type_check=this.__eq__,this.info.name=Pe(t),this.functionsTakeProps=r}__set_property__(e,t,n){const r=Pe(t),i=this.__value__;this.self.hasOwnProperty(r)?this.self[Pe(r)]=n:i[r]=K(n,e)}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}function P(){p.type=new M(!0,"Type"),p.undefined=new M(!0,"Undefined"),p.string=new M(!0,"String"),p.array=new M(!0,"Array"),p.number=new M(!0,"Number"),p.any=new M(!0,"Any"),p.function=new M(!0,"Function"),p.bool=new M(!0,"Boolean"),p.object=new M(!0,"Object"),p.error=new M(!0,"Error"),p.any.info={name:"Any",description:"Matches any other type",file:"built-in",isBuiltIn:!0},p.number.info={name:"Number",description:"The ES Number type. Is a a double-precision 64-bit binary format IEEE 754 value, like double in Java and C#",file:"built-in",isBuiltIn:!0},p.string.info={name:"string",description:"The ES String type. Holds an array of characters, and can be defined with any of ', \" and `. Can be indexed like an array.",file:"built-in",isBuiltIn:!0},p.bool.info={name:"Bool",description:"The ES Bool type. Exactly two instances exist, true and false.",file:"built-in",isBuiltIn:!0},p.function.info={name:"Func",description:"The ES Function type. Is a block of code which executes when called and takes in 0+ parameters.",file:"built-in",isBuiltIn:!0},p.array.info={name:"Array",description:"The ES Array type. Defines a set of items of any type which can be accessed by an index with [].",file:"built-in",isBuiltIn:!0},p.object.info={name:"object",description:"The ES Object type. Similar to JS objects or python dictionaries.",file:"built-in",isBuiltIn:!0},p.error.info={name:"Error",description:"The ES Error type. Call to throw an error.",file:"built-in",isBuiltIn:!0},p.type.info={name:"Type",description:"The ES Type type. Call to get the type of a value at a string.",file:"built-in",isBuiltIn:!0}}function D(e,t,r,i,s){if(!(t instanceof M))return new Fe(n.void,"Type",typeof t,t);const o=new C((({context:e},...n)=>{const o=new re;if(o.parent=e,t.__extends__){let e=D(o,t.__extends__,r,i,s);if(e instanceof je)return e}const a=null==t?void 0:t.__init__;if(!a)return;a.this_=i,a.__closure__=o;const u=a.__call__({context:o},...n);return u instanceof je?u:void 0}),void 0,"super",i);let a=e.setOwn("super",o);if(a instanceof je)return a;const u=B(t,{context:e},[],!1,r);return u instanceof je?u:void 0}function B(e,{context:t},n,r=!0,i={}){var s;if(e.primitive){if(n.length<1)return new $;switch(e.__name__){case"Undefined":case"Type":return n.length<1?new M:new q(n[0].typeName());case"String":return new q(n[0].str().valueOf());case"Array":return new L(n);case"Number":return new J(n[0].valueOf());case"Function":return new C(n[0].valueOf());case"Boolean":return new F(n[0].bool().valueOf());default:return Y(n[0])}}const o=new re;o.parent=null===(s=e.__init__)||void 0===s?void 0:s.__closure__;const a=new N;if(e.__extends__){let n=D(o,e.__extends__,i,a,t);if(n instanceof je)return n}a.__value__=i;for(let t of e.__methods__){const e=t.clone();e.this_=a,i[t.name]=e,-1!==E.indexOf(t.name)&&(a[t.name]=e.__call__)}if(r&&e.__init__){e.__init__.this_=a,e.__init__.__closure__=o;const t=e.__init__.__call__({context:o},...n);if(t instanceof je)return t}return a.__type__=e,e.__instances__.push(a),a}class M extends S{constructor(e=!1,t="(anon)",r=[],i,s){super(void 0,null==p?void 0:p.type),this.__instances__=[],this.clone=()=>new M(this.primitive,this.__name__,this.__methods__,this.__extends__,this.__init__),this.isa=(e,t)=>new F(t===p.type),this.cast=(e,t)=>new Qe("cast",this),this.type_check=(e,t)=>{var n;if(!t)return new F;let r=t.__type__;if(this===p.any||r===p.any||this===r)return new F(!0);for(;r instanceof M;){if(!0===(null===(n=r.__extends__)||void 0===n?void 0:n.__eq__(e,this).valueOf()))return new F(!0);if(!r.__extends__)break;r=r.__extends__}return new F},this.__eq__=(e,t)=>new F(t===this),this.__call__=(e,...t)=>B(this,e,t||[]),this.str=()=>new q(this.__name__),this.__bool__=()=>new F(!0),this.bool=this.__bool__,this.__get_property__=(e,t)=>{if(!(t instanceof q))return this===p.array?new W(t):new Fe(n.void,"string",t.typeName(),Pe(t));const r=t.valueOf();return this.self.hasOwnProperty(r)?Y(this.self[r],!0):new W(t)},this.primitive=e,this.__name__=t,this.info.name=t,this.__extends__=i,this.__methods__=r,s&&(s.name=t,this.__init__=s),p.type||(this.__type__=this)}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class j extends M{constructor(e,t){super(!1,`(${Pe(e)}) | (${Pe(t)})`),this.__call__=(e,...t)=>new Qe("__call__",this),this.type_check=(e,t)=>{const n=this.__left__.type_check(e,t),r=this.__right__.type_check(e,t);return n instanceof je?n:r instanceof je?r:new F(n.valueOf()||r.valueOf())},this.clone=()=>new j(this.__left__,this.__right__),this.__eq__=(e,t)=>new F(t instanceof j&&!0===this.__left__.__eq__(e,t.__left__).valueOf()&&!0===this.__right__.__eq__(e,t.__right__).valueOf()),this.__left__=e,this.__right__=t}}class G extends M{constructor(e,t){super(!1,`(${Pe(e)}) & (${Pe(t)})`),this.__call__=(e,...t)=>new Qe("__call__",this),this.type_check=(e,t)=>{const n=this.__left__.type_check(e,t),r=this.__right__.type_check(e,t);return n instanceof je?n:r instanceof je?r:new F(n.valueOf()&&r.valueOf())},this.clone=()=>new G(this.__left__,this.__right__),this.__eq__=(e,t)=>new F(t instanceof G&&!0===this.__left__.__eq__(e,t.__left__).valueOf()&&!0===this.__right__.__eq__(e,t.__right__).valueOf()),this.__left__=e,this.__right__=t}}class U extends M{constructor(e){super(!1,`~(${Pe(e)})`),this.__call__=(e,...t)=>new Qe("__call__",this),this.type_check=(e,t)=>{const n=this.__val__.type_check(e,t);return n instanceof je?n:new F(!n.valueOf())},this.clone=()=>new U(this.__val__),this.__eq__=(e,t)=>new F(t instanceof U&&!0===this.__val__.__eq__(e,t.__val__).valueOf()),this.__val__=e}}class J extends S{constructor(e=0){super(e,p.number),this.cast=(e,t)=>{switch(t){case p.number:return this;case p.string:return this.str();case p.array:return new L(new Array(this.valueOf()));default:return new je(n.void,"TypeError",`Cannot cast to type '${Pe(t.typeName())}'`)}},this.str=()=>new q(this.valueOf().toString()),this.__add__=(e,t)=>t instanceof J?new J(this.valueOf()+t.valueOf()):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__subtract__=(e,t)=>t instanceof J?new J(this.valueOf()-t.valueOf()):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__multiply__=(e,t)=>t instanceof J?new J(this.valueOf()*t.valueOf()):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__divide__=(e,t)=>t instanceof J?new J(this.valueOf()/t.valueOf()):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__pow__=(e,t)=>t instanceof J?new J(Math.pow(this.valueOf(),t.valueOf())):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__mod__=(e,t)=>t instanceof J?new J(this.valueOf()%t.valueOf()):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__eq__=(e,t)=>new F(t instanceof J&&this.valueOf()===t.valueOf()),this.__gt__=(e,t)=>t instanceof J?new F(this.valueOf()>t.valueOf()):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__lt__=(e,t)=>t instanceof J?new F(this.valueOf()<t.valueOf()):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__bool__=()=>new F(this.valueOf()>0),this.bool=this.__bool__,this.clone=()=>new J(this.valueOf()),this.__get_property__=({},e)=>this.self.hasOwnProperty(Pe(e))?Y(this.self[Pe(e)],!0):new qe(n.void,e.valueOf(),this),this.type_check=this.__eq__}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class F extends S{constructor(e=!1){super(Boolean(e),p.bool),this.__get_property__=(e,t)=>this.self.hasOwnProperty(Pe(t))?Y(this.self[Pe(t)],!0):new qe(n.void,t.valueOf(),this),this.cast=(e,t)=>t===p.number?new J(this.valueOf()?1:0):new je(n.void,"TypeError",`Cannot cast boolean to type '${Pe(t.typeName())}'`),this.__eq__=(e,t)=>t instanceof F?new F(this.valueOf()===t.valueOf()):new Fe(n.void,"Boolean",t.typeName().valueOf(),t.valueOf()),this.__bool__=()=>this,this.__and__=(e,t)=>new F(this.valueOf()&&t.bool().valueOf()),this.__or__=(e,t)=>new F(this.valueOf()||t.bool().valueOf()),this.str=()=>new q(this.valueOf()?"true":"false"),this.clone=()=>new F(this.valueOf()),this.bool=()=>this,this.type_check=this.__eq__,this.info={name:Pe(e),description:`Boolean global constant which evaluates to ${Pe(e)}, the opposite of ${Pe(!e)}`,file:"built-in",isBuiltIn:!0,helpLink:"https://en.wikipedia.org/wiki/Boolean_expression"}}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class L extends S{constructor(e=[]){super(e,p.array),this.len=e=>new J(this.valueOf().length),this.cast=(e,t)=>{switch(t){case p.number:return new J(this.len(e).valueOf());case p.boolean:return this.bool();default:return new je(n.void,"TypeError",`Cannot cast boolean to type '${Pe(t.typeName())}'`)}},this.str=()=>new q(Pe(this.valueOf())),this.__eq__=(e,t)=>{if(!(t instanceof L))return new F;if(t.len(e).valueOf()!==this.len(e).valueOf())return new F;for(let n=0;n<this.len(e).valueOf();n++){const r=this.valueOf()[n],i=t.valueOf()[n];if(!r){if(i)return new F;continue}if(!r.__eq__)return new F;const s=r.__eq__(e,i);if(s instanceof je)return s;if(!s.valueOf())return new F}return new F(!0)},this.__add__=(e,t)=>t instanceof L?new L([...this.valueOf(),...t.valueOf()]):new Fe(n.void,"array",t.typeName().valueOf(),t),this.__bool__=()=>new F(this.valueOf().length>0),this.bool=this.__bool__,this.__get_property__=(e,t)=>{if(t instanceof q&&this.self.hasOwnProperty(Pe(t)))return Y(this.self[Pe(t)],!0);if(!(t instanceof J))return new $;let n=t.valueOf();for(;n<0;)n=this.valueOf().length+n;return n<this.valueOf().length?this.valueOf()[n]:new $},this.contains=(e,t)=>{for(let n of this.__value__)if(t.__eq__(e,n))return!0;return!1},this.clone=()=>{const e=[];for(let t of this.valueOf())e.push(t);return new L(e)},this.type_check=(e,t)=>{if(!(t instanceof L)||this.len(e).valueOf()!==t.len(e).valueOf())return new F;for(let n=0;n<this.__value__.length;n++){const r=this.__value__[n].type_check(e,t.__value__[n]);if(r instanceof je)return r;if(!r.valueOf())return new F}return new F(!0)}}__set_property__(e,t,n){if(!(t instanceof J))return;n instanceof S||(n=Y(n));let r=t.valueOf();for(;r<0;)r=this.valueOf().length+r;this.__value__[r]=n}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class W extends M{constructor(e){super(!1,`Array[${Pe(e)}]`),this.numElements=-1,this.__call__=(e,...t)=>new Qe("__call__",this),this.type_check=(e,t)=>{if(!(t instanceof L))return new F;if(this.numElements>=0&&t.valueOf().length!==this.numElements)return new Fe(n.void,`Array[${Pe(this.type)}][${this.numElements}]`,`Array[Any][${t.valueOf().length}]`);for(const n of t.valueOf())if(!this.type.type_check(e,n).valueOf())return new F;return new F(!0)},this.clone=()=>new W(this.type),this.__get_property__=(e,t)=>t instanceof q&&this.self.hasOwnProperty(Pe(t))?Y(this.self[Pe(t)],!0):t instanceof J?(this.numElements=t.valueOf(),this):new Fe(n.void,"Number",t.typeName(),Pe(t)),this.type=e}}class q extends S{constructor(e=""){super(e,p.string),this.str=()=>this,this.cast=(e,t)=>{switch(t){case p.number:const e=parseFloat(this.valueOf());return isNaN(e)?new je(n.void,"TypeError","This string is not a valid number"):new J(e);case p.string:return this;case p.array:return new L(this.valueOf().split("").map((e=>new q(e))));default:return new je(n.void,"TypeError",`Cannot cast to type '${Pe(t.typeName())}'`)}},this.__add__=(e,t)=>t instanceof q?new q(this.valueOf()+t.valueOf()):new Fe(n.void,"String",t.typeName().valueOf(),t.valueOf()),this.__multiply__=(e,t)=>t instanceof J?new q(this.valueOf().repeat(t.valueOf())):new Fe(n.void,"Number",t.typeName().valueOf(),t.valueOf()),this.__eq__=(e,t)=>new F(t instanceof q&&this.valueOf()===t.valueOf()),this.__gt__=(e,t)=>t instanceof q?new F(this.valueOf().length>t.valueOf().length):new Fe(n.void,"String",t.typeName().valueOf(),t.valueOf()),this.__lt__=(e,t)=>t instanceof q?new F(this.valueOf().length<t.valueOf().length):new Fe(n.void,"String",t.typeName().valueOf(),t.valueOf()),this.__bool__=()=>new F(this.valueOf().length>0),this.bool=this.__bool__,this.len=()=>new J(this.valueOf().length),this.clone=()=>new q(this.valueOf()),this.__get_property__=(e,t)=>{if(t instanceof q&&this.self.hasOwnProperty(Pe(t)))return Y(this.self[Pe(t)],!0);if(!(t instanceof J))return new q;let n=t.valueOf();for(;n<0;)n=this.valueOf().length+n;return n<this.valueOf().length?new q(this.valueOf()[n]):new q},this.type_check=this.__eq__}__set_property__(e,t,n){if(!(t instanceof J))return;n instanceof q||(n=new q(Pe(n)));let r=t.valueOf();for(;r<0;)r=this.valueOf().length+r;const i=n.str().valueOf();let s=this.__value__.substr(0,r),o=this.__value__.substr(r+i.length);this.__value__=s+i+o}__pipe__(e,t){return new j(this,t)}__ampersand__(e,t){return new G(this,t)}}class Q{constructor(e,t,n={}){var r,i,s;this.clone=()=>new Q(this.value.clone(),this.identifier,{isConstant:this.isConstant,isAccessible:this.isAccessible}),this.str=()=>new q(`<Symbol: ${this.identifier}>`),this.value=e,this.identifier=t,this.isConstant=null!==(r=n.isConstant)&&void 0!==r&&r,this.isAccessible=null===(i=n.isAccessible)||void 0===i||i,this.type=null!==(s=n.type)&&void 0!==s?s:e.__type__}}function Y(e,t=!1){return e instanceof S?e:null==e?new $:e instanceof je?new x(e):e instanceof Q?e.value:"number"==typeof e?new J(e):"string"==typeof e?new q(e):"boolean"==typeof e?new F(e):"bigint"==typeof e?new J(Number(e)):"symbol"==typeof e?new q(String(e)):Array.isArray(e)?new L(e.map((e=>Y(e,t)))):new I(e,void 0,t)}function K(e,t){if(!(e instanceof S))return e;if(e instanceof L)return e.valueOf().map((e=>K(e,t)),t);if(e instanceof N){let n={};for(let r in e.valueOf())n[r]=K(e.valueOf()[r],t);return n}return e instanceof $?void 0:e instanceof C?(...n)=>{const r=e.__call__(t,...n.map((e=>Y(e))));return r instanceof je?(console.error(r.str),r):K(r,t)}:e instanceof M?e:e.valueOf()}const V={red:31,yellow:33,green:32,cyan:36,blue:34,grey:2},H={};for(let e of Object.keys(V))H[e]=t=>(t||(t=""),u?`[${V[e]}m`+t+"[0m":`<span style="color: ${e}">${t}</span>`);const X=H;let z=Symbol("AllowAny");const Z={permissions:{networking:!1,imports:!0,accessDOM:!1,useSTD:!0,fileSystem:!1},modules:{[z]:"y"}};function ee(e){let t="[";for(let n of e)t+=n+"][";return t.substring(0,t.length-1)}function te(e,t,n=[]){if(!e[z]){const r=Object.keys(t).filter((t=>!(t in e)));for(const e of r)console.error("Cannot parse config",` - unknown property config${ee([...n,e])}`)}for(const r of Object.keys(t)){if(typeof e[r]!=typeof t[r]&&!e[z])return void console.error("Cannot parse config",` - config${ee([...n,r])} should be of type '${typeof e[r]}'`);"object"!=typeof e[r]?e[r]=t[r]:te(e[r],t[r],[...n,r])}}function ne(e){te(Z,e)}class re{constructor(){this.symbolTable={},this.initialisedAsGlobal=!1,this.deleted=!1,this.path_=""}get path(){return this.path_||!this.parent?this.path_:this.parent.path}set path(e){this.path_=e}get parent(){return this.parent_}set parent(e){e!=this?this.parent_=e:console.error(X.red("Setting context parent to self"))}get permissions(){return this.permissions_?this.permissions_:this.parent?this.parent.permissions:{networking:!1,imports:!0,accessDOM:!1,useSTD:!0,fileSystem:!1}}set permissions(e){this.permissions_=e}has(e){return!!e&&void 0!==this.get(e)}hasOwn(e){return this.symbolTable[e]instanceof Q}get(e){let t=this.getSymbol(e);return t instanceof je||null==t?t:t.value}getRawSymbolTableAsDict(){const e={};for(let t in this.symbolTable)e[t]=this.symbolTable[t].value;return e}getSymbolTableAsDict(){const e={};for(let t in this.symbolTable)e[t]=this.symbolTable[t];return e}getSymbol(e){let t=this.symbolTable[e];if(t&&!t.isAccessible)return new Fe(n.void,"assessable","inaccessible",t.identifier);if(!t&&this.parent){let n=this.parent.getSymbol(e);if(n instanceof je)return n;t=n}return t}set(e,t,n={}){let r=this;if(n.global)r=this.root;else{for(;!r.hasOwn(e)&&void 0!==r.parent;)r=r.parent;r.hasOwn(e)||(r=this)}return r.setOwn(e,t,n)}setOwn(e,t,r={}){if(t instanceof S||(t=Y(t)),r.global&&!this.initialisedAsGlobal&&(r.global=!1),!r.forceThroughConst){let t=this.symbolTable[e];if(null==t?void 0:t.isConstant)return new Fe(n.void,"dynamic","constant",e)}this.symbolTable[e]=new Q(t,e,r)}remove(e){delete this.symbolTable[e]}clear(){for(let e in this.symbolTable)this.remove(e);this.parent=void 0,this.deleted=!0}get root(){let e=this;for(;e.parent;)e=e.parent;return e}get keys(){return Object.keys(this.symbolTable)}clone(){const e=new re;return e.parent=this.parent,e.deleted=this.deleted,e.initialisedAsGlobal=this.initialisedAsGlobal,e.symbolTable=Object.assign(Object.assign({},e.symbolTable),this.symbolTable),e}deepClone(){var e;let t=this.clone();return t.parent=null===(e=t.parent)||void 0===e?void 0:e.deepClone(),t}log(){console.log("---- CONTEXT ----");for(let e in this.symbolTable){const t=this.symbolTable[e];let n=e;t.isConstant&&(n+=" (CONST)"),t.isAccessible||(n+=" (INACCESSIBLE)"),n+=": ",n+=Pe(this.symbolTable[e].value),console.log(n)}console.log("-----------------")}}function ie(e,t){var n;const r=e.type.interpret(t);if(r.error)return r.error;let i;if(e.defaultValue){let r=null===(n=e.defaultValue)||void 0===n?void 0:n.interpret(t);if(r.error)return r.error;r.val instanceof S&&(i=r.val)}return{name:e.name,type:r.val,defaultValue:i}}class se{constructor(e){this.val=new $,this.shouldBreak=!1,this.shouldContinue=!1,e instanceof je?this.error=e:e&&(this.val=e)}}class oe{constructor(e){this.val="",this.hoisted="","string"==typeof e?this.val=e:e&&(this.error=e)}register(e,t){const n=e.compilePy(t);return this.hoisted+=n.hoisted,n.error?(this.error=n.error,""):n.val}}class ae{constructor(e,t=!1){this.pos=e,this.isTerminal=t}interpret(e){var t;const r=w(),i=new se,s=this.interpret_(e);s instanceof je?i.error=s:s instanceof se?(i.val=s.val,i.error=s.error,i.funcReturn=s.funcReturn,i.shouldBreak=s.shouldBreak,i.shouldContinue=s.shouldContinue):i.val=s,i.error&&i.error.pos.isUnknown&&(i.error.pos=this.pos),i.val instanceof S||(i.error=new Fe(n.void,"Primitive","Native JS value",Pe(i.val)),i.val=new $),(t=i.val.info).file||(t.file=this.pos.file),ae.interprets++;let o=w()-r;return ae.totalTime+=o,o>ae.maxTime&&(ae.maxTime=o),i}}ae.interprets=0,ae.totalTime=0,ae.maxTime=0;class ue extends ae{constructor(e,t,n,r){super(e),this.left=t,this.opTok=n,this.right=r}interpret_(e){const t=this.left.interpret(e);if(t.error)return t.error;const n=this.right.interpret(e);if(n.error)return n.error;const r=t.val,i=n.val;if(void 0===r)return new Fe(this.opTok.pos,"~undefined","undefined",r,"N_binOp.interpret_");if(void 0===i)return new Fe(this.opTok.pos,"~undefined","undefined",i,"N_binOp.interpret_");switch(this.opTok.type){case T.LTE:{const t=r.__lt__({context:e},i),n=r.__eq__({context:e},i);return t instanceof je?t:n instanceof je?n:new se(t.__or__({context:e},n))}case T.GTE:{const t=r.__gt__({context:e},i),n=r.__eq__({context:e},i);return t instanceof je?t:n instanceof je?n:new se(t.__or__({context:e},n))}case T.NOTEQUALS:{const t=r.__eq__({context:e},i);return t instanceof je?t:new se(new F(!t.bool().valueOf()))}case T.ADD:return new se(r.__add__({context:e},i));case T.SUB:return new se(r.__subtract__({context:e},i));case T.MUL:return new se(r.__multiply__({context:e},i));case T.DIV:return new se(r.__divide__({context:e},i));case T.POW:return new se(r.__pow__({context:e},i));case T.MOD:return new se(r.__mod__({context:e},i));case T.EQUALS:return new se(r.__eq__({context:e},i));case T.LT:return new se(r.__lt__({context:e},i));case T.GT:return new se(r.__gt__({context:e},i));case T.AND:return new se(r.__and__({context:e},i));case T.OR:return new se(r.__or__({context:e},i));case T.APMERSAND:return new se(r.__ampersand__({context:e},i));case T.PIPE:return new se(r.__pipe__({context:e},i));default:return new Ue(this.opTok.pos,`Invalid binary operator: ${O[this.opTok.type]}`)}}compileJS(e){const t=this.left.compileJS(e);if(t.error)return t;const n=this.right.compileJS(e);return n.error?n:e.minify?new oe(`${t.val}${O[this.opTok.type]}${n.val}`):new oe(`${t.val} ${O[this.opTok.type]} ${n.val}`)}compilePy(e){const t=this.left.compilePy(e);if(t.error)return t;const n=this.right.compilePy(e);if(n.error)return n;const r={"&&":"and","||":"or","^":"**"};let i=O[this.opTok.type];return i in r&&(i=r[i]),new oe(`${t.val} ${i} ${n.val}`)}}class ce extends ae{constructor(e,t,n){super(e),this.a=t,this.opTok=n}interpret_(e){var t,n,r;const i=this.a.interpret(e);if(i.error)return i.error;switch(this.opTok.type){case T.SUB:case T.ADD:if(!(i.val instanceof J))return new Fe(this.pos,"Number",(null===(t=i.val)||void 0===t?void 0:t.typeName().toString())||"undefined_",null===(n=i.val)||void 0===n?void 0:n.valueOf());const e=i.val.valueOf();return new se(new J(this.opTok.type===T.SUB?-e:Math.abs(e)));case T.NOT:return new se(new F(!(null===(r=null==i?void 0:i.val)||void 0===r?void 0:r.bool().valueOf())));case T.BITWISE_NOT:return new se(new U(i.val));case T.QM:return new se(new j(p.undefined,i.val));default:return new Ue(this.opTok.pos,`Invalid unary operator: ${O[this.opTok.type]}`)}}compileJS(e){const t=this.a.compileJS(e);return t.error?t:new oe(`${O[this.opTok.type]}${t.val}`)}compilePy(e){const t=this.a.compilePy(e);return t.error?t:new oe(`${O[this.opTok.type]}${t.val}`)}}class le extends ae{constructor(e,t,n,r="=",i=!1,s=!1,o=!1,a=p.any){super(e),this.value=n,this.varNameTok=t,this.isGlobal=i,this.assignType=r,this.isConstant=s,this.isDeclaration=o,this.type=a instanceof S?new Re(a):a}interpret_(e){var t,r;if(this.isDeclaration){if(e.hasOwn(this.varNameTok.value))return new Ue(this.pos,`Symbol '${this.varNameTok.value}' already exists, and cannot be redeclared`);if("="!==this.assignType)return new Ue(this.pos,`Cannot declare variable with operator '${this.assignType}'`)}const i=this.value.interpret(e),s=this.type.interpret(e);if(i.error)return i.error;if(s.error)return s.error;if(!s.val)return new Fe(this.varNameTok.pos,"Type","undefined");if(!i.val)return new Fe(this.varNameTok.pos,"~undefined","undefined","N_varAssign.interpret_");const o=s.val.type_check({context:e},i.val);if(o instanceof je)return o;if(!o.bool().valueOf())return new Fe(this.varNameTok.pos,Pe(s.val),Pe(null===(t=i.val)||void 0===t?void 0:t.typeName()),Pe(i.val));if(this.isDeclaration)return e.setOwn(this.varNameTok.value,i.val,{global:!1,isConstant:this.isConstant,type:s.val}),new se(i.val);if(e.has(this.varNameTok.value)){const t=e.getSymbol(this.varNameTok.value);if(t instanceof je)return t;if(t&&!t.type.type_check({context:e},i.val).valueOf())return new Fe(this.varNameTok.pos,Pe(t.type),null===(r=i.val)||void 0===r?void 0:r.typeName(),Pe(i.val))}if("="===this.assignType){let t=i.val;void 0===t&&(t=new $);const r=e.getSymbol(this.varNameTok.value);if(r instanceof je)return r;if(!r)return new Ue(this.pos,"Cannot declare variable without keyword");const s=r.type.type_check({context:e},i.val);if(s instanceof je)return s;if(!s.bool().valueOf())return new Fe(n.void,Pe(r.type),Pe(i.val.__type__),Pe(i.val));const o=e.set(this.varNameTok.value,t,{global:this.isGlobal,isConstant:this.isConstant,type:r.type});if(o instanceof je)return o}else{const t=e.get(this.varNameTok.value);if(t instanceof je)return t;if(null==t)return new Ue(this.pos,`Cannot declare variable with operator '${this.assignType}'`);let n,r=i.val;switch(this.assignType[0]){case"*":n=t.__multiply__({context:e},r);break;case"/":n=t.__divide__({context:e},r);break;case"+":n=t.__add__({context:e},r);break;case"-":n=t.__subtract__({context:e},r);break;default:return new je(this.pos,"AssignError",`Cannot find assignType of ${this.assignType[0]}`)}if(n instanceof je)return n;let s=e.set(this.varNameTok.value,n,{global:this.isGlobal,isConstant:this.isConstant,type:n.__type__});if(s instanceof je)return s;i.val=n}return"(anonymous)"!==i.val.info.name&&i.val.info.name||(i.val.info.name=this.varNameTok.value),i}compileJS(e){const t=this.value.compileJS(e);if(t.error)return t;let n="";this.isDeclaration&&(n=this.isGlobal?"var":this.isConstant?"const":"let");let r=this.assignType;return"="!==r&&(r+="="),e.minify?new oe(`${n} ${this.varNameTok.value}${r}${t.val}`):new oe(`${n} ${this.varNameTok.value} ${r} ${t.val}`)}compilePy(e){const t=new oe,n=this.value.compilePy(e);if(n.error)return n;t.hoisted+=n.hoisted;let r=this.assignType;return"="!==r&&(r+="="),this.isGlobal&&(t.hoisted+=`${this.varNameTok.value}=None`),e.minify?t.val=`${this.varNameTok.value}${r}${n.val}`:t.val=`${this.varNameTok.value} ${r} ${n.val}`,t}}class he extends ae{constructor(e,t,n,r,i=!1,s=!1){super(e),this.value=r,this.varNames=t,this.types=n,this.isGlobal=i,this.isConstant=s}interpret_(e){for(let t of this.varNames)if(e.hasOwn(t))return new Ue(this.pos,`Symbol '${t}' already exists, and cannot be redeclared`);const t=this.value.interpret(e);if(t.error)return t.error;if(t.val instanceof L||t.val instanceof q){if(this.varNames.length>t.val.valueOf().length)return new Fe(n.void,`[Any * >=${this.varNames.length}]`,`[Any * <${this.varNames.length}]`,Pe(t.val));let r=0;for(let i of this.varNames){let s=t.val.valueOf()[r];"string"==typeof s&&(s=new q(s));let o=this.types[r].interpret(e);if(o.error)return o;let a=o.val.type_check({context:e},s);if(a instanceof je)return a;if(!a.bool().valueOf())return new Fe(n.void,Pe(o.val),s.typeName(),Pe(s));e.setOwn(i,s,{global:this.isGlobal,isConstant:this.isConstant,type:t.val.__type__}),r++}return new se(t.val)}let r=0;for(let i of this.varNames){let s=t.val.__get_property__({context:e},new q(i));if(s instanceof je)return s;let o=this.types[r].interpret(e);if(o.error)return o;let a=o.val.type_check({context:e},s);if(a instanceof je)return a;if(!a.bool().valueOf())return new Fe(n.void,Pe(o.val),s.typeName(),Pe(s));e.setOwn(i,s,{global:this.isGlobal,isConstant:this.isConstant,type:t.val.__type__}),r++}return new se(t.val)}compileJS(e){const t=this.value.compileJS(e);if(t.error)return t;let n="";return n=this.isGlobal?"var":this.isConstant?"const":"let",e.minify?new oe(`${n}[${this.varNames.join(",")}]=${t.val}`):new oe(`${n} [${this.varNames.join(", ")}] = ${t.val}`)}compilePy(e){const t=this.value.compileJS(e);return t.error?t:new oe(`${this.varNames.join(", ")} = ${t.val}`)}}class fe extends ae{constructor(e,t,n,r){super(e),this.comparison=t,this.ifFalse=r,this.ifTrue=n}interpret_(e){var t;let n=new re;n.parent=e;let r=new se,i=this.comparison.interpret(e);return i.error?i:(null===(t=i.val)||void 0===t?void 0:t.bool().valueOf())?this.ifTrue.interpret(n):this.ifFalse?this.ifFalse.interpret(n):r}compileJS(e){const t=" ".repeat(e.indent),n=" ".repeat(e.indent+4);e.indent+=4;const r=this.comparison.compileJS(e);if(r.error)return r;const i=this.ifTrue.compileJS(e);if(i.error)return i;if(!this.ifFalse)return e.minify?new oe(`if(${r.val}){${i.val}\n}`):new oe(`if (${r.val}) {\n${i.val}\n}`);e.indent=n.length;let s=this.ifFalse.compileJS(e);return s.error?s:(this.ifFalse instanceof we||(s.val=n+s.val),e.minify?new oe(`if(${r.val}){${i.val}}else{${s.val}}`):new oe(`if (${r.val}) {\n${i.val}\n${t}} else {\n${s.val}\n${t}}`))}compilePy(e){const t=new oe,n=" ".repeat(e.indent),r=" ".repeat(e.indent+4);e.indent+=4;const i=this.comparison.compilePy(e);if(i.error)return i;t.hoisted+=i.hoisted;const s=this.ifTrue.compilePy(e);if(s.error)return s;if(t.hoisted+=s.hoisted,!this.ifFalse)return new oe(`if ${i.val}:\n${r}${s.val}`);const o=this.ifFalse.compilePy(e);return o.error?o:(t.hoisted+=o.hoisted,this.ifFalse instanceof we||(o.val=r+o.val),new oe(`if ${i.val}:\n${s.val}\n${n}else:\n${o.val}\n${n}`))}}class _e extends ae{constructor(e,t,n){super(e),this.comparison=t,this.loop=n}interpret_(e){for(var t,n;;){let r=new re;r.parent=e;let i=this.comparison.interpret(e);if(i.error)return i;if(!(null===(n=null===(t=i.val)||void 0===t?void 0:t.bool())||void 0===n?void 0:n.valueOf()))break;let s=this.loop.interpret(r);if(s.error)return s;if(s.shouldBreak)break}return new se(new $)}compileJS(e){e.indent+=4;const t=this.comparison.compileJS(e);if(t.error)return t;const n=this.loop.compileJS(e);return n.error?n:e.minify?new oe(`while(${t.val}){${n.val}}`):new oe(`while (${t.val}) {\n${n.val}}`)}compilePy(e){const t=new oe,n=" ".repeat(e.indent||0),r=this.comparison.compilePy(e);if(r.error)return r;t.hoisted+=r.hoisted;const i=this.loop.compilePy(e);return i.error?i:(t.hoisted+=i.hoisted,new oe(`while ${r.val}:\n${n}${i.val}`))}}class pe extends ae{constructor(e,t,n,r,i,s){super(e),this.body=t,this.array=n,this.identifier=r,this.isGlobalId=i,this.isConstId=s}interpret_(e){var t,n,r;const i=this.array.interpret(e);if(i.error)return i;if(e.has(this.identifier.value)&&this.isGlobalId)return new Ue(this.identifier.pos,"Cannot declare global variable which exists in the current scope");function s(t,n,r,i,s){let o=new re;o.parent=e,o.set(n,r,{global:i,isConstant:s,type:r.__type__});const a=t.interpret(o);return a.error||void 0!==a.funcReturn?a:a.shouldBreak?(a.shouldBreak=!1,"break"):void(a.shouldContinue&&(a.shouldContinue=!1))}if(i.val instanceof J)for(let e=0;e<i.val.valueOf();e++){const t=s(this.body,this.identifier.value,new J(e),this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}else if(i.val instanceof N||i.val instanceof I)for(let e in null===(t=i.val)||void 0===t?void 0:t.valueOf()){const t=s(this.body,this.identifier.value,new q(e),this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}else if(i.val instanceof L)for(let e of null===(n=i.val)||void 0===n?void 0:n.valueOf()){const t=s(this.body,this.identifier.value,e,this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}else{if(!(i.val instanceof q))return new Fe(this.identifier.pos,"Array | Number | Object | String",typeof i.val);for(let e of null===(r=i.val)||void 0===r?void 0:r.valueOf()){const t=s(this.body,this.identifier.value,new q(e),this.isGlobalId,this.isConstId);if("break"===t)break;if(t&&(t.error||void 0!==t.funcReturn))return t}}return new se(new $)}compileJS(e){const t=" ".repeat(e.indent);e.indent+=4;const n=this.array.compileJS(e);if(n.error)return n;const r=this.body.compileJS(e);if(r.error)return r;let i="let";return this.isGlobalId?i="var":this.isConstId&&(i="const"),e.minify?new oe(`for(${i} ${this.identifier.value} of ${n.val}){${r.val}\n${t}}`):new oe(`for (${i} ${this.identifier.value} of ${n.val}) {\n${r.val}\n${t}}`)}compilePy(e){const t=new oe;e.indent+=4;const n=t.register(this.array,e);if(t.error)return t;const r=t.register(this.body,e);return t.error||(this.isGlobalId&&(t.hoisted+=`${this.identifier.value}=None`),t.val=`for ${this.identifier.value} in ${n}:\n${r}`),t}}class de extends ae{constructor(e,t,n=!1){super(e),this.items=t,this.shouldClone=n}interpret_(e){let t=new se,n=[];for(let t of this.items){const r=t.interpret(e);if(r.error||void 0!==r.funcReturn)return r;if(!r.val)continue;let i=r.val;this.shouldClone&&(i=i.clone()),n.push(i)}return t.val=new L(n),t}compileJS(e){const t=new oe("[");for(let n of this.items){const r=n.compileJS(e);if(r.error)return r;t.val+=r.val+","}return t.val+="]",t}compilePy(e){const t=new oe("[");for(let n of this.items){const r=t.register(n,e);if(t.error)return t;t.val+=r+","}return t.val+="]",t}}class ve extends ae{constructor(e,t){super(e),this.properties=t}interpret_(e){let t={};for(const[n,r]of this.properties){const i=r.interpret(e);if(i.error)return i.error;const s=n.interpret(e);if(s.error)return s.error;s.val&&i.val&&(t[s.val.valueOf()]=i.val)}return new se(new N(t))}compileJS(e){const t=new oe("{");for(const[n,r]of this.properties){const i=r.compileJS(e);if(i.error)return i;const s=n.compileJS(e);if(s.error)return s;s.val&&i.val&&(t.val+=`[${s.val}]: ${i.val},`)}return t.val+="}",t}compilePy(e){const t=new oe("{");for(const[n,r]of this.properties){const i=t.register(r,e);if(t.error)return t;const s=t.register(n,e);if(t.error)return t;s&&i&&(t.val+=`${s}: ${i},`)}return t.val+="}",t}}class we extends ae{constructor(e,t,n=!1){super(e),this.items=t,this.topLevel=n}interpret_(e){if(this.topLevel){let t=new se,n=[];for(let t of this.items){const r=t.interpret(e);if(r.error||void 0!==r.funcReturn)return r;if(!r.val)continue;let i=r.val.clone();n.push(i)}return t.val=new L(n),t}{let t;for(let n of this.items){const r=n.interpret(e);if(r.error||void 0!==r.funcReturn||r.shouldBreak||r.shouldContinue)return r;t=r.val}return new se(t||new $)}}compileJS(e){const t=new oe,n=" ".repeat(e.indent);t.val+=n;for(let r of this.items){const i=r.compileJS(e);if(i.error)return i;t.val+=i.val+";",e.minify||(t.val+="\n"+n)}return t}compilePy(e){const t=new oe,n=" ".repeat(e.indent);t.val+=n;for(let r of this.items){const i=t.register(r,e);if(t.error)return t;t.val+=i,t.val+="\n"+n}return t}}class me extends ae{constructor(e,t,n){super(e),this.arguments=n,this.to=t}interpret_(e){let{val:t,error:n}=this.to.interpret(e);if(n)return n;if(!t)return new Fe(this.pos,"any","undefined",void 0,"On function call");let r=[];for(let t of this.arguments){const n=t.interpret(e);if(n.error)return n.error;n.val&&r.push(n.val)}const i=t.__call__({context:e},...r);return i instanceof je&&i.traceback.push({position:this.pos,line:`${t.info.name||"<AnonFunction>"}(${r.map(Pe).join(", ")})`}),new se(i)}compileJS(e){const t=new oe,n=this.to.compileJS(e);if(n.error)return n;t.val=n.val+"(";for(let n of this.arguments){const r=n.compileJS(e);if(r.error)return r;t.val+=r.val,n!==this.arguments[this.arguments.length-1]&&(t.val+=",",e.minify||(t.val+=" "))}return t.val+=")",t}compilePy(e){const t=new oe,n=t.register(this.to,e);if(t.error)return t;t.val=n+"(";for(let n of this.arguments){const r=t.register(n,e);if(t.error)return t;t.val+=r,n!==this.arguments[this.arguments.length-1]&&(t.val+=",",e.minify||(t.val+=" "))}return t.val+=")",t}}class ye extends ae{constructor(e,t,n,r,i="(anon)",s=new N,o=""){super(e),this.isDeclaration=!1,this.arguments=n,this.body=t,this.name=i,this.this_=s,this.returnType=r,this.description=o}interpret_(e){let t=[];for(let n of this.arguments){const r=ie(n,e);if(r instanceof je)return r;t.push(r)}const r=this.returnType.interpret(e);if(r.error)return r.error;let i=new C(this.body,t,this.name,this.this_,r.val,e);if(this.isDeclaration){if(e.hasOwn(this.name))return new Ue(n.void,`Cannot redeclare symbol '${this.name}'`);e.setOwn(this.name,i,{isConstant:!0,type:p.function})}return new se(i)}compileJS(e){const t=new oe("function(");for(let n of this.arguments)t.val+=n.name+",",e.minify||(t.val+=" ");e.minify?t.val+="){":t.val+=") {\n";const n=" ".repeat(e.indent);e.indent+=4;const r=this.body.compileJS(e);return r.error?r:(t.val+=`${r.val}\n${n}}`,t)}compilePy(e){const t=new oe,n=Me(e.symbols);t.hoisted=`def ${n}(`;for(let n of this.arguments)t.hoisted+=n.name+",",e.minify||(t.hoisted+=" ");const r=" ".repeat(e.indent);e.indent+=4;const i=this.body.compilePy(e);return i.error?i:(t.hoisted+=`):\n${r}${i.val}`,t.hoisted=i.hoisted+t.hoisted,t.val=n,t)}}class Te extends ae{constructor(e,t){super(e),this.value=t}interpret_(e){const t=new se;if(void 0===this.value)return t.funcReturn=new $,t;let n=this.value.interpret(e);return n.error?n.error:(t.funcReturn=n.val,t)}compileJS(e){var t;const n=null===(t=this.value)||void 0===t?void 0:t.compileJS(e);return(null==n?void 0:n.error)?n:new oe(`return(${null==n?void 0:n.val})`)}compilePy(e){const t=new oe;if(!this.value)return new oe("return");const n=t.register(this.value,e);return t.error?t:new oe(`return ${n}`)}}class Oe extends ae{constructor(e,t){super(e),this.value=t}interpret_(e){var t;const n=new se;if(void 0===this.value)return n.funcReturn=new $,n;let r=this.value.interpret(e);return r.error?r.error:((null===(t=r.val)||void 0===t?void 0:t.bool().valueOf())&&(n.funcReturn=r.val),n)}compileJS(e){var t;const n=null===(t=this.value)||void 0===t?void 0:t.compileJS(e);return n&&n.val?new oe(`if(_=${n.val}){return(_))`):new oe("")}compilePy(e){if(!this.value)return new oe("");const t=(new oe).register(this.value,e);return new oe(t?`if _ := ${t}: return _`:"")}}class be extends ae{constructor(e,t,n){super(e),this.base=t,this.index=n}interpret_(e){var t;let n=this.base.interpret(e);if(n.error)return n;let r=this.index.interpret(e);if(r.error)return r;const i=r.val,s=n.val;if(!s||!i)return new se(new $);if(void 0!==this.value){let n=this.value.interpret(e);if(n.error)return n;const r=Y(s.__get_property__({context:e},i));let o,a=n.val;if(null!==(t=this.assignType)&&void 0!==t||(this.assignType="="),!a)return new Fe(this.pos,"~undefined","undefined","undefined","N_indexed.interpret_");switch(this.assignType[0]){case"*":o=r.__multiply__({context:e},a);break;case"/":o=r.__divide__({context:e},a);break;case"+":o=r.__add__({context:e},a);break;case"-":o=r.__subtract__({context:e},a);break;case"=":o=a;break;default:return new je(this.pos,"AssignError",`Cannot find assignType of ${this.assignType[0]}`)}if(o instanceof je)return o;if(!s.__set_property__)return new Fe(this.pos,"mutable","immutable",s.valueOf());const u=s.__set_property__({context:e},i,null!=o?o:new $);if(u instanceof je)return u}return new se(s.__get_property__({context:e},i))}compileJS(e){const t=this.base.compileJS(e);if(t.error)return t;const n=this.index.compileJS(e);if(n.error)return n;if(!this.value)return new oe(`${t.val}[${n.val}]`);const r=this.value.compileJS(e);return r.error?r:new oe(`${t.val}[${n.val}]${this.assignType||"="}${r.val}`)}compilePy(e){const t=new oe,n=t.register(this.base,e);if(t.error)return t;const r=t.register(this.index,e);if(t.error)return t;if(!this.value)return t.val=`${n}[${r}]`,t;const i=t.register(this.value,e);return t.error||(t.val=`${n}[${r}] ${this.assignType||"="} ${i}`),t}}class ge extends ae{constructor(e,t,n,r,i="<anon class>",s=!1){super(e),this.init=r,this.methods=t,this.name=i,this.extends_=n,this.isDeclaration=s}interpret_(e){var t,r,i;const s=[];for(let n of this.methods){const r=n.interpret(e);if(r.error)return r.error;if(!(r.val instanceof C))return new Fe(this.pos,"Function",(null===(t=r.val)||void 0===t?void 0:t.typeName().valueOf())||"undefined","method on "+this.name);s.push(r.val)}let o,a=p.object;if(this.extends_){const t=this.extends_.interpret(e);if(t.error)return t.error;if(!(t.val instanceof M))return new Fe(this.pos,"Type",(null===(r=t.val)||void 0===r?void 0:r.typeName().valueOf())||"undefined","method on "+this.name);a=t.val}if(this.init){const t=this.init.interpret(e);if(t.error)return t.error;if(!(t.val instanceof C))return new Fe(this.pos,"Function",(null===(i=t.val)||void 0===i?void 0:i.typeName().valueOf())||"undefined","method on "+this.name);o=t.val}let u=new M(!1,this.name,s,a,o);if(this.isDeclaration){if(e.hasOwn(this.name))return new Ue(n.void,`Cannot redeclare symbol '${this.name}'`);e.setOwn(this.name,u,{isConstant:!0,type:p.type})}return new se(u)}compileJS(e){return new oe("function(){return{};}")}compilePy(e){return new oe(`class ${this.name}:\n${" ".repeat(e.indent)}pass`)}}class ke extends ae{constructor(e,t,n="(anon)",r=!1){super(e),this.name=n,this.statements=t,this.mutable=r}interpret_(e){const t=new re;t.parent=e;const n=this.statements.interpret(t);return n.error?n:new se(new A(new q(this.name),t.getSymbolTableAsDict(),this.mutable))}compileJS(e){const t=this.statements.compileJS(e);return t.error?t:new oe(`(() => {${t.val}})()`)}compilePy(e){const t=new oe;return t.register(this.statements,e),t.error||(t.val="'namespace'"),t}}class Ee extends ae{constructor(e,t,n){super(e,!0),this.body=t,this.catchBlock=n}interpret_(e){const t=this.body.interpret(e);if(t.error){const n=new re;n.parent=e,n.setOwn("err",new x(t.error),{isConstant:!0});const r=this.catchBlock.interpret(n);if(r.error)return r.error}return new se}compileJS(e){const t=this.body.compileJS(e);if(t.error)return t;const n=this.catchBlock.compileJS(e);return n.error?n:new oe(`try{${t.val}}catch(err){${n.val}}`)}compilePy(e){const t=new oe,n=t.register(this.body,e);if(t.error)return t;const r=t.register(this.catchBlock,e);if(t.error)return t;const i=" ".repeat(e.indent),s=" ".repeat(e.indent+1);return t.val=`try:\n${s}${n}\n${i}except:\n${s}${r}`,t}}class Se extends ae{constructor(e,t){super(e,!0),this.a=t}interpret_(e){let t=this.a.value;const n=new se;return n.val=new J(t),n}compileJS(e){return new oe(this.a.value.toString())}compilePy(e){return new oe(this.a.value.toString())}}class xe extends ae{constructor(e,t){super(e,!0),this.a=t}interpret_(e){let t=this.a.value;const n=new se;return n.val=new q(t),n}compileJS(e){return new oe(`'${this.a.value}'`)}compilePy(e){return new oe(`'${this.a.value}'`)}}class Ne extends ae{constructor(e){super(e.pos,!0),this.a=e}interpret_(e){if(!e.has(this.a.value))return new We(this.a.pos,this.a.value);let t=new se,n=e.getSymbol(this.a.value);return n?n instanceof je?n:(t.val=n.value,t):new We(this.pos,`No access to undeclared variable ${this.a.value}`)}compileJS(e){let t=this.a.value.toString();return"import"===t&&(t="import_"),new oe(t)}compilePy(e){let t=this.a.value.toString();return"import"===t&&(t="import_"),new oe(t)}}class Ce extends ae{constructor(e=n.void){super(e,!0)}interpret_(e){const t=new se;return t.val=new $,t}compileJS(e){return new oe("undefined")}compilePy(e){return new oe("None")}}class $e extends ae{constructor(e){super(e,!0)}interpret_(e){const t=new se;return t.shouldBreak=!0,t}compileJS(e){return new oe("break")}compilePy(e){return new oe("break")}}class Ae extends ae{constructor(e){super(e,!0)}interpret_(e){const t=new se;return t.shouldContinue=!0,t}compileJS(e){return new oe("continue")}compilePy(e){return new oe("continue")}}class Re extends ae{constructor(e,t=n.void){super(t,!0),this.value=e}interpret_(e){return new se(this.value)}compileJS(e){return new oe(JSON.stringify(this.value.valueOf()))}compilePy(e){return new oe(JSON.stringify(this.value.valueOf()))}}function Ie(e,t=new WeakMap){let n;if(Object(e)!==e||e instanceof Function)return e;if(t.has(e))return t.get(e);try{n=new e.constructor}catch(t){n=Object.create(Object.getPrototypeOf(e))}return e instanceof Map?Array.from(e,(([e,r])=>n.set(Ie(e,t),Ie(r,t)))):e instanceof Set&&Array.from(e,(e=>n.add(Ie(e,t)))),t.set(e,n),Object.assign(n,...Object.keys(e).map((n=>({[n]:Ie(e[n],t)}))))}function Pe(e,t=0){if("string"==typeof e)return t>0?`'${e}'`:e;if(t>20)return"...";let n="";if(void 0===e)return"undefined";if(e instanceof S)return e.str().valueOf();if(e instanceof ae)return`<RunTimeNode: ${e.constructor.name}>`;switch(typeof e){case"object":if(Array.isArray(e)){n+="[";for(let r of e)try{n+=Pe(r,t+1)+", "}catch(e){n+="<large property>, "}e.length&&(n=n.substring(0,n.length-2)),n+="]"}else{n+="{\n";let r=0;for(let i in e)r++,e.hasOwnProperty&&e.hasOwnProperty(i)&&(n+=`  ${i}: ${Pe(e[i],t+1)||""}, \n`);r>0&&(n=n.substring(0,n.length-3)),n+="\n}\n"}break;case"bigint":case"number":case"boolean":n=`${e}`;break;case"function":n=`<NativeFunction ${e.name}>`}for(let e=0;e<t;e++)n=Be(n);return n}const De=e=>new Promise((t=>setTimeout((()=>t()),e)));function Be(e){return e.replace(/\n/g,"\n    ")}function Me(e,t=10){const n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ_",r=()=>{let e="";for(let r=0;r<t;r++)e+=n.charAt(Math.floor(Math.random()*n.length));return e};let i=r();for(;-1!==e.indexOf(i);)i=r();return i}class je{constructor(e,t,n){this.traceback=[],this.pos=e,this.name=t,this.details=n}get colouredStr(){let e="";if(this.traceback.length){e=X.yellow("Error Traceback (most recent call last):\n");for(let t of[...this.traceback].reverse())e+=`    ${X.cyan(t.position.str)}:\n        ${t.line}\n`}return e+=`${X.red(this.name)}: ${this.details} \n at ${X.cyan(this.pos.str)}`,e}get str(){return`${this.name}: ${this.details} \n at ${this.pos.str}`}}class Ge extends je{constructor(e,t){super(e,"IllegalCharError",`'${t}'`)}}class Ue extends je{constructor(e,t){super(e,"InvalidSyntaxError",t)}}class Je extends je{constructor(e,t){super(e,"ExpectedCharError",`'${t}'`)}}class Fe extends je{constructor(e,t,n,r="",i=""){super(e,"TypeError",`Expected type '${t}', got type '${n}' ${void 0===r?"":` on value '${Pe(r)}'`} ${i||""}`)}}class Le extends je{constructor(e,t,n=""){super(e,"ImportError",`Could not import ${t}: ${n}`)}}class We extends je{constructor(e,t){super(e,"ReferenceError",`${t} is not defined`)}}class qe extends je{constructor(e,t,n){var r;super(e,"IndexError",`'${t}' is not a property of '${(null===(r=null==n?void 0:n.info)||void 0===r?void 0:r.name)||Pe(n)}'`)}}class Qe extends je{constructor(e,t,r="",i=n.void){var s;super(i,"TypeError",`Cannot perform '${e}' on value ${(null===(s=null==t?void 0:t.info)||void 0===s?void 0:s.name)||Pe(t)}: ${r}`)}}class Ye extends je{constructor(){super(n.void,"InvalidRuntimeError","Required runtime of "+(u?"browser":"node"))}}class Ke extends je{constructor(e){super(n.void,"TestFailed",e)}}class Ve extends je{constructor(e){super(n.void,"PermissionRequiredError",e)}}class He extends je{constructor(e){super(n.void,"MissingNativeDependencyError",`Missing required native dependency '${e}'. This is probably an issue with the EntropyScript provider, not your code.`)}}class Xe{constructor(e,t,n){this.type=t,this.value=n,this.pos=e}matches(e,t){return this.type===e&&this.value===t}}class ze{constructor(e,t){this.text=e,this.position=new n(-1,0,-1,t),this.advance()}advance(){this.position.advance(this.currentChar),this.currentChar=this.text[this.position.idx]}generate(){if(!this.text)return[new Xe(this.position,T.EOF,void 0)];const e=[];for(;void 0!==this.currentChar;)if(" \t\n".includes(this.currentChar))this.advance();else if(r.includes(this.currentChar))e.push(this.makeNumber());else if(this.currentChar==="//"[0]&&this.text[this.position.idx+1]==="//"[1])this.singleLineComment();else if(this.currentChar==="/*"[0]&&this.text[this.position.idx+1]==="/*"[1])this.multiLineComment();else if(i.includes(this.currentChar))e.push(this.makeIdentifier());else if(-1!==a.indexOf(this.currentChar))e.push(this.makeString());else{const t=this.currentChar;let n=this.unknownChar();if(!n){let e=this.position.clone,t=this.currentChar;return this.advance(),new Ge(e,t)}n.type===T.ASSIGN&&(n.value=t),e.push(n)}return e.push(new Xe(this.position,T.EOF,void 0)),e}makeNumber(){const e=this.position.clone;let t="",n=0;for(;void 0!==this.currentChar&&(r+"._").includes(this.currentChar);){if("."===this.currentChar){if(1===n)break;n++,t+="."}else"_"!==this.currentChar&&(t+=this.currentChar);this.advance()}return new Xe(e,T.NUMBER,parseFloat(t))}makeString(){const e=this.position.clone;let t="",n=this.currentChar;for(this.advance();this.currentChar!==n&&void 0!==this.currentChar;)"\\"!==this.currentChar||(this.advance(),"n"!==this.currentChar)?(t+=this.currentChar,this.advance()):(t+="\n",this.advance());return this.advance(),new Xe(e,T.STRING,t)}makeIdentifier(){let e="";const t=this.position.clone;for(;void 0!==this.currentChar&&(i+r).includes(this.currentChar);)e+=this.currentChar,this.advance();let n=T.IDENTIFIER;return-1!==v.indexOf(e)&&(n=T.KEYWORD),new Xe(t,n,e)}unknownChar(){if(void 0!==this.currentChar){for(let e in k)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]&&e[2]===this.text[this.position.idx+2]){const t=this.position.clone;return this.advance(),this.advance(),this.advance(),new Xe(t,k[e],void 0)}for(let e in g)if(e[0]===this.currentChar&&e[1]===this.text[this.position.idx+1]){const t=this.position.clone;return this.advance(),this.advance(),new Xe(t,g[e],void 0)}if(b.hasOwnProperty(this.currentChar)){let e=this.position.clone,t=b[this.currentChar];return this.advance(),new Xe(e,t,void 0)}}}singleLineComment(){for(this.advance();"\n"!==this.currentChar&&void 0!==this.currentChar;)this.advance();this.advance()}multiLineComment(){for(this.advance();this.currentChar!=="*/"[0]||this.text[this.position.idx+1]!=="*/"[1];)this.advance();this.advance(),this.advance()}}class Ze{constructor(){this.advanceCount=0,this.lastRegisteredAdvanceCount=0,this.reverseCount=0}registerAdvance(){this.advanceCount=1,this.lastRegisteredAdvanceCount++}register(e){return this.lastRegisteredAdvanceCount=e.advanceCount,this.advanceCount+=e.advanceCount,e.error&&(this.error=e.error),e.node?e.node:new Ce}tryRegister(e){if(!e.error)return this.register(e);this.reverseCount+=e.advanceCount}success(e){return this.node=e,this}failure(e){return this.error=e,this}}class et{constructor(e){this.tokens=e,this.tokenIdx=-1,this.currentToken=e[0],this.advance()}parse(){var e;if(!this.currentToken||!this.tokens||1===this.tokens.length&&this.tokens[0].type===T.EOF)return new Ze;const t=this.statements(!0);return t.error||this.currentToken.type===y.EOF?t:t.failure(new Ue(null===(e=this.currentToken)||void 0===e?void 0:e.pos,`Expected 'End of File', got token of type '${O[this.currentToken.type]}'`))}advance(e){return e&&e.registerAdvance(),this.tokenIdx++,this.currentToken=this.tokens[this.tokenIdx],this.currentToken}reverse(e=1){return this.tokenIdx-=e,this.currentToken=this.tokens[this.tokenIdx],this.currentToken}consume(e,t,n){if(this.currentToken.type!==t)return e.failure(new Ue(this.currentToken.pos,null!=n?n:`Expected '${O[t]}' but got '${O[this.currentToken.type]}'`));this.advance(e)}clearEndStatements(e){for(;this.currentToken.type===T.ENDSTATEMENT;)this.advance(e)}statements(e=!1){const t=new Ze,n=this.currentToken.pos;let r=[];this.clearEndStatements(t);const i=t.register(this.statement());if(t.error)return t;if(!i)return t;r.push(i);let s=!0;for(;;){let e=0;for(;this.currentToken.type===T.ENDSTATEMENT;)this.advance(t),e++;if(0===e&&(s=!1),!s)break;const n=t.tryRegister(this.statement());if(t.error)return t;n?r.push(n):this.reverse(t.reverseCount)}this.clearEndStatements(t);let o=new we(n,r,e);return t.success(o)}statement(){const e=new Ze,t=this.currentToken.pos;if(this.currentToken.matches(T.KEYWORD,"return"))return this.returnStatement(e);if(this.currentToken.matches(T.KEYWORD,"yield"))return this.returnStatement(e,!0);if(this.currentToken.matches(T.KEYWORD,"break"))return this.advance(e),e.success(new $e(t));if(this.currentToken.matches(T.KEYWORD,"continue"))return this.advance(e),e.success(new Ae(t));if(this.currentToken.matches(T.KEYWORD,"try"))return this.tryCatch();if(this.currentToken.matches(y.KEYWORD,"while"))return this.whileExpr();if(this.currentToken.matches(y.KEYWORD,"for"))return this.forExpr();const n=e.register(this.expr());return e.error?e:e.success(n)}returnStatement(e,t=!1){const n=this.currentToken.pos;this.advance(e);let r=new Ce(this.currentToken.pos);if(this.currentToken.type!==T.ENDSTATEMENT){let t=e.register(this.expr());if(!t)return e.failure(new Ue(this.currentToken.pos,"Expected end of statement"));r=t}return t?e.success(new Oe(n,r)):e.success(new Te(n,r))}atom(){const e=new Ze,t=this.currentToken,n=this.currentToken.pos;switch(t.type){case T.NUMBER:return this.advance(e),e.success(new Se(n,t));case T.STRING:return this.advance(e),e.success(new xe(n,t));case T.IDENTIFIER:return this.atomIdentifier(e,n,t);case T.OPAREN:this.advance(e);const r=e.register(this.expr());return e.error?e:this.currentToken.type===T.CPAREN?(this.advance(e),e.success(r)):e.failure(new Ue(this.currentToken.pos,"Expected ')'"));case T.OSQUARE:let i=e.register(this.array());return e.error?e:e.success(i);case T.OBRACES:let s=e.register(this.object());return e.error?e:e.success(s);case T.KEYWORD:if("if"===t.value){const t=e.register(this.ifExpr());return e.error?e:e.success(t)}return e.failure(new Ue(this.currentToken.pos,`Invalid Identifier ${t.value}`));default:return e.failure(new Ue(this.currentToken.pos,"Expected number, identifier, '(', '+' or '-'"))}}atomIdentifier(e,t,n){this.advance(e);let r=new Ne(n),i=new Ce(t),s=!1;for(;-1!==[T.OPAREN,T.OSQUARE,T.DOT].indexOf(this.currentToken.type);)switch(this.currentToken.type){case T.OPAREN:s=!0;const t=r;if(r=e.register(this.makeFunctionCall(r)),i=t,e.error)return e;break;case T.OSQUARE:if(i=r,r=e.register(this.makeIndex(r)),e.error)return e;break;case T.DOT:if(this.advance(e),this.currentToken.type!==T.IDENTIFIER)return e.failure(new Ue(this.currentToken.pos,"Expected identifier after '.'"));i=r,r=new be(this.currentToken.pos,r,new xe(this.currentToken.pos,this.currentToken)),this.advance(e)}if(this.currentToken.type===T.ASSIGN){let n=this.currentToken.value;if(s)return e.failure(new Ue(t,"Cannot assign to return value of function"));this.advance(e);const i=e.register(this.expr());if(r instanceof Ne)r=new le(t,r.a,i,n,!1);else{if(!(r instanceof be))return e.failure(new Ue(t,`Cannot have node of type ${this.currentToken.constructor.name}.\n                            Expected either index or variable node.`));r.value=i,r.assignType=n}if(e.error)return e}return e.success(r)}power(){return this.binOp((()=>this.atom()),[T.POW,T.MOD,T.APMERSAND,T.PIPE],(()=>this.factor()))}factor(){const e=new Ze,t=this.currentToken;if(t.type===T.ADD||t.type===T.SUB||t.type===T.BITWISE_NOT||t.type===T.QM){this.advance(e);const n=e.register(this.factor());return e.error?e:e.success(new ce(t.pos,n,t))}return this.power()}term(){return this.binOp((()=>this.factor()),[T.MUL,T.DIV])}arithmeticExpr(){return this.binOp((()=>this.term()),[T.ADD,T.SUB])}comparisonExpr(){const e=new Ze;if(this.currentToken.type===T.NOT){const t=this.currentToken;this.advance(e);let n=e.register(this.expr());return e.error?e:e.success(new ce(t.pos,n,t))}if(this.currentToken.type===T.BITWISE_NOT){const t=this.currentToken;this.advance(e);let n=e.register(this.expr());return e.error?e:e.success(new ce(t.pos,n,t))}let t=e.register(this.binOp((()=>this.arithmeticExpr()),[T.EQUALS,T.NOTEQUALS,T.GT,T.GTE,T.LTE,T.LT]));return e.error?e:e.success(t)}expr(){const e=new Ze;if(this.clearEndStatements(e),this.currentToken.type===T.KEYWORD&&-1!==l.indexOf(this.currentToken.value))return this.initiateVar(e);if(this.currentToken.matches(y.KEYWORD,"func"))return this.funcExpr();if(this.currentToken.matches(y.KEYWORD,"class"))return this.classExpr();if(this.currentToken.matches(y.KEYWORD,"namespace"))return this.namespace();let t=e.register(this.binOp((()=>this.comparisonExpr()),[T.AND,T.OR]));return e.error?e:e.success(t)}binOp(e,t,n=e){const r=new Ze;let i=r.register(e());if(r.error)return r;for(;-1!==t.indexOf(this.currentToken.type)||-1!==t.indexOf([this.currentToken.type,this.currentToken.value]);){const e=this.currentToken;this.advance(r);const t=r.register(n());if(r.error)return r;i=new ue(i.pos,i,e,t)}return r.success(i)}makeFunctionCall(e){const t=new Ze;let n=[];const r=this.currentToken.pos;if(this.currentToken.type!==T.OPAREN)return t.failure(new Ue(r,"Expected '['"));if(this.advance(t),this.currentToken.type===T.CPAREN)return this.advance(t),t.success(new me(r,e,[]));if(n.push(t.register(this.expr())),t.error)return t.failure(new Ue(this.currentToken.pos,"Invalid argument"));for(;this.currentToken.type===T.COMMA;)if(this.advance(t),n.push(t.register(this.expr())),t.error)return t;return this.currentToken.type!==T.CPAREN?t.failure(new Ue(this.currentToken.pos,"Expected ',' or ')'")):(this.advance(t),t.success(new me(r,e,n)))}makeIndex(e){const t=new Ze,n=this.currentToken.pos,r=e;if(this.currentToken.type!==T.OSQUARE)return t.failure(new Ue(n,"Expected '["));if(this.advance(t),this.currentToken.type===T.CSQUARE)return t.failure(new Ue(n,"Cannot index without expression"));let i=t.register(this.expr());return t.error?t.failure(new Ue(this.currentToken.pos,"Invalid index")):this.currentToken.type!==T.CSQUARE?t.failure(new Ue(this.currentToken.pos,"Expected ']'")):(this.advance(t),t.success(new be(n,r,i)))}typeExpr(e){if(this.currentToken.type===T.IDENTIFIER){const t=this.currentToken;return this.advance(e),e.success(new Ne(t))}return this.expr()}destructuring(e,t,n){const r=new Ze;if(this.advance(r),r.error)return r;let i=[],s=[];if(this.currentToken.type===T.CSQUARE){if(this.consume(r,T.CSQUARE),!this.currentToken.matches(T.ASSIGN,"="))return r.failure(new Ue(this.currentToken.pos,"Expected '='"));this.consume(r,T.ASSIGN);let i=r.register(this.expr());return r.error?r:r.success(new he(e,[],[],i,n,t))}for(;;){if(this.currentToken.type!==T.IDENTIFIER)return r.failure(new Ue(this.currentToken.pos,"Expected identifier"));if(i.push(this.currentToken),this.advance(r),this.currentToken.type===T.COLON){this.consume(r,T.COLON);let e=r.register(this.typeExpr(r));if(r.error)return r;s.push(e)}else s.push(new Re(p.any));if(this.currentToken.type===T.CSQUARE){this.consume(r,T.CSQUARE);break}if(this.consume(r,T.COMMA),r.error)return r}if(!this.currentToken.matches(T.ASSIGN,"="))return r.failure(new Ue(this.currentToken.pos,"Expected '='"));this.consume(r,T.ASSIGN);let o=r.register(this.expr());return r.error?r:r.success(new he(e,i.map((e=>e.value)),s,o,n,t))}initiateVar(e){let t=this.currentToken.pos,n=!0,r=!1,i=!1;if(this.currentToken.type===T.KEYWORD&&"let"===this.currentToken.value){if(i=!0,this.advance(e),e.error)return e;if(this.currentToken.type===T.KEYWORD&&"global"===this.currentToken.value&&(i=!0,r=!0,this.advance(e),e.error))return e;if(this.currentToken.type===T.KEYWORD&&"var"===this.currentToken.value&&(i=!0,n=!1,this.advance(e),e.error))return e}if(this.currentToken.type===T.KEYWORD)return e.failure(new Ue(this.currentToken.pos,`Expected variable declaration keyword, not ${this.currentToken.value}`));if(this.currentToken.type===T.OSQUARE)return this.destructuring(t,n,r);if(this.currentToken.type!==y.IDENTIFIER)return e.failure(new Ue(this.currentToken.pos,"Expected Identifier, '[' or '{'"));const s=this.currentToken;this.advance(e);let o=p.any;if(this.currentToken.type===T.COLON&&(i=!0,this.consume(e,T.COLON),o=e.register(this.typeExpr(e))),this.currentToken.type!==T.ASSIGN)return n?e.failure(new Ue(t,"Cannot initialise constant to undefined")):e.success(new le(t,s,new Ce(this.currentToken.pos),"=",r,n,i,o));let a=this.currentToken.value;this.advance(e);const u=e.register(this.expr());return e.error?e:((u instanceof ge||u instanceof ye)&&(u.name=s.value),u instanceof ke&&(u.name=s.value,u.mutable=!n),e.success(new le(t,s,u,a,r,n,i,o)))}bracesExp(){const e=new Ze;if(this.consume(e,T.OBRACES),e.error)return e;if(this.clearEndStatements(e),this.currentToken.type===T.CBRACES)return this.advance(e),e.success(new Ce(this.currentToken.pos));const t=e.register(this.statements());return e.error?e:(this.consume(e,T.CBRACES),e.error?e:e.success(t))}addEndStatement(e){this.tokens.splice(this.tokenIdx,0,new Xe(this.currentToken.pos,T.ENDSTATEMENT,void 0)),this.reverse(),this.advance(e)}ifExpr(){const e=new Ze;let t,n,r;const i=this.currentToken.pos;if(!this.currentToken.matches(T.KEYWORD,"if"))return e.failure(new Ue(this.currentToken.pos,"Expected 'if'"));if(this.advance(e),r=e.register(this.expr()),e.error)return e;if(t=e.register(this.bracesExp()),e.error)return e;if(this.clearEndStatements(e),this.currentToken.matches(T.KEYWORD,"else"))if(this.advance(e),this.currentToken.type==T.OBRACES){if(n=e.register(this.bracesExp()),e.error)return e}else if(n=e.register(this.statement()),e.error)return e;return this.addEndStatement(e),e.success(new fe(i,r,t,n))}whileExpr(){const e=new Ze;let t,n;const r=this.currentToken.pos;return this.currentToken.matches(T.KEYWORD,"while")?(this.advance(e),n=e.register(this.expr()),e.error?e:(t=e.register(this.bracesExp()),e.error?e:(this.addEndStatement(e),e.success(new _e(r,n,t))))):e.failure(new Ue(this.currentToken.pos,"Expected 'while'"))}parameter(e){let t,n,r=new Re(p.any);if(this.currentToken.type!==T.IDENTIFIER)return new Ue(this.currentToken.pos,"Expected identifier");if(t=this.currentToken.value,this.advance(e),this.currentToken.type===T.COLON){if(this.consume(e,T.COLON),e.error)return e.error;if(r=e.register(this.typeExpr(e)),e.error)return e.error}if(this.currentToken.matches(T.ASSIGN,"=")){if(this.consume(e,T.ASSIGN),e.error)return e.error;if(n=e.register(this.expr()),e.error)return e.error}return{name:t,type:r,defaultValue:n}}funcCore(){const e=new Ze,t=this.currentToken.pos;let n,r=[],i=new Re(p.any);if(this.consume(e,T.OPAREN),this.currentToken.type===T.CPAREN)this.advance(e);else{let t=this.parameter(e);if(t instanceof je)return e.failure(t);r.push(t);let n=void 0!==r[0].defaultValue;for(;this.currentToken.type===T.COMMA;){this.advance(e);let t=this.currentToken.pos,i=this.parameter(e);if(i instanceof je)return e.failure(i);if(r.filter((e=>e.name===i.name)).length)return e.failure(new Ue(t,"Cannot have two parameters with the same name"));if(n&&!i.defaultValue)return e.failure(new Ue(this.currentToken.pos,"Must use default parameter here"));!n&&i.defaultValue&&(n=!0),r.push(i)}if(this.currentToken.type!==T.CPAREN)return e.failure(new Ue(this.currentToken.pos,"Expected ',' or ')'"));this.advance(e)}if(this.currentToken.type===T.COLON&&(this.advance(e),i=e.register(this.typeExpr(e)),e.error))return e;if(this.currentToken.type!==T.OBRACES){if(n=new Te(this.currentToken.pos,e.register(this.expr())),e.error)return e}else{if(this.consume(e,T.OBRACES),e.error)return e;if(n=this.currentToken.type!==T.CBRACES?e.register(this.statements()):new Ce(this.currentToken.pos),this.consume(e,T.CBRACES),e.error)return e}return e.success(new ye(t,n,r,i))}funcExpr(){const e=new Ze;let t;if(!this.currentToken.matches(T.KEYWORD,"func"))return e.failure(new Ue(this.currentToken.pos,"Expected 'func'"));this.advance(e),this.currentToken.type===T.IDENTIFIER&&(t=this.currentToken.value,this.advance(e));const n=e.register(this.funcCore());if(e.error)return e;if(void 0!==t){if(!(n instanceof ye))throw console.error("expected function"),"expected function";n.name=t,n.isDeclaration=!0}return e.success(n)}classExpr(e){const t=new Ze,n=this.currentToken.pos,r=[];let i,s,o=new Re(p.object);if(!this.currentToken.matches(T.KEYWORD,"class"))return t.failure(new Ue(this.currentToken.pos,"Expected 'class'"));if(this.advance(t),this.currentToken.type===T.IDENTIFIER&&(s=this.currentToken.value,e=s,this.advance(t)),this.currentToken.matches(T.KEYWORD,"extends")&&(this.advance(t),o=t.register(this.expr()),t.error))return t;if(this.consume(t,T.OBRACES),t.error)return t;if(this.currentToken.type===T.CBRACES)return this.advance(t),t.success(new ge(n,[],o,void 0,e,void 0!==s));for(;this.currentToken.type===T.IDENTIFIER;){let e=this.currentToken.value;this.advance(t);const n=t.register(this.funcCore());if(t.error)return t;if(!(n instanceof ye))return t.failure(new je(this.currentToken.pos,"ParseError",`Tried to get function, but got ${n} instead`));n.name=e,"init"===e?i=n:r.push(n)}return this.consume(t,T.CBRACES),t.success(new ge(n,r,o,i,e))}forExpr(){const e=new Ze,t=this.currentToken.pos;let n,r,i,s=!0;return this.currentToken.matches(T.KEYWORD,"for")?(this.advance(e),this.currentToken.matches(T.KEYWORD,"var")?(s=!1,this.advance(e)):this.currentToken.matches(T.KEYWORD,"let")&&this.advance(e),e.error?e:this.currentToken.type!==T.IDENTIFIER?e.failure(new Ue(this.currentToken.pos,"Expected identifier")):(i=this.currentToken,this.advance(e),this.currentToken.matches(T.KEYWORD,"in")?(this.advance(e),r=e.register(this.expr()),e.error?e:(n=e.register(this.bracesExp()),e.error?e:(this.addEndStatement(e),e.error?e:e.success(new pe(t,n,r,i,!1,s))))):e.failure(new Ue(this.currentToken.pos,"Expected keyword 'in")))):e.failure(new Ue(this.currentToken.pos,"Expected 'for'"))}array(){const e=new Ze;let t=[];const n=this.currentToken.pos;if(this.currentToken.type!==T.OSQUARE)return e.failure(new Ue(n,"Expected '["));if(this.advance(e),this.currentToken.type===T.CSQUARE)return this.advance(e),e.success(new de(n,[]));if(t.push(e.register(this.expr())),e.error)return e.failure(new Ue(this.currentToken.pos,"Unexpected token"));for(;this.currentToken.type===T.COMMA;)if(this.advance(e),t.push(e.register(this.expr())),e.error)return e;return this.currentToken.type!==T.CSQUARE?e.failure(new Ue(this.currentToken.pos,"Expected ',' or ']'")):(this.advance(e),e.success(new de(n,t)))}object(){const e=new Ze;let t=[];const n=this.currentToken.pos;if(this.currentToken.type!==T.OBRACES)return e.failure(new Ue(n,"Expected '{"));if(this.advance(e),this.currentToken.type===T.CBRACES)return this.advance(e),e.success(new ve(n,[]));for(;;){let n,r,i;if(this.currentToken.type===T.IDENTIFIER)n="id",r=new xe(this.currentToken.pos,this.currentToken),this.advance(e);else if(this.currentToken.type===T.STRING)n="string",r=new xe(this.currentToken.pos,this.currentToken),this.advance(e);else{if(this.currentToken.type!==T.OSQUARE)break;if(n="value",this.advance(e),r=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==T.CSQUARE)return e.failure(new Ue(this.currentToken.pos,`Expected ']', got '${O[this.currentToken.type]}'`));this.advance(e)}if(this.currentToken.type===T.COLON){if(this.advance(e),i=e.register(this.expr()),e.error)return e;if(this.currentToken.type!==T.COMMA&&this.currentToken.type!==T.CBRACES)return e.failure(new Ue(this.currentToken.pos,`Expected ',' or '}', got '${O[this.currentToken.type]}'`));this.currentToken.type===T.COMMA&&this.advance(e)}else{if(this.currentToken.type!==T.COMMA&&this.currentToken.type!==T.CBRACES)return e.failure(new Ue(this.currentToken.pos,`Expected ',' or '}', got '${O[this.currentToken.type]}'`));if("id"!==n)return e.failure(new Ue(this.currentToken.pos,"You must specify a value when initialising an object literal with a key that is not an identifier.\n                        Try using `key: value` syntax."));this.reverse(),i=new Ne(this.currentToken),this.advance(e),this.currentToken.type===T.COMMA&&this.advance(e)}if(t.push([r,i]),e.error)return e}return this.currentToken.type!==T.CBRACES?e.failure(new Ue(this.currentToken.pos,"Expected identifier, ',' or '}'")):(this.advance(e),e.success(new ve(n,t)))}namespace(){const e=new Ze,t=this.currentToken.pos;if(this.consume(e,T.KEYWORD),e.error)return e;if(this.consume(e,T.OBRACES),e.error)return e;if(this.currentToken.type===T.CBRACES)return this.advance(e),e.success(new ke(t,new Ce));const n=e.register(this.statements());return e.error?e:(this.consume(e,T.CBRACES),e.error?e:e.success(new ke(t,n)))}tryCatch(){const e=new Ze;if(this.consume(e,T.KEYWORD),e.error)return e;if(this.consume(e,T.OBRACES),e.error)return e;if(this.currentToken.type===T.CBRACES)return e.failure(new Ue(this.currentToken.pos,"No empty try block"));const t=e.register(this.statements());if(e.error)return e;if(this.consume(e,T.CBRACES),e.error)return e;if("catch"!==this.currentToken.value)return e.failure(new Ue(this.currentToken.pos,"try block requires catch"));if(this.consume(e,T.KEYWORD),e.error)return e;if(this.consume(e,T.OBRACES),e.error)return e;if(this.currentToken.type===T.CBRACES)return e.success(new Ee(this.currentToken.pos,t,new Ce));const n=e.register(this.statements());return e.error?e:(this.consume(e,T.CBRACES),e.error?e:(this.addEndStatement(e),e.error?e:e.success(new Ee(this.currentToken.pos,t,n))))}}const tt=()=>{if(!Z.permissions.accessDOM)return new Ve("No access to DOM");if(u)return new Ye;const e=window;return void 0===e?new Fe(n.void,"Object","undefined","window","Window is undefined! ES expected to be in a browser."):"$"in e?{$:new I(e.$,"jquery"),window:new I(e,"window"),document:new I(e.document,"document")}:{window:new I(e,"window"),document:new I(e.document,"document")}},nt={ascii:()=>({asciiToChar:e=>{if("number"!=typeof e)throw new TypeError("number");return String.fromCharCode(e)},charToAscii:e=>{if("number"!=typeof e)throw new TypeError("number");return Pe(e).charCodeAt(0)}}),json:()=>({parse:e=>JSON.parse(Pe(e)),stringify:JSON.stringify}),time:()=>({now:w,date:Date})},rt={};function it(e){return e in nt||e in rt}function st(e,t){rt[e]=t}function ot(e){if(e in rt)return rt[e];if(e in nt){const t=nt[e](d);if(t instanceof je)return t;const n=new I(t,e);return rt[e]=n,n}}const at={range:[({context:e},t,r,i)=>{if(!(t instanceof J))return new L;const s=t.valueOf();if(r instanceof $)try{return new L([...Array(s).keys()].map((e=>new J(e))))}catch(e){return new je(n.void,"RangeError",`Cannot make range of length '${Pe(s)}'`)}let o=1;if(!(r instanceof J))return new Fe(n.void,"number",r.typeName(),Pe(r));let a=r.valueOf();if(!(i instanceof $)){if(!(i instanceof J))return new Fe(n.void,"number",i.typeName(),Pe(i));o=i.valueOf()}let u=[],c=s;for(;c<a;)u.push(new J(c)),c+=o;return new L(u)},{args:[{name:"N",type:"Number"}],description:"Generates an array of integers given N. Starts at 0 and goes to N-1. Can be used like for i in range(10) ..., similarly to python.",returns:"array of numbers from 0 to N-1",returnType:"number[] | RangeError"}],log:[({context:e},...t)=>{console.log(...t.map((e=>Pe(e))))},{args:[{name:"...values",type:"any[]"}],description:"Uses console.log to log all values",returnType:"void"}],parse_num:[({context:e},t)=>{try{const e=parseFloat(Pe(t));return isNaN(e)?new je(n.void,"TypeError",`Cannot convert '${Pe(t)}' to a number.`):new J(e)}catch(e){return new je(n.void,"TypeError",`Cannot convert '${Pe(t)}' to a number.`)}},{args:[{name:"num",type:"any"}],description:"Converts a string of digits into a number. Works with decimals and integers. Calls .str() on value before using native JS 'parseFloat' function. Returns TypeError if the string can't be converted into a number.",returnType:"number | TypeError"}],help:[({context:e},...t)=>{if(!t.length)return new q("Visit https://entropygames.io/entropy-script for help with Entropy Script!\nTry 'help(<anything>)' for help about a particular object.");let n="";for(const e of t){if(!(e instanceof S))return void console.log("Invalid arg not primitive: "+Pe(e));const t=e.info;if(n+=`${X.yellow(`Help on '${t.name||"(anonymous)"}'`)}:\n    \n    ${X.yellow("Value")}: ${Be(Be(Pe(e)))}\n    ${X.yellow("Type")}: '${Pe(e.typeName())}'\n    ${X.yellow("Location")}: ${t.file||X.yellow("(unknown)")}\n    \n        ${X.green(t.description)||"No description."}\n        \n    ${t.helpLink?X.cyan(t.helpLink+"\n\n"):""}\n`,t.args&&e instanceof C){const e=t.args.length,r=t.args.filter((e=>e.required)).length;n+=e==r?X.yellow(`    Arguments (${e}): \n`):X.yellow(`    Arguments (${r}-${e}): \n`);for(const[e,r]of t.args.entries())n+="object"!=typeof r?`        ${e+1}. INVALID ARG INFO`:`        ${e+1}. ${r.name}${!1===r.required?X.yellow(" (optional) "):" "}{${r.type}} ${r.description||""}\n`;n+="\n\n",t.returns&&(n+=`    Returns: ${t.returns}\n\n`),t.returnType&&(n+=`    Return Type: ${t.returnType}\n\n`)}if(t.contents&&(e instanceof N||e instanceof A)){n+="    Properties: \n      ";for(let e of t.contents)n+=e.name+"\n      "}}return console.log(n),t.length>1?new L(t):t?t[0]:void 0},{args:[{name:"value",type:"any"}],description:"logs info on value",returns:"value passed in"}],delete:[({context:e},t)=>{const r=Pe(t);if(!e.has(r))return new je(n.void,"DeleteError",`Identifier '${r}' not found in the current context`);e.set(r,new $)},{name:"delete",args:[{name:"identifier",type:"string"}],description:"Deletes a variable from the current context"}],__path__:[({context:e})=>new q(e.path),{name:"__path__",args:[],description:"Returns the current path"}],__symbols__:[({context:e},t)=>{if(t.bool().valueOf()){let t=e.keys;for(;e.parent;)t=e.parent.keys,e=e.parent;return Y(t)}return Y(e.keys)},{name:"__symbols",args:[{name:"recursive",type:"Bool",description:"if true, returns the names of all symbols available in the current scope, if false, just the symbols declared in the current scope."}],description:"Returns an array of the names of all symbols in the current context"}],using:[(e,t,r)=>{if(!(t instanceof A||t instanceof I||t instanceof N))return new Fe(n.void,"Namespace",Pe(t.typeName()));let{context:i}=e,s=!(r&&!r.bool().valueOf()),o=K(t,e);s?i=i.root:i.parent&&(i=i.parent);for(const e of Object.keys(o)){let t=i.setOwn(e,Y(o[e]));if(t)return t}},{name:"using",args:[{name:"module",type:"namespace"},{name:"global",type:"bool"}],description:"Adds contents of a namespace to the current or global context"}],sleep:[({context:e},t,r)=>{if(!(t instanceof J))return new Fe(n.void,"number",Pe(t.typeName()),Pe(t));De(t.valueOf()).then((()=>{const t=r.__call__({context:e});t instanceof je&&console.log(t.str)}))},{name:"sleep",args:[{name:"n",type:"number"},{name:"callback",type:"function"}],description:"Waits n milliseconds and then executes the callback"}],throw:[({context:e},t,r)=>new je(n.void,Pe(t),Pe(r)),{name:"throw",args:[{name:"name",type:"String"},{name:"details",type:"String"}]}],typeof:[({context:e},t)=>{if(!(t instanceof q))return new Fe(n.void,"String",t.typeName(),Pe(t));let r=Pe(t);if(!e.has(r))return new We(n.void,r);let i=e.getSymbol(r);return i?i instanceof je?i:i.type:new We(n.void,r)},{name:"typeof",args:[{name:"identifier",type:"String"}]}]};let ut={};const ct=(e,t,r)=>{if(!Z.permissions.fileSystem)return new Ve("No access to file system");if(!("path"in d))return new He("path");if(!("fs"in d))return new He("fs");const{path:i,fs:s}=d,o=Pe(t);let a=Pe(r);return-1===_.indexOf(a)&&(a="utf-8"),s.existsSync(o)?new N({str:new C((({context:e})=>new q(s.readFileSync(i.join(e.path,o),a).toString())),[],"str",void 0,p.string),write:new C((({context:e},t)=>{s.writeFileSync(e.path+o,Pe(t))}),[{name:"path",type:p.string}]),append:new C((({context:e},t)=>{s.appendFileSync(e.path+o,Pe(t))}),[{name:"path",type:p.string}])}):new Le(n.void,o)},lt=(e,t)=>{if(!Z.permissions.imports)return new Ve("Imports not allowed");let r=Pe(t);if(Z.permissions.useSTD&&it(r))return ot(r);if(!("path"in d))return new He("path");if(!("fs"in d))return new He("fs");const{path:i,fs:o}=d;r=i.join(e.context.path,r);try{if(!o.existsSync(r)){if(!o.existsSync("./particles/"+r))return new je(n.void,"ImportError",`Can't find file '${r}' to import.`);if(!o.existsSync("particles/"+r+"/main.es"))return new je(n.void,"ImportError",`Module '${r}' has no entry point. Requires 'main.es'.`);r="particles/"+r+"/main.es"}const e=i.dirname(r),t=o.readFileSync(r,"utf-8"),a=new re;a.parent=s,a.path=e;const u=new A(new q(r),{}),c=ft(t,{env:a,fileName:r,currentDir:e});return u.__value__=a.getSymbolTableAsDict(),c.error?c.error:u}catch(e){return new je(n.void,"ImportError",e.toString())}};function ht({print:e=console.log,input:t=(()=>{}),node:r=!0,context:i=new re,path:a="",libs:l={}}={}){return h=this,f=void 0,v=function*(){o(i),P();for(let e of Object.keys(l)){let[t,n]=l[e];n&&st(e,new I(t)),d[e]=t}var h,f;h=e,f=t,at.import=[(e,t)=>{if(u)return new je(n.void,"ImportError","Is running in node instance but trying to run browser import function");if(!(t instanceof q))return new Fe(n.void,"String",t.typeName(),Pe(t));const r=Pe(t);return it(r)?ot(r):new Le(n.void,r,"Module not found. Try adding it to the pre-loaded modules.")},{description:"Loads a module. Cannot be used asynchronously, so add any modules to pre-load in the esconfig.json file."}],at.print=[({context:e},...t)=>{let n="";for(let e of t)n+=Pe(e);h(n)},{}],at.input=[({context:e},t,n)=>{f(t.valueOf(),(t=>{let r=null==n?void 0:n.valueOf();if(r instanceof C){let n=r.__call__({context:e},new q(t));n instanceof je&&console.log(n.str)}else"function"==typeof r&&r(t);return new q("'input()' does not return anything. Pass in a function as the second argument, which will take the user input as an argument.")}))},{}];for(let e in at){const t=new C(at[e][0],[],e,void 0,void 0,i,!0);t.info=at[e][1],t.info.name=e,t.info.isBuiltIn=!0,t.info.file="builtin",i.set(e,t,{global:!0,isConstant:!0,type:p.function})}!function(e){const t={false:new F(!1),true:new F(!0),nil:new $,Any:p.any,Number:p.number,String:p.string,Bool:p.bool,Func:p.function,Array:p.array,Object:p.object,Type:p.type,Error:p.error,Undefined:p.undefined};for(let n in t){const r=t[n];e.set(n,r,{global:!0,isConstant:!0})}}(i);const _=void(u||(nt.dom=tt));if(_)return _;i.initialisedAsGlobal=!0,a&&(i.path=a),r&&(c(),yield m(!0),function(e){e.set("import",new C(lt,[{name:"path",type:p.string}],"import",void 0,p.object),{forceThroughConst:!0,isConstant:!0}),e.set("open",new C(ct,[{name:"path",type:p.string},{name:"encoding",type:p.string}],"open",void 0,p.object),{forceThroughConst:!0,isConstant:!0})}(i));let v=yield function(e){return t=this,r=void 0,o=function*(){for(const t of Object.keys(e)){let r=e[t];r in ut&&st(t,ut[r]),".es"!==r.substring(r.length-3)&&(r+=".es");try{let e=yield(yield fetch(r)).text();const n=new re;n.parent=s;let i=r.split("/"),o=i.pop(),a=i.join("/");const u=new A(new q(o),{});ut[r]=u;const c=ft(e,{env:n,fileName:t,currentDir:a});if(u.__value__=n.getSymbolTableAsDict(),c.error)return c.error;st(t,u)}catch(e){return new je(n.void,"ImportError",e.toString())}}},new((i=void 0)||(i=Promise))((function(e,n){function s(e){try{u(o.next(e))}catch(e){n(e)}}function a(e){try{u(o.throw(e))}catch(e){n(e)}}function u(t){var n;t.done?e(t.value):(n=t.value,n instanceof i?n:new i((function(e){e(n)}))).then(s,a)}u((o=o.apply(t,r||[])).next())}));var t,r,i,o}(Z.modules);return v instanceof je?v:s},new((_=void 0)||(_=Promise))((function(e,t){function n(e){try{i(v.next(e))}catch(e){t(e)}}function r(e){try{i(v.throw(e))}catch(e){t(e)}}function i(t){var i;t.done?e(t.value):(i=t.value,i instanceof _?i:new _((function(e){e(i)}))).then(n,r)}i((v=v.apply(h,f||[])).next())}));var h,f,_,v}function ft(e,{env:t=s,measurePerformance:r=!1,fileName:i="(unknown)",currentDir:o=""}={}){o&&(t.path=o),ae.maxTime=0,ae.totalTime=0,ae.interprets=0;const a={total:0,lexerTotal:0,parserTotal:0,interpretTotal:0,nodeMax:0,nodeAvg:0,nodeTotal:0,interprets:0};let u=w();if(!t.root.initialisedAsGlobal){const e=new se;return e.error=new je(n.void,"Uninitialised","Global context has not been initialised with global values"),e}const c=new ze(e,i).generate();if(c instanceof je){const e=new se;return e.error=c,e}a.lexerTotal=w()-u,u=w();const l=new et(c).parse();if(l.error){const e=new se;return e.error=l.error,e}if(a.parserTotal=w()-u,u=w(),!l.node){const e=new se;return e.val=new L([]),e}const h=l.node.interpret(t);return a.interpretTotal=w()-u,a.total=w()-u,a.nodeMax=ae.maxTime,a.nodeTotal=ae.totalTime,a.nodeAvg=ae.totalTime/ae.interprets,a.interprets=ae.interprets,r&&console.log(a),Object.assign(Object.assign({},h),{timeData:a})}function _t(e,{fileName:t="(unknown)",currentDir:r=""}={}){const i=new ze(e,t).generate();if(i instanceof je)return{error:i};const o=new et(i).parse();return o.error?{error:o.error}:o.node?{compileToJavaScript:e=>{if(!o.node)throw"res.node still undefined";const t=`// Generated by EntropyScript->JavaScript compiler v${h}\n`,n="Array.prototype.contains = function (element) {\n\treturn this.indexOf(element) !== -1;\n};\n\nfunction parseNum (str) {\n\treturn parseFloat(str);\n}\n\nconst print = console.log;\n\nNumber.prototype[Symbol.iterator] = function () {\n\treturn {\n\t\tcurrent: 0,\n\t\tlast: this,\n\t\tnext() {\n\t\t\tif (this.current <= this.last) {\n\t\t\t\treturn {\n\t\t\t\t\tdone: false,\n\t\t\t\t\tvalue: this.current++\n\t\t\t\t};\n\t\t\t} else {\n\t\t\t\treturn { done: true };\n\t\t\t}\n\t\t}\n\t};\n};\n\nconst __private__ = {\n\tbims: {\n\t\tmath: Math,\n\t\ttime: {\n\t\t\tdate: Date,\n\t\t\tnow: Date.now,\n\t\t},\n\t},\n};\n\nif (typeof performance !== 'undefined') {\n\t__private__.bims.time.now = performance.now;\n}\n\nfunction import_ (path) {\n\tif (__private__.bims.hasOwnProperty(path)) {\n\t\treturn __private__.bims[path];\n\t}\n}\n\nfunction range (minP, maxP, stepP) {\n\tif (typeof minP !== 'number') {\n\t\treturn [];\n\t}\n\n\tconst min = minP.valueOf();\n\n\tif (typeof maxP === 'undefined') {\n\t\ttry {\n\t\t\treturn [...Array(min).keys()];\n\t\t} catch (e) {\n\t\t\tthrow `RangeError: Cannot make range of length '${min}'`;\n\t\t}\n\t}\n\n\tlet step = 1;\n\n\tif (typeof maxP !== 'number') {\n\t\tthrow 'TypeError: Expected number';\n\t}\n\n\tlet max = maxP.valueOf();\n\n\tif (typeof stepP !== 'undefined') {\n\t\tif (typeof stepP !== 'number') {\n\t\t\tthrow 'TypeError: Expected number';\n\t\t}\n\t\tstep = stepP.valueOf();\n\t}\n\n\tlet arr = [];\n\n\tlet i = min;\n\twhile (i < max) {\n\t\tarr.push(i);\n\t\ti += step;\n\t}\n\n\treturn arr;\n}".toString().replace(/(\r\n|\n|\r|\t| )+/gm," ")+"\n",r=o.node.compileJS(e);return r.error?r:(e.minify&&(r.val=r.val.replace(/(\r\n|\n|\r|\t| )+/gm," ")),new oe(t+n+r.val))},compileToPython:e=>{if(!o.node)throw"res.node still undefined";const t=`# Generated by EntropyScript->Python compiler v${h}\n\n`,n="\n###############################\n# START OF ENTROPY SCRIPT STD #\n###############################\nimport time\n\nlog = print\nparseNum = float\n\ndef help(thing):\n    return 'Help is not available in ES compiled Python'\n\n\ndef GENERATE_PRIVATE():\n    return {\n        'modules': {\n            'ascii': {\n\n            },\n            'time': {\n                'now': lambda: time.time_ns() / (10 ** 6)\n            }\n        }\n    }\n\nPRIVATE = GENERATE_PRIVATE()\n\ndef import_ (path):\n    if path in PRIVATE['modules']:\n        return PRIVATE['modules'][path]\n\n\n#############################\n# END OF ENTROPY SCRIPT STD #\n#############################".toString()+"\n",r=o.node.compilePy(e);return r.error?r:new oe(t+n+r.hoisted+"\n"+r.val)},interpret:(e=s)=>{if(!o.node)throw"res.node still undefined";if(r&&(e.path=r),!e.root.initialisedAsGlobal){const e=new se;return e.error=new je(n.void,"Uninitialised","Global context has not been initialised with global values"),e}return o.node.interpret(e)}}:{error:new je(n.void,"Error","no output")}}return t})()}));
//# sourceMappingURL=latest.js.map