var __awaiter=this&&this.__awaiter||function(t,n,o,i){return new(o||(o=Promise))((function(r,e){function s(t){try{l(i.next(t))}catch(t){e(t)}}function u(t){try{l(i.throw(t))}catch(t){e(t)}}function l(t){var n;t.done?r(t.value):(n=t.value,n instanceof o?n:new o((function(t){t(n)}))).then(s,u)}l((i=i.apply(t,n||[])).next())}))};import{builtInFunctions}from"./built-in/builtInFunctions.js";import{getModule,moduleExist}from"./built-in/builtInModules.js";import{Context}from"./runtime/context.js";import{ESError,ImportError}from"./errors.js";import{Position}from"./position.js";import{run}from"./index.js";import{IS_NODE_INSTANCE,setNone}from"./constants.js";import{str}from"./util/util.js";import{ESFunction,ESNamespace,ESString}from"./runtime/primitiveTypes.js";import{globalConstants}from"./built-in/globalConstants.js";export function initialise(t,n,o,i=[]){builtInFunctions.import=[({context:o},i,r)=>{if(IS_NODE_INSTANCE)return new ESError(Position.unknown,"ImportError","Is running in node instance but trying to run browser import function");const e=i.str();if(moduleExist(str(e)))return getModule(str(e));try{fetch(str(e)).then((t=>t.text())).then((o=>__awaiter(this,void 0,void 0,(function*(){const i=new Context;i.parent=t;const s=yield run(o);s.error?n(new ImportError(Position.unknown,str(e),s.error.str).str):r instanceof ESFunction&&r.__call__([new ESNamespace(e,i.getSymbolTableAsDict())])}))))}catch(t){return new ESError(Position.unknown,"ImportError",t.toString())}},{}],builtInFunctions.print=[({context:t},...o)=>__awaiter(this,void 0,void 0,(function*(){let t="";for(let n of o)t+=str(n);n(t)})),{}],builtInFunctions.input=[({context:t},n,i)=>__awaiter(this,void 0,void 0,(function*(){o(n.valueOf(),(t=>{let n=null==i?void 0:i.valueOf();if(n instanceof ESFunction){let o=n.__call__([new ESString(t)]);o instanceof ESError&&console.log(o.str)}else"function"==typeof n&&n(t);return new ESString("'input()' does not return anything. Pass in a function as the second argument, which will take the user input as an argument.")}))})),{}];for(let n in builtInFunctions){const o=new ESFunction(builtInFunctions[n][0],[],n);o.info=builtInFunctions[n][1],o.info.name=n,o.info.isBuiltIn=!0,o.info.file="built-in",t.set(n,o,{global:!0,isConstant:!0})}for(let n in globalConstants){const o=globalConstants[n];t.set(n,o,{global:!0,isConstant:!0}),"undefined"===n&&setNone(o.valueOf())}for(let t of i);t.libs=i,t.initialisedAsGlobal=!0}